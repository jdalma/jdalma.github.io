{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022y/trainingProject/","result":{"data":{"site":{"siteMetadata":{"title":"코딩 주머니"}},"markdownRemark":{"id":"3b68603f-73f2-5431-aa51-73cc7a6b8543","excerpt":"이번에 진행하게된 1차 트레이닝 프로젝트에서 기대하는 영향은 기존에 존재하던 REST API를 그대로 유지하면서 gRPC 통신을 같이 사용할 수 있을지 확인하고, Stream 통신을 테스트해보는 것이다. REST API와 RPC 통신을 한 포트로 처리할 수 있는 Armeria…","html":"<p>이번에 진행하게된 1차 트레이닝 프로젝트에서 기대하는 영향은 기존에 존재하던 REST API를 그대로 유지하면서 gRPC 통신을 같이 사용할 수 있을지 확인하고, Stream 통신을 테스트해보는 것이다.</p>\n<ul>\n<li>REST API와 RPC 통신을 한 포트로 처리할 수 있는 Armeria를 사용한다.</li>\n<li>protocol buffer를 통해 기존 JSON보다 데이터 사이즈를 줄일 수 있을 것이다.</li>\n</ul>\n<h1 id=\"Armeria와-Tomcat을-한-개의-포트로\" style=\"position:relative;\">Armeria와 Tomcat을 한 개의 포트로?<a href=\"#Armeria%EC%99%80-Tomcat%EC%9D%84-%ED%95%9C-%EA%B0%9C%EC%9D%98-%ED%8F%AC%ED%8A%B8%EB%A1%9C\" aria-label=\"Armeria와 Tomcat을 한 개의 포트로 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>Armeria에서는 <a href=\"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/HttpService.html\"><code class=\"language-text\">javadoc</code> HttpService</a>로 Tomcat, gRPC 들을 추상화 해놓았다.<br>\nArmeria 서버가 실행될 때 원하는 Service들을 ServerBuilder에 추가시키기만 하면 된다.</p>\n<blockquote>\n<p>✋<br>\nTomcat 포트를 직접 지정해주고 해당 포트로 REST 요청을 보내게되면 Armeria를 거치지 않고 바로 TomcatWebServer가 처리한다.<br>\nTomcat 포트를 <code class=\"language-text\">-1</code>로 지정하고 Armeria 포트만 지정해주면 Armeria가 REST 요청과 gRPC 요청 둘 다 처리하게 된다.<br>\nREST 요청과 gRPC 요청을 구분하는 방법이 궁금해서 조사한 결과는 EventLoop에서 반환되는 <code class=\"language-text\">selectedKeys</code> 타입부터 서로 달랐다.<br>\nTomcat 포트를 막고 Armeria만 실행시켜도 Socket이 2개가 열리는 것으로 추정된다.</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebff249f14a266fa7fbdc0f601d37a08/90eea/flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42kVSiYqDQAz1///MQkG6UKiw1tt6tN5z6rwlse0KAZkk75rx8P6ccxBCIAxD3G435HkOrTX2fecez2gNJwScUoDW2ISAniboeca2rpDjCC9JEgzDwIvbtnFZaxmMyj+dkGbZAbgsH34oKSGF4HmjNYy1GPse3jRNeL1eUEphXVc0TYOu67BZi6GuEf78oCsKmHHE3veoqwrLsvAMuamqivf7vkdb1/BI2eVyQVEU3IyiCL9RhCbPcQkC1GUJCAEiJstJHDMpRXK/3xm4LMtDSNPAo3zi91DbtkjTFHlRMFAShqzSGYN5WeCkRBxFeDweDEhZkwgCJtBn28L7ZkJBA5wJkZBy8z6jTOd5BpTGZgyMMYeAdzzn8xnX6/WwTMt0KeM4chasMM/ZYvd8Qir1D2jM91J257hHtQqBVUrM03Rk6Ps+siz7WiYL9B8EAYMT6USA1vKToQjwKWuP2nd+Pn+9ZmFCnAS4MQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flow\"\n        title=\"\"\n        src=\"/static/ebff249f14a266fa7fbdc0f601d37a08/f058b/flow.png\"\n        srcset=\"/static/ebff249f14a266fa7fbdc0f601d37a08/c26ae/flow.png 158w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/6bdcf/flow.png 315w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/f058b/flow.png 630w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/40601/flow.png 945w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/78612/flow.png 1260w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/90eea/flow.png 2254w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Netty의 <code class=\"language-text\">EventLoop</code>가 client로부터 오는 모든 요청을 다 받는다.</p>\n<ol>\n<li><strong>gRPC는 NonBlocking으로 처리</strong></li>\n<li><strong>REST는 Tomcat이 Blocking으로 처리</strong>\n<ul>\n<li>서블릿 스레드는 Armeria의 <code class=\"language-text\">BlockingTaskExecutor</code>이다</li>\n<li><code class=\"language-text\">EventLoop</code>가 해당 request를 처리하라는 작업을 <code class=\"language-text\">BlockingTaskExecutor</code>에게 위임</li>\n<li><code class=\"language-text\">BlockingTaskExecutor</code>에서 어댑터를 이용해 서블릿 컨테이너를 호출</li>\n</ul>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 448px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8943dd5097e3110b3ec831856ba0d15c/33b38/blockNonBlockThread.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.11392405063291%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVR42j2R226DMBBE+ZwqbdpIfW2TEPAdGwyEkAC59v9/YardljxYa61nx+PjxAgBXZRQpsD3ZgepHa9cGuxyBaEsV+MC90mXCY00kwhVA1/W0Naz7nW5QuKUgg01ihCxSQUPksj5CG0D95XxKGPLezKZzWPToQg1pC7Y8H31iaRvOxzHG8bpjjJ26E8XjOcHjsOV98N0R9dPmC4/OI1XjOc7+tMZsTlgujwwTDd0/Yi2G7BJJRIr/xP6iO3uLyEloUrPc77i51OlHiXJhOHEtqhY0+yPrFm8fSDReQ7tSuYwM5yZkIgG1tvsyY4uJaYzO2JZtwc+e1ksyVBA2QBjPb7WKYRyzI645NLyEJlQj5KRQZopZkmpKUBV75+f8gtb2eD3ofA1IQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"blockNonBlockThread\"\n        title=\"\"\n        src=\"/static/8943dd5097e3110b3ec831856ba0d15c/33b38/blockNonBlockThread.png\"\n        srcset=\"/static/8943dd5097e3110b3ec831856ba0d15c/c26ae/blockNonBlockThread.png 158w,\n/static/8943dd5097e3110b3ec831856ba0d15c/6bdcf/blockNonBlockThread.png 315w,\n/static/8943dd5097e3110b3ec831856ba0d15c/33b38/blockNonBlockThread.png 448w\"\n        sizes=\"(max-width: 448px) 100vw, 448px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>EventLoop는 변경되지 않는 하나의 Thread로 움직이며,<br>\n작업 (Runnable 또는 Callable)을 EventLoop 구현으로 직접 제출해 즉시 또는 예약 실행할 수 있다.<br>\n구성과 사용 가능한 코어에 따라서는 리소스 활용을 최적화하기 위해 여러 EventLoop가 생성되고,<br>\n여러 Channel에 서비스를 제공하기 위해 단일 EventLoop가 할당되는 경우도 있다.</p>\n<ul>\n<li><strong>네티인액션</strong></li>\n</ul>\n</blockquote>\n<h1 id=\"gRPC-통신-종류\" style=\"position:relative;\">gRPC 통신 종류<a href=\"#gRPC-%ED%86%B5%EC%8B%A0-%EC%A2%85%EB%A5%98\" aria-label=\"gRPC 통신 종류 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p>Async는 비동기-논블로킹 통신, Future는 동기-논블로킹 통신</p>\n</blockquote>\n<ul>\n<li>\n<p><strong>UnaryCall</strong> 단일 요청, 단일 응답</p>\n<ul>\n<li>Future Stub</li>\n<li>Blocking Stub</li>\n<li>기본(Async) Stub</li>\n</ul>\n</li>\n<li>\n<p><strong>ServerStream</strong> 서버 → 클라이언트 스트림 통신</p>\n<ul>\n<li>Future Stub (not support)</li>\n<li>Blocking Stub</li>\n<li>기본(Async) Stub</li>\n</ul>\n</li>\n<li>\n<p><strong>ClientStream</strong> 클라이언트 → 서버 스트림 통신</p>\n<ul>\n<li>Future Stub (not support)</li>\n<li>Blocking Stub (not support)</li>\n<li>기본(Async) Stub</li>\n</ul>\n</li>\n<li>\n<p><strong>BiStream</strong> 양방향 스트림 통신</p>\n<ul>\n<li>Future Stub (not support)</li>\n<li>Blocking Stub (not support)</li>\n<li>기본(Async) Stub</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"Armeria의-Server-Thread는-어떻게-처리될까\" style=\"position:relative;\">Armeria의 Server Thread는 어떻게 처리될까?<a href=\"#Armeria%EC%9D%98-Server-Thread%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%B2%98%EB%A6%AC%EB%90%A0%EA%B9%8C\" aria-label=\"Armeria의 Server Thread는 어떻게 처리될까 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/03f8e242df029769652d8a7aa43df5f7/705cc/expect.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVR42l1S23LrIAzM/zRIQlxsnMTGzqVtzv9/z56R4mY6fdgBgbRawR5aG0AcIJEhkRAlIEb6s2ew7Gd7LMLvGr+T1/5AbAfikChe8BsihECWHHEMAZZ/DARiATGDiEBkDaMLO1hRKhkxKYiP4B1EH2+YkrmvWNaOuS+4PR74/H5i6a+4b1fUoYIl4CByRMqKNg1Y1xm9X9D7jNttxfXasW2Ln0/nE2JkqApyUQxtREriqGOFqj2DEwakkjCMFW0sGMfiBPf7Fff7hsfjiufzE9//nn6Xc0StGblmMH34NJrUm8mPwlyyE5aiKCWh1uSF83x2Ql+/vrzB6TSiTc0VW47B9qbcCa2DzV+H4vItwVYb4XKZHK1VfytT4SPWjDoOnqOR0E4TNO2EYoRj9SRPUMY0DViWi/+yxedzQ9/W972RlqHsMb3JzWZum6i646UsZ/WxXWkStwpHRaDgngtEbhNmcqv8WMh/OWqEpuywvck22FNYR0uSqMil7H5lRE1IubhvOVrTV2yN/wO6PkFDlJqN3gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"expect\"\n        title=\"\"\n        src=\"/static/03f8e242df029769652d8a7aa43df5f7/f058b/expect.png\"\n        srcset=\"/static/03f8e242df029769652d8a7aa43df5f7/c26ae/expect.png 158w,\n/static/03f8e242df029769652d8a7aa43df5f7/6bdcf/expect.png 315w,\n/static/03f8e242df029769652d8a7aa43df5f7/f058b/expect.png 630w,\n/static/03f8e242df029769652d8a7aa43df5f7/40601/expect.png 945w,\n/static/03f8e242df029769652d8a7aa43df5f7/705cc/expect.png 1071w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1a839906e933a6d47cb6711d8d54e93c/77672/real.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVR42mVS7XKcQAzjgY61veZrF1ggl0tIOtP2/V9GGRuOpNMfHp1B2JJPVc49AtVexAEiAcz1idbXYAkXR4T8+TefHEM4+up4ISBmsAgkkg/7WYHCwSFGIEIdgmMgRh1q7yVG1ESo/KPI0K4F2za6/VeBbhhSwvpyx7wULNuG/fMX7o8H5lJQ1tXL5lRPi23XYp4z1rVgWSaUMmLbjt9LGZHH5BxVRtMI+jSgbSOaJnrf9Z27uQYOOSHnAXbTeR7xeNzx/v6KfX/Dx/6GP39/4+W+oW3EK43Zv2M+XGij/w7shv7cKI6mMKUepUyu9NUWfOzY1hldp5iW4mhcw2PBT4VpcDtPS9OUkVKHaUreRxVoq2C6Ob9P6UqEpcBOcCm0aORpvBRa2XPrzb6dwW6b8nAttBPFSIgSHIcxHwP5jIW2LSSaEnaCnmgKVCNSzoiq/k+yMDhGx2cvqj6nMt8sEXzmkJ82zrKtljXLnXGIyUucK2fgTYAiMOMLpgVBRHFYfuwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"real\"\n        title=\"\"\n        src=\"/static/1a839906e933a6d47cb6711d8d54e93c/f058b/real.png\"\n        srcset=\"/static/1a839906e933a6d47cb6711d8d54e93c/c26ae/real.png 158w,\n/static/1a839906e933a6d47cb6711d8d54e93c/6bdcf/real.png 315w,\n/static/1a839906e933a6d47cb6711d8d54e93c/f058b/real.png 630w,\n/static/1a839906e933a6d47cb6711d8d54e93c/40601/real.png 945w,\n/static/1a839906e933a6d47cb6711d8d54e93c/77672/real.png 1060w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>클라이언트의 메인 스레드에서 다른 서비스로 요청해도 모든 요청을 처리하는 스레드는 서버 스레드 한 개이다\n<ul>\n<li>Sample, Hello 서로 다른 서비스로 요청을 보내도 요청을 처리하는 스레드는 한 개이다</li>\n</ul>\n</li>\n<li>위와 같은 테스트를 두 개의 클라이언트에서 각각 한 번씩 보내도 똑같은 결과다\n<ul>\n<li><strong>결국 서버에서 받는 모든 요청들은 각 클라이언트의 소켓에 맞는 서버의 스레드들이 처리한다</strong></li>\n</ul>\n</li>\n<li>한 개의 클라이언트의 메인 스레드에서 자식 스레드 여러 개를 서버에 요청 전송하여도 한 개의 서버 스레드가 처리한다.</li>\n</ol>\n<blockquote>\n<p>위와 같은 결과가 나오는 이유를 이해하려면 이벤트 루프, 멀티플렉싱에 대한 이해가 필요하다.<br>\n<a href=\"https://github.com/jdalma/footprints/blob/main/%EC%A0%95%EB%A6%AC/%EB%A9%80%ED%8B%B0%ED%94%8C%EB%A0%89%EC%8B%B1.md\">EventLoop와 멀티플렉싱에 대해 정리한 글</a>을 참고하자</p>\n</blockquote>\n<p>EventLoop는 단일 스레드로 요청과 응답을 처리하므로 해당 스레드를 블록하면 EventLoop 자체를 블록하는 것과 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/084f82f52f6b152b7a175bdb3bc733ab/561da/blockingTaskExecutor.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.177215189873415%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6klEQVR42pWR3WrDMAyF/RxrkyWxHNuRf5t2aXYz2Pu/0xm2s8Jgg+7iQxISEudIpLziY//EFndIw5Dz8oOJDKSUmBVViAikuaKMe8wpzehHBRHiive3O1YfMVsHvQQYjjAcjjzALB7Guorl1p+tP+YaZXY2DkIbxnbd4YxHNxK6geqlykA49VPl5eDUy1Z346PXaLVgjsh5Q/AryLgqpVwrcgrnV/kH9GstzgMhXjb4fKsx5Bt8usKnGzissC5VeZNankKUrYYTrMtY/OXIU42kHSbFTy+rC4tXlhO0bWaXjxUvvmUUT//DF2hDynZ6gjGTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"blockingTaskExecutor\"\n        title=\"\"\n        src=\"/static/084f82f52f6b152b7a175bdb3bc733ab/f058b/blockingTaskExecutor.png\"\n        srcset=\"/static/084f82f52f6b152b7a175bdb3bc733ab/c26ae/blockingTaskExecutor.png 158w,\n/static/084f82f52f6b152b7a175bdb3bc733ab/6bdcf/blockingTaskExecutor.png 315w,\n/static/084f82f52f6b152b7a175bdb3bc733ab/f058b/blockingTaskExecutor.png 630w,\n/static/084f82f52f6b152b7a175bdb3bc733ab/40601/blockingTaskExecutor.png 945w,\n/static/084f82f52f6b152b7a175bdb3bc733ab/561da/blockingTaskExecutor.png 969w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0000c7780b5d9a5ecc10f5a4a85f67c7/4ef3c/packet.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKElEQVR42i2MWVPaABhF+f/TzrTj1GKXB+2L4FahEEIIkEiAEAgRCEsSUBEF0RYo4IALpwP2zpw53/dwry+vZsmkVCRB4uQ4xK9QlEh4jUA4FNnc4dPI5v95EiIWjZOUUiiygpbOUNB0Bp7HRavFeDzGV6tXsRs11KzGaUzgV1xEUuQNsZS0cVQWEdOJjZMZhZyRp2AaWFWLWtPmxm1h6vrbYE6tsUaIaAT2BYIBkeMjmaNDmYOgxOFBgv19ceNAQCQcOiMWyZEQDdSkRS5j07ObtO0as/kcn/sww/s9Q3e6RPMW8WKN5LmDbDmodptC+5qsc4HuddFaHSq9Ia3hZIN7P8V5mDIdjVnMZ7y8vuK7nrv0Hj1KlzoRXUCxUyQsCbWe5qyRJu9lyLoqeltDcxRqfZPbRYfrmUt35nCz6HA/7NKqN/kzGuHrjUbcTsaUvTbJYomzahXFOkexLCTdQClbZCoVcnaVrF2l6DTpDO/wBn06dwPcQZ/ZZMLL0xPL5RLf5Y3D1a2DWTNIZ2UKmky+oJC3NDJFhXKjgGnnMapZitUspq3T7jZod+sbe90Gj/d9eH5mHZ910aJy5ZAqGxwlROSEiKSliRc1ojmFuKEhGhli/5FKOcqdJuue1WlyfuXycNfn8e/0bdDcC1L+cYD6bZfoJz/S9g7xzzuI/i8I234SX78jfNgm8m6LyPst4h/9lHYDmHsBzN0Apb0g45bDarlgtVrxD9+dYsEQ+j1mAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"packet\"\n        title=\"\"\n        src=\"/static/0000c7780b5d9a5ecc10f5a4a85f67c7/f058b/packet.png\"\n        srcset=\"/static/0000c7780b5d9a5ecc10f5a4a85f67c7/c26ae/packet.png 158w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/6bdcf/packet.png 315w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/f058b/packet.png 630w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/40601/packet.png 945w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/78612/packet.png 1260w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/4ef3c/packet.png 2863w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>Event Loop가 처리하는 기준</strong></p>\n<ul>\n<li>한 호스트의 동일한 Port에서 10초 간격으로 요청을 보내면 한 개의 Armeria Server Thread로 처리하지만</li>\n<li>11초 간격으로 보내면 클라이언트의 Port가 바뀌면서 각기 다른 Armeria Server Thread가 처리한다</li>\n<li><a href=\"https://datatracker.ietf.org/doc/html/rfc7540#section-6.8\"><code class=\"language-text\">GOAWAY</code> 프레임</a>을 통해 서로 데이터를 다 보냈다는 확인을 한다.</li>\n<li>마지막 <strong>RST flag</strong>를 보내면서 서버에서 Socket이 닫히고 TCP 커넥션을 끊는다고 이해했다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee84d55503ee3e11c8d3623ef8b53226/129e9/armeriaThread.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACd0lEQVR42l2SS4tdRRRG749zJCgtSkRwKP4Bn0PBgZqoCWTiUAlGBFEyUQcRJ4IDIYg2Iemk28S093HOPa96P8+Sqntv+xh87F27qtb+dp2z+O3ufR6cPOLk3h+cLVe82nzCpfVVXt5e54XhQ47kFZ6TVzgSl3e52OXPi494sb/KpeFjXhqu8Uz/Pl+pn1nc+foWd299V3Xy7ffc/v1HvnnwCzdu/8A7d77ktePPeOv4Bm/c+5w3f/2U1+/f5O3jm7zy8DpPj+/xbPcBR/1lnure5Qv5EwutNV4Z5hBJw8BmekITW1a6YaV72qmnER2NGmiHLRs90IqBpdpwGlec+iVnYcXDsKRPkgXBQ0rUmBMIQVj1qM4ThGNqDVFHpkbjpUe0Gjs5TO+wrYOYiWPEri34yKI5HxgHR/SZ9UqhR012DmMjUhuUdmi7W6cZXMj4mHEhVc1ALHUbyN6z8CbQdSObTYOQlmwcWMM8l6PgvSPGSCpKRYlpHFkulygp616IscIIgUXfKlbrgbbtWW8kXlqwljkfgIHCds6jlMIYi5SS9XqNMaY2NNYSndsBVSvr28wuonpLGMQOeOHQV1fO7ZzGEIkxoaSi67oKLw7TwSFkmDNz+SCH3LkLhyGECi/KOVdYaSKE4PzJeXUZU/rHYbn2H5XL/wIeHKa4cxl8uAAX6Ha7ZZoEyYc9cN/9MCJ7IPt18J45532DueZl9LIvheDs9JS+74nWHkY+cObqsBzMPmBDQlmHsr7+FjbkGo2PSONwMePTXB6p1r2PzDH+D7h3ZduJ/nGH3gx0jztcO9Vomonhz1KfmP7qGc97UBLdCMZHW2Zt+BuFmtCvouSw5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"armeriaThread\"\n        title=\"\"\n        src=\"/static/ee84d55503ee3e11c8d3623ef8b53226/f058b/armeriaThread.png\"\n        srcset=\"/static/ee84d55503ee3e11c8d3623ef8b53226/c26ae/armeriaThread.png 158w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/6bdcf/armeriaThread.png 315w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/f058b/armeriaThread.png 630w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/40601/armeriaThread.png 945w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/129e9/armeriaThread.png 1161w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"소감과-무지-목록\" style=\"position:relative;\">소감과 무지 목록<a href=\"#%EC%86%8C%EA%B0%90%EA%B3%BC-%EB%AC%B4%EC%A7%80-%EB%AA%A9%EB%A1%9D\" aria-label=\"소감과 무지 목록 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>proto를 작성해서 generate된 stub들을 이용하여 client ↔︎ server 스트림 통신을 테스트해보는 간단한 테스트 코드를 작성해보았다.<br>\n그리고 새로운 서비스를 개발할 때 다른 팀원들이 템플릿처럼 사용할 수 있도록 회사 레포에 등록해두었다.<br>\n기존 서비스들에 적용하기에는 큰 도전일 것으로 예상된다.<br>\n이 기술들을 한 번에 적용하기 보다는 <a href=\"https://spring.io/blog/2015/03/22/using-google-protocol-buffers-with-spring-mvc-based-rest-services\">JSON을 proto로 바꿔보는 단계</a>를 밟는것도 좋을 것 같다.</p>\n<p>해당 프로젝트에는 처음 접하는 기술적인 키워드들이 많이 포함되어 있었고, 네트워크 지식이 부족하다고 느꼈다.</p>\n<ul>\n<li>추가적으로 정리한 내용은 <a href=\"https://github.com/jdalma/footprints/blob/main/%EC%A0%95%EB%A6%AC/Armeria_gRPC.md\">Armeria와 gRPC 정리</a>에서 볼 수 있다.</li>\n</ul>\n<p><strong>무지 목록</strong></p>\n<ol>\n<li>Netty에 대한 이해</li>\n<li>TCP 소켓 프로그래밍에 대한 이해</li>\n<li>HTTP/2에 대한 이해</li>\n<li>Armeria 아키텍처</li>\n</ol>","frontmatter":{"title":"1차 트레이닝 프로젝트","date":"December 15, 2022","description":null,"tags":["Armeria","gRPC","HTTP/2"]},"tableOfContents":"<ul>\n<li><a href=\"#armeria%EC%99%80-tomcat%EC%9D%84-%ED%95%9C-%EA%B0%9C%EC%9D%98-%ED%8F%AC%ED%8A%B8%EB%A1%9C\">Armeria와 Tomcat을 한 개의 포트로?</a></li>\n<li><a href=\"#grpc-%ED%86%B5%EC%8B%A0-%EC%A2%85%EB%A5%98\">gRPC 통신 종류</a></li>\n<li><a href=\"#armeria%EC%9D%98-server-thread%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%B2%98%EB%A6%AC%EB%90%A0%EA%B9%8C\">Armeria의 Server Thread는 어떻게 처리될까?</a></li>\n<li><a href=\"#%EC%86%8C%EA%B0%90%EA%B3%BC-%EB%AC%B4%EC%A7%80-%EB%AA%A9%EB%A1%9D\">소감과 무지 목록</a></li>\n</ul>"},"previous":{"fields":{"slug":"/2022y/iterator/"},"frontmatter":{"title":"Iterator?Enumerator?Iterable?"}},"next":{"fields":{"slug":"/2022y/yearend/"},"frontmatter":{"title":"2022년 회고"}}},"pageContext":{"id":"3b68603f-73f2-5431-aa51-73cc7a6b8543","previousPostId":"ab2f9efb-8a1e-5eca-bee0-b879cc21f54b","nextPostId":"c7aeeb32-24c2-5333-a99d-48a26cddd34b"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}