{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022y/trainingProject/","result":{"data":{"site":{"siteMetadata":{"title":"코딩 주머니"}},"markdownRemark":{"id":"3b68603f-73f2-5431-aa51-73cc7a6b8543","excerpt":"으로 마이그레이션,테스트 코드 작성후에  분석 내용 최종 리뷰와 데모 개발, 시연을 마쳤다. Armeria가 요청을 어떻게 처리하는지 Armeria Thread가 어떤 기준으로 생성되고 소멸되는지 Armeria가 논블로킹, 블로킹 처리를 어떻게 하는지 Java NIO의 Selector…","html":"<p><code class=\"language-text\">kotlin</code>으로 마이그레이션,테스트 코드 작성후에</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7c7a288db03fd99329d6920828b44833/487bb/testcode.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 168.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAiCAYAAABfqvm9AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEtUlEQVR42pVWiXbaSBDk/78k603WdoAcG5ssgaxtzG0ki1MSEqcQum+J2jeN401icBy9V29aDGpNd1dXK7fb7fA7F/v/c8gJbguiPsCwP8JEFCFJEnieR7/fR7PZRL1eJ1uSZKiqCsd14T6DXMMqQ1h3cVW+wdnZXygU3uLjh/f4XLpEIf8W74oFvH9XRLFYQLVSgevYcGwblmUdRM5NbDixBQ8WwgRwwx2iFHCDDEECsoMYiDPQ/tYO4foR0jQ9iBzLS5D6EP0exLmHyp2Ge9nCraDjmt+gNdwSmsMtyp016gMDCz2gfGbZgRyyDT91MQ0EDFUXdxOTMFBsWoWphaFq0zqaOfQyBs1gTndI0wxZ9j9+dKg4aI8MerhPDmz0FRsj1aYXCA8nZysLfbfLKMwnDinkoIeZFuCiuaKw/+U26I5NXPM6bu71F9MqZycGrMiAk5rIMsDyEth+AsuL4YUp/DCFGyTIKEf7vDFEUXQQuVuzBG7RwpfLKgrFAj5++IBCIY+Li094/fo13VcqFZyfn+P09AyfLi5QKpWg6zrRxDTNH5Dru21MzTEkUcZ4NIAsjiBLY8JUGmOmyljMplDkCeaKRKsyleA4DjzPe0psFneUhdjsFCyNDPzUx2yb4F7xIagBxFWI8SKAvI4wmAUE3cn2bXgoh9+qLHoc5pqPzmiL8czGZG6Dk/a0GSgWBNlEY6DjXjahGf5jhQ8S209cqJGA9shCTdji5p4R2UBjsMfviMR3J+Sx2obojg06ISPzdOUSB1XNQxQnSJKU8DP3nvCQ5XCVilgZMao9HbW+hfrQgqB66IoOWiPr5SccexwUcwJFUaBpK1iGhsVMwWKuYiqJVGV9s8ZwOMRiscByuSTKHKowVZnxkF+28fljGScnf+DNmzc4PT1FPp8nnJ2dEQf/PDlBsVjEq1ev0Gg06GHGuyfytY3XMEMdfuYiTjKEUUIdk6Q7pBke7W/qwuw4SRFFMeL4KR57WQp6GM08lDsaOMnCFbehfq73t4TGYIt/2mv6bbbxH/N4lIdMbeSl98A7G9LCJXs8d8gezxxISxeTuUMwnOi42jAeKqEAXrLpJN2JiZ5o0knZyhwzbeyMDHzpamgNDay2z+qhR4qtrn38XV+SUrMwOdFETdDJftpoR2jDwmUzxco2yHbA1kmxMmPMNiEML4PhJtBtRuqMivL9lSQHitKyKhBWXdS+1lEqXeJrtYLS5Sfc1q7Jrt1c0f1gMES1WsX5+Vvk8wWUy1+Ij/ZPEzDHOTVM9D4Ero92q4G7ThPdTht9gUen3QDP9dBpN2Hoa8jiGL27DgT+DhzHkTMmY98jx+IOUx8mltAdQFxF0OyMZEvWYhqhMz0BLzuY6zHtTZbR0RZ8pM3EY0XxSL7EhUMyxYlsZHpoj5gCbdATjb2M9XUEYfxAm2NTLxQgLX0iLpt0TLaueP2IjD5T5W+0kf17rLchEZjJ1kL3idC6FVKrJeke6cP6rHwxh4zY7eGed2z2MoIz3AoPHNztjjo5GLIU8FhsQnztadQVrEuGqkM2L1lI0gy7lzoM0wDLUMLWiqjVGJgjVhym3CynLOwXnfBRMX753bn75ccmK8p/w9kFtfiYXcMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"testcode\"\n        title=\"\"\n        src=\"/static/7c7a288db03fd99329d6920828b44833/f058b/testcode.png\"\n        srcset=\"/static/7c7a288db03fd99329d6920828b44833/c26ae/testcode.png 158w,\n/static/7c7a288db03fd99329d6920828b44833/6bdcf/testcode.png 315w,\n/static/7c7a288db03fd99329d6920828b44833/f058b/testcode.png 630w,\n/static/7c7a288db03fd99329d6920828b44833/487bb/testcode.png 698w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>분석 내용 최종 리뷰와 데모 개발, 시연을 마쳤다.</p>\n<ol>\n<li>Armeria가 요청을 어떻게 처리하는지</li>\n<li>Armeria Thread가 어떤 기준으로 생성되고 소멸되는지</li>\n<li>Armeria가 논블로킹, 블로킹 처리를 어떻게 하는지</li>\n<li>Java NIO의 Selector와 Netty의 EventLoop</li>\n<li>gRPC(+ HTTP/2) 통신과 ProtocolBuffers를 어떻게 사용하는지</li>\n<li>Wireshark와 Visual VM을 사용하여 패킷이나 스레드가 어떻게 처리되는지 분석</li>\n</ol>\n<p>등등의 내용들을 배우게 되었다.<br>\n팀장님이 생각하셨던 것보다 흥미를 느끼신다고 하셨고 \"산출물이 기대했던 것 보다 잘 나왔다\"고 하셨지만<br>\n스스로 생각하기에는 완벽한 이해나 분석을 했다고 볼 수 없다고 느꼇다.<br>\n<strong>진행하면서 <code class=\"language-text\">OS와 네트워크의 중요성</code>을 많이 느꼈다</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebff249f14a266fa7fbdc0f601d37a08/90eea/flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42kVSiYqDQAz1///MQkG6UKiw1tt6tN5z6rwlse0KAZkk75rx8P6ccxBCIAxD3G435HkOrTX2fecez2gNJwScUoDW2ISAniboeca2rpDjCC9JEgzDwIvbtnFZaxmMyj+dkGbZAbgsH34oKSGF4HmjNYy1GPse3jRNeL1eUEphXVc0TYOu67BZi6GuEf78oCsKmHHE3veoqwrLsvAMuamqivf7vkdb1/BI2eVyQVEU3IyiCL9RhCbPcQkC1GUJCAEiJstJHDMpRXK/3xm4LMtDSNPAo3zi91DbtkjTFHlRMFAShqzSGYN5WeCkRBxFeDweDEhZkwgCJtBn28L7ZkJBA5wJkZBy8z6jTOd5BpTGZgyMMYeAdzzn8xnX6/WwTMt0KeM4chasMM/ZYvd8Qir1D2jM91J257hHtQqBVUrM03Rk6Ps+siz7WiYL9B8EAYMT6USA1vKToQjwKWuP2nd+Pn+9ZmFCnAS4MQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flow\"\n        title=\"\"\n        src=\"/static/ebff249f14a266fa7fbdc0f601d37a08/f058b/flow.png\"\n        srcset=\"/static/ebff249f14a266fa7fbdc0f601d37a08/c26ae/flow.png 158w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/6bdcf/flow.png 315w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/f058b/flow.png 630w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/40601/flow.png 945w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/78612/flow.png 1260w,\n/static/ebff249f14a266fa7fbdc0f601d37a08/90eea/flow.png 2254w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>개인적으로 위 이미지의 빨간 영역 관련해서 더 학습해야할 내용들은</p>\n<ol>\n<li><strong>Java NIO의 Selector가 SelectionKeys를 반환하는 과정</strong>\n<ul>\n<li>TCP Buffer에 패킷들이 다 적재되어 사용할 수 있는 상황이 되면 User영역에 옮기는 처리를 한다고 하는데 명확한 이해가 되지 않는다</li>\n</ul>\n</li>\n<li><strong>Socket File Discriptor에 대한 이해</strong>\n<ul>\n<li>어떤 과정으로 Socket과 Channel이 생겨나는지</li>\n</ul>\n</li>\n<li><strong>Armeria Server Thread가 생성되는 기준에 대한 이해</strong>\n<ul>\n<li>한 호스트의 동일한 Port에서 10초 간격으로 요청을 보내면 한 개의 Armeria Server Thread로 처리하지만</li>\n<li>11초 간격으로 보내면 클라이언트의 Port가 바뀌면서 각기 다른 Armeria Server Thread가 처리한다</li>\n<li>마지막 <strong>RST flag</strong>를 보내면서 서버에서 Socket이 닫히고 EventLoop와 Channel이 소멸된다고 생각하고 있다</li>\n</ul>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0000c7780b5d9a5ecc10f5a4a85f67c7/4ef3c/packet.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKElEQVR42i2MWVPaABhF+f/TzrTj1GKXB+2L4FahEEIIkEiAEAgRCEsSUBEF0RYo4IALpwP2zpw53/dwry+vZsmkVCRB4uQ4xK9QlEh4jUA4FNnc4dPI5v95EiIWjZOUUiiygpbOUNB0Bp7HRavFeDzGV6tXsRs11KzGaUzgV1xEUuQNsZS0cVQWEdOJjZMZhZyRp2AaWFWLWtPmxm1h6vrbYE6tsUaIaAT2BYIBkeMjmaNDmYOgxOFBgv19ceNAQCQcOiMWyZEQDdSkRS5j07ObtO0as/kcn/sww/s9Q3e6RPMW8WKN5LmDbDmodptC+5qsc4HuddFaHSq9Ia3hZIN7P8V5mDIdjVnMZ7y8vuK7nrv0Hj1KlzoRXUCxUyQsCbWe5qyRJu9lyLoqeltDcxRqfZPbRYfrmUt35nCz6HA/7NKqN/kzGuHrjUbcTsaUvTbJYomzahXFOkexLCTdQClbZCoVcnaVrF2l6DTpDO/wBn06dwPcQZ/ZZMLL0xPL5RLf5Y3D1a2DWTNIZ2UKmky+oJC3NDJFhXKjgGnnMapZitUspq3T7jZod+sbe90Gj/d9eH5mHZ910aJy5ZAqGxwlROSEiKSliRc1ojmFuKEhGhli/5FKOcqdJuue1WlyfuXycNfn8e/0bdDcC1L+cYD6bZfoJz/S9g7xzzuI/i8I234SX78jfNgm8m6LyPst4h/9lHYDmHsBzN0Apb0g45bDarlgtVrxD9+dYsEQ+j1mAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"packet\"\n        title=\"\"\n        src=\"/static/0000c7780b5d9a5ecc10f5a4a85f67c7/f058b/packet.png\"\n        srcset=\"/static/0000c7780b5d9a5ecc10f5a4a85f67c7/c26ae/packet.png 158w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/6bdcf/packet.png 315w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/f058b/packet.png 630w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/40601/packet.png 945w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/78612/packet.png 1260w,\n/static/0000c7780b5d9a5ecc10f5a4a85f67c7/4ef3c/packet.png 2863w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>Expect</strong></p>\n<deckgo-highlight-code language=\"mermaid\"  >\n          <code slot=\"code\">sequenceDiagram\n    participant C as Client Main Thread\n    participant S1 as Server Request1\n    participant S2 as Server Request2\n    participant S3 as Server Request3\n    Note over S1,S3: One Thread\n\n    C-&gt;&gt;+S1: 1. Sample Future Client : sampleUnaryCall (10s sleep)\n    C-&gt;&gt;+S2: 2. Sample Future Client : sampleUnaryCall\n    C-&gt;&gt;+S3: 3. Hello Async Client : helloUnaryCall\n    S2--&gt;&gt;-C: 2. Response\n    S3--&gt;&gt;-C: 3. Response\n    S1--&gt;&gt;-C: 1. Response</code>\n        </deckgo-highlight-code>\n<p><strong>Real</strong></p>\n<deckgo-highlight-code language=\"mermaid\"  >\n          <code slot=\"code\">sequenceDiagram\n    participant C as Client Main Thread\n    participant S1 as Server Request1\n    participant S2 as Server Request2\n    participant S3 as Server Request3\n    Note over S1,S3: One Thread\n\n    C-&gt;&gt;+S1: 1. Sample Future Client : sampleUnaryCall (10s sleep)\n    C-&gt;&gt;+S2: 2. Sample Future Client : sampleUnaryCall\n    C-&gt;&gt;+S3: 3. Hello Async Client : helloUnaryCall\n    S1--&gt;&gt;-C: 1. Response\n    S2--&gt;&gt;-C: 2. Response\n    S3--&gt;&gt;-C: 3. Response</code>\n        </deckgo-highlight-code>\n<ol>\n<li>클라이언트의 메인 스레드에서 다른 서비스로 요청해도 모든 요청을 처리하는 스레드는 서버 스레드 한 개이다\n<ul>\n<li>Sample, Hello 서로 다른 서비스로 요청을 보내도 요청을 처리하는 스레드는 한 개이다</li>\n</ul>\n</li>\n<li>위와 같은 테스트를 클라이언트 2개에서 각각 한 번씩 보내도 똑같은 결과다\n<ul>\n<li><strong>결국 서버에서 받는 모든 요청들은 각각의 클라이언트에 맞는 서버의 스레드들이 처리한다</strong></li>\n</ul>\n</li>\n<li>클라이언트의 메인 스레드에서 ExecutorService를 통해 자식 스레드를 여러 개를 서버에 요청 전송하여도 한 개의 서버 스레드가 처리한다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee84d55503ee3e11c8d3623ef8b53226/129e9/armeriaThread.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACd0lEQVR42l2SS4tdRRRG749zJCgtSkRwKP4Bn0PBgZqoCWTiUAlGBFEyUQcRJ4IDIYg2Iemk28S093HOPa96P8+Sqntv+xh87F27qtb+dp2z+O3ufR6cPOLk3h+cLVe82nzCpfVVXt5e54XhQ47kFZ6TVzgSl3e52OXPi494sb/KpeFjXhqu8Uz/Pl+pn1nc+foWd299V3Xy7ffc/v1HvnnwCzdu/8A7d77ktePPeOv4Bm/c+5w3f/2U1+/f5O3jm7zy8DpPj+/xbPcBR/1lnure5Qv5EwutNV4Z5hBJw8BmekITW1a6YaV72qmnER2NGmiHLRs90IqBpdpwGlec+iVnYcXDsKRPkgXBQ0rUmBMIQVj1qM4ThGNqDVFHpkbjpUe0Gjs5TO+wrYOYiWPEri34yKI5HxgHR/SZ9UqhR012DmMjUhuUdmi7W6cZXMj4mHEhVc1ALHUbyN6z8CbQdSObTYOQlmwcWMM8l6PgvSPGSCpKRYlpHFkulygp616IscIIgUXfKlbrgbbtWW8kXlqwljkfgIHCds6jlMIYi5SS9XqNMaY2NNYSndsBVSvr28wuonpLGMQOeOHQV1fO7ZzGEIkxoaSi67oKLw7TwSFkmDNz+SCH3LkLhyGECi/KOVdYaSKE4PzJeXUZU/rHYbn2H5XL/wIeHKa4cxl8uAAX6Ha7ZZoEyYc9cN/9MCJ7IPt18J45532DueZl9LIvheDs9JS+74nWHkY+cObqsBzMPmBDQlmHsr7+FjbkGo2PSONwMePTXB6p1r2PzDH+D7h3ZduJ/nGH3gx0jztcO9Vomonhz1KfmP7qGc97UBLdCMZHW2Zt+BuFmtCvouSw5AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"armeriaThread\"\n        title=\"\"\n        src=\"/static/ee84d55503ee3e11c8d3623ef8b53226/f058b/armeriaThread.png\"\n        srcset=\"/static/ee84d55503ee3e11c8d3623ef8b53226/c26ae/armeriaThread.png 158w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/6bdcf/armeriaThread.png 315w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/f058b/armeriaThread.png 630w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/40601/armeriaThread.png 945w,\n/static/ee84d55503ee3e11c8d3623ef8b53226/129e9/armeriaThread.png 1161w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>궁극적으로는 Socket Programming에 대한 이해가 떨어지는 것 같다.<br>\n네티 인 액션을 정독할 생각이다.</p>","frontmatter":{"title":"1차 트레이닝 프로젝트","date":"December 15, 2022","description":null,"tags":["Armeria","gRPC","HTTP/2"]},"tableOfContents":""},"previous":{"fields":{"slug":"/2022y/iterator/"},"frontmatter":{"title":"Iterator?Enumerator?Iterable?"}},"next":{"fields":{"slug":"/2022y/yearend/"},"frontmatter":{"title":"2022년 회고"}}},"pageContext":{"id":"3b68603f-73f2-5431-aa51-73cc7a6b8543","previousPostId":"ab2f9efb-8a1e-5eca-bee0-b879cc21f54b","nextPostId":"c7aeeb32-24c2-5333-a99d-48a26cddd34b"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}