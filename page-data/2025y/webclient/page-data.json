{"componentChunkName":"component---src-templates-blog-post-js","path":"/2025y/webclient/","result":{"data":{"site":{"siteMetadata":{"title":"ì½”ë”© ì£¼ë¨¸ë‹ˆ"}},"markdownRemark":{"id":"e0b1b946-ea07-5d47-9d52-4627d912ebd9","excerpt":"ë¬¸ì œ ë°œê²¬ ëª¨ë‹ˆí„°ë§ì„ í†µí•´ 1,2ì£¼ ê°„ê²©ìœ¼ë¡œ í•œ ë²ˆì”© PrematureCloseException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤. ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ ì´ˆë‹¹ 300 ~ 40â€¦","html":"<h1 id=\"ë¬¸ì œ-ë°œê²¬\" style=\"position:relative;\">ë¬¸ì œ ë°œê²¬<a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%9C%EA%B2%AC\" aria-label=\"ë¬¸ì œ ë°œê²¬ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>ëª¨ë‹ˆí„°ë§ì„ í†µí•´ 1,2ì£¼ ê°„ê²©ìœ¼ë¡œ í•œ ë²ˆì”© PrematureCloseException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.<br>\nì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ ì´ˆë‹¹ 300 ~ 400íšŒ ì •ë„, ìš”ì²­í•˜ê³  ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠëŠ” ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ë¶€í•˜ê°€ ëª°ë¦´ ë•Œ ë°œìƒí•˜ëŠ” ê²ƒì„ ì¶”ê°€ë¡œ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.</p>\n<p>ì˜ˆì™¸ì˜ ì›ì¸ì„ í™•ì‹¤í•˜ê²Œ ì´í•´í•˜ê¸° ìœ„í•´ WebClientì˜ ì»¤ë„¥ì…˜ í’€ì´ ì–´ë–»ê²Œ ê´€ë¦¬ë˜ëŠ”ì§€ ì •ìƒì ì¸ ì¼€ì´ìŠ¤ë¥¼ ë¨¼ì € í™•ì¸í•´ë³´ì.</p>\n<h1 id=\"webclient-connection-ìƒíƒœ-ë³€í™”\" style=\"position:relative;\">WebClient Connection ìƒíƒœ ë³€í™”<a href=\"#webclient-connection-%EC%83%81%ED%83%9C-%EB%B3%80%ED%99%94\" aria-label=\"webclient connection ìƒíƒœ ë³€í™” permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f2eb4eb48b8b415d28cbf06c49185ad/2d3cc/network-sequence.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAADmklEQVR42n1Va3PdNBDN//8RfOALHQqddtLCDC2FNuRCmlI6+QQ0TW58/X7bkiz5IR+OZS65bVo0c0b2rnS82j1aH4FjECNUrCGIeqfQt+NixjxjnYm0N/CEhNcK7DqNadDQuQ+VBxDJFroI3MojRygnkkk0wQ6Nt0Nfp/RVwFgCU4mhz+FXHrb5e3jlFfzWw6RDqOSC+95CJn9DV4mL4Gj9PsekYNtHgHwCqMf/wapjJNFX8C/voaseYZLHtO39T7jnG1j9J/ZnOTo8WttWkLKB7gQ6dYs8S1EWGZRoUBU5jFbOrrV09nEcsB//Eq6Mdd2SUMOYAcMwESNGzllaIggSCKlQVa3zd50h4YCybEk4fY6wgVKKCzWiKEHgR4ijFEWxRK7QNK3DOI7ohx7WTrRLTNMdwv2RJQl7Eo581g5SGkY0ctMMIbQjWIaVOyriGJn/HZLtQ+IxZjscFGXWGNvnnE6A/heWfsMqb6iAl2iSZyjCH9Ckz1i7F/RvMMvv0edfwmRfQJc/w0ifgU1rhOtgXurfSXABWb5GnZ5BFOdo83Nkwa8oojOUyRnnDW2vUKWvKJ2/YNoLajL7uMprlFkhULcWeTkgyQziVCNONPygJQSipMPWq51/8VHjyAvtcvpBDvcR6uYcXfMavXjjMKi3jOY3RDcvEFz/hGR3wlPs/X9At2/QZKewfXwY4W0OhyWHHXOoT1eYU9pOmL+nyIOnqOMfKeyXB/4NRkGbufmcsDt02q7oeL8JYyakWYUwpLC7HkVJQdOmOuacc140d2WDWTHBHmL/AnnEoojUCXyRiKQuFx2GYUxRN8jzwmlVCMFZ0ld+SOiCm0LU4UMElw+Qbu+hl+8xWZrH0S1ebsJEQ98PUBT4UsTFvswL+SeEvZ65qmqkaeZuSZYWfM4Rx3wPE4ckyZgKjcM9y/v/EAqXR6UM0bnFgtrwd6EjLnn0qqyZ1975tDYuHZ8gXHRkUVcFJDuO7to1f0sz8AMEJAwZ9fXWc8TLx4RY/aXL4aEOJwkR3OedfIB4+zVS7z7Sm2+hVeGqb6c1f8vLxO6jZLe2z8XGoe4e2cLUMUQUoA481P6OjTShom4XuU409kg6iZA9MR8MLN/HltEWIe9yhFGWt0fuG3aX0LDSlMhW8AN3/ykBm+5VmeOauGqpvZ7SiS7RxFeogneQqbf/Baw75+EAdsbHY5gtNGEs5WPt+pnJYB4Nu5J2rWuJ8B+t35bXjKLX7AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"network sequence\"\n        title=\"\"\n        src=\"/static/0f2eb4eb48b8b415d28cbf06c49185ad/1cfc2/network-sequence.png\"\n        srcset=\"/static/0f2eb4eb48b8b415d28cbf06c49185ad/3684f/network-sequence.png 225w,\n/static/0f2eb4eb48b8b415d28cbf06c49185ad/fc2a6/network-sequence.png 450w,\n/static/0f2eb4eb48b8b415d28cbf06c49185ad/1cfc2/network-sequence.png 900w,\n/static/0f2eb4eb48b8b415d28cbf06c49185ad/21482/network-sequence.png 1350w,\n/static/0f2eb4eb48b8b415d28cbf06c49185ad/d61c2/network-sequence.png 1800w,\n/static/0f2eb4eb48b8b415d28cbf06c49185ad/2d3cc/network-sequence.png 3529w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>8080í¬íŠ¸ì˜ ì„œë²„ì—ì„œ 9090í¬íŠ¸ì˜ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  1ì´ˆ í›„ì— ì‘ë‹µí•˜ëŠ” APIë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ë‹¤.<br>\n(keep-alive timeout = 3000ms)</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ea0ecd5cd827df7dd23f51fa247aae4/0ad08/success_network_log.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABP0lEQVR42iWP3UvCcBiF+/8v+4IuIkuzkbp0mzO/m/v4mW6OzMwsJCuhAiXSUst6mvbC4XmuDuddIzi/2UbRi5QMgeW4FMo2tvCoWDV0SUY/kNDDx2Qiy8RWfhqwcCRT1/Is7vssngb8zL9YWxbWm5fI2RxFR2C73oqi4SM8n0Q0hrR7QCx0SCIcRY5IxAMuXTuWsTMFZrc95r0+s+my8Bc6vS4VX9C4a9F+7OIH7AzuuB7ccuZaFEQ5oIm4FFRbVawLC+fCxu24dB9ueBt9MB1/BtN+g8LXV/xsFiUaJWcYGOdVchUDs17DrNVQ0ipyUkZRUyhaEk1XV1TTKbL5DFdNn+/3MYsgTCb/L3uNNknFoFT2MM0mxZKH41zh2C3Se3GUzX3U7QjyeojUVpiTjdDK9R2JtmbAyzMMhzAa8Qe64k2+vcc34QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"success network log\"\n        title=\"\"\n        src=\"/static/5ea0ecd5cd827df7dd23f51fa247aae4/1cfc2/success_network_log.png\"\n        srcset=\"/static/5ea0ecd5cd827df7dd23f51fa247aae4/3684f/success_network_log.png 225w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/fc2a6/success_network_log.png 450w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/1cfc2/success_network_log.png 900w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/21482/success_network_log.png 1350w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/d61c2/success_network_log.png 1800w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/0ad08/success_network_log.png 2978w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>WebClientë¥¼ ìƒì„±í•  ë•Œ metricsë¥¼ í™œì„±í™”í•˜ì—¬ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤.</p>\n<details>\n<summary>ğŸ’¡ WebClient Connection Pool ë¡œê·¸ ìì„¸íˆë³´ê¸°</summary>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">val httpClient = HttpClient.create(connectionProvider)\n    .metrics(true) { uriTagValue -&gt; uriTagValue }\n    .doOnConnected { conn -&gt;\n        conn.channel().closeFuture().addListener {\n            logger.info(&quot;[Connection Closed] : $conn&quot;)\n        }\n        logger.info(&quot;[New Connection] : $conn&quot;)\n    }\n    .doOnConnect { config -&gt;\n        logger.info(&quot;[Connection Attempt] Attempting to connect...&quot;)\n    }\n\nreturn WebClient.builder()\n    .baseUrl(&quot;http://localhost:9090&quot;)\n    .clientConnector(ReactorClientHttpConnector(httpClient))\n    .build()</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Creating a new [my-provider] client pool [PoolFactory{evictionInterval=PT0S, leasingStrategy=fifo, maxConnections=1, maxIdleTime=-1, maxLifeTime=-1, metricsEnabled=false, pendingAcquireMaxCount=2, pendingAcquireTimeout=45000}] for [localhost/&lt;unresolved&gt;:9090]\n[1965a96f] Created a new pooled channel, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[1965a96f] REGISTERED\n[1965a96f] CONNECT: localhost/127.0.0.1:9090\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] Registering pool release on close event for channel\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] Channel connected, now: 1 active connections, 0 inactive connections and 0 pending acquire requests.\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] ACTIVE\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] onStateChange(PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}, [connected])\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=null, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [configured])\n[New Connection] : GET{uri=null, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] Handler is being applied: {uri=http://localhost:9090/internal/delay/1, method=GET}\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [request_prepared])\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] WRITE: 102B GET /internal/delay/1 HTTP/1.1\nuser-agent: ReactorNetty/1.1.22\nhost: localhost:9090\naccept: */*\n\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] FLUSH\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] WRITE: 0B\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] FLUSH\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [request_sent])\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] READ: 142B HTTP/1.1 200 \nContent-Type: text/plain;charset=UTF-8\nContent-Length: 28\nDate: Tue, 23 Sep 2025 06:09:17 GMT\n\n\ndelay api success. seconds=1\n15:09:17.136+09:00 --- [r-http-kqueue-2] r.n.http.client.HttpClientOperations     : [1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] Received response (auto-read:false) : RESPONSE(decodeResult: success, version: HTTP/1.1)\nHTTP/1.1 200 \nContent-Type: &lt;filtered&gt;\nContent-Length: &lt;filtered&gt;\nDate: &lt;filtered&gt;\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [response_received])\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] [terminated=false, cancelled=false, pending=0, error=null]: subscribing inbound receiver\n[1965a96f-1, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] Received last HTTP packet\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [response_completed])\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [disconnecting])\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] Releasing channel\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] Channel cleaned, now: 0 active connections, 1 inactive connections and 0 pending acquire requests.\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] READ COMPLETE\n\n-- 3ì´ˆ ì´í›„ --\n\n[1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090] READ COMPLETE\n[Connection Closed] : GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 ! R:localhost/127.0.0.1:9090]}}\n[1965a96f, L:/127.0.0.1:59768 ! R:localhost/127.0.0.1:9090] INACTIVE\n[1965a96f, L:/127.0.0.1:59768 ! R:localhost/127.0.0.1:9090] onStateChange(PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 ! R:localhost/127.0.0.1:9090]}, [disconnecting])\n[1965a96f, L:/127.0.0.1:59768 ! R:localhost/127.0.0.1:9090] UNREGISTERED</code>\n        </deckgo-highlight-code>\n</details>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5668a456313ea5b13ed9a1731a3afd3d/0a47e/connection-statediagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 280%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAA4CAYAAAD959hAAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFlklEQVR42q1YWXPiZhDk/z/kOQ/JY97zC1KVVGWzW7HXsbEx5r4EAnQiCdBFp/vjCLv4kitUqYTRqtUz09Mz2hqe+ex2O3MejUbYbDao8ql9D7RaRYiiCOtkjdFwDMdxsV6vEYYrZFleDXC73WI+X8KybIwGY9xc3eHhoYXJZIbZbIEgWB0e/G7A1DC0rBl6vZE5+v0x2u0+fD8g0001hpvNFmmanf5W6Hm+DzPLMsRxUh1QN+6Zxgx1anIooDwvqgMqpDRNmasQA4ba7Q7RavUwHk8N0yiKqwGK3SqMkJBJwirrrGrru36vzFCfnNIQsBipOCpSURTImNvda+V9CdBxPNj2ktUd4fr6Dvf3T7Apmel0TuCyGmBZloiZJ2lRUul2Bmg+ttGnfJRXMa0MqHyVvFFV9TzfFEq/qyAfBlT+dLasKVzXMy0Xx7F5SDXAYg+oFuv1huh0B2g9db8pzgfMITbhRYdzHCUmr57rVwc0ssn3slFF5/O5AVWoCruybMRO8pjPHbrLDPW7Bh4fO4e/F3CW3utW8z2g8ue6AQaDCYbDCRqNNjqUjvIpbYbh23m86GVVU5pTEcYjCy6FriKZvL5DOt8AHl1F8tEnCAKkWXaKUteLvKgWsg7lSy7dbHaM66hTlN8kSd7U4gVDhbpYuKZ/zWEvYE1sM1N0rRKg3ProiZKP8qnvkpHMV9d2VaosramSEcXseAFDbnPyTUy4YifQd+nw+NCQ1XQd32ix+dSjdTXN1JOE1CmytvINC3u2ysuFYyTT6fSNBjUCFHYSr6sX5VxnYRiepp65Hn1QNr4fmmM8trBg2ykNMdnFVYWtKkoeo6HFiTcwE+/o3GacRslHOiU/M4vV/xOyejYIIrLsm/miB0ky8shKDAUm6ag72gy3Xm+iQdlIRkqFjkqAy6VzchaxOh4StRxIC9PRON4EVJtpD1RriYUOfT+2mlY9XX+3Y59vWudFEtuE1V9SOsrp8TeF/xzbM4Zy4/8AxXC/fM7RH1i4vW/j+uqWUupTnzM6kmN6/kVA5SnLzwHLfe4o8MWhFQdcT7Tdqq+jgz9eACpDUdBG9/FXjHu/MWfFiaEYaFdU/hSqxC1HkoT0+3PbmAF07L/Ruv0RrfovBEr3gGcLpuoir/R9/zS/jw+8DFmVZHJ3pWZJcapqoQWTYc2mNoacgtLlzde6aUPZmeS1Poasew731V4qvxjIWEOy9Hn2aLxL5s5XXmXCMov4Uka1wnFQeC7KMNgfqxClRyMNfCy7Xfj9ASIuTavhENF0iogLwMq2MW+1sbEslHMbwshnU60dqGWdNtK7W2zv/kHafNwfjXtk93X4Xz5j/fUKebuFjNfz+zvkjw8ou22smw/Ie11kjQcDCr1yCDDnU/PxCAWfUNgzc855LnmsWk9IJ2PzW0o2/ue/EBM86XYwaTbhk2nK2b1hsbZsDOWx9lobnXePx5sn1OCEI7XVGeLTpytcfblBn75pcYaP2UVbOnztVKHvDwGaEZCpQvCZu5hupAqr0n3zljVCiwa85PDyWbCEuX+TobGrXcnwuLSXe4kdzVeDixf380frM0OvPf96y5065Fo367L1mFveGHBXzNmOe0vbr8s+Z7f8M2MThHoXfInhrszQqf+Emz9/QL/xM5KVi9XSpfaSfcgcrdp7Ogy3Xn/EnL0evMZQthS4TQTOA//hE7LthgwXJuRz//xm5L4GePmEAgFzKDeSAyns2cw2Dq4W3LLPQ++VkI/9qVyapJNJSIYrGqu2CoX6x++fTW9PuFUsmQ5fb/5vVfksqUY2cm5JJyRLScWjVyqva9qZR9DEdd8BeNDkhkPKU2UZutg6E8t0ilLhz3S2UVIN72N4xGbopemcHRYE2JItZH0aHQd9VgI8/y8Yl52RZtmFff0LlesAr1g4x00AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connection statediagram\"\n        title=\"\"\n        src=\"/static/5668a456313ea5b13ed9a1731a3afd3d/0a47e/connection-statediagram.png\"\n        srcset=\"/static/5668a456313ea5b13ed9a1731a3afd3d/3684f/connection-statediagram.png 225w,\n/static/5668a456313ea5b13ed9a1731a3afd3d/fc2a6/connection-statediagram.png 450w,\n/static/5668a456313ea5b13ed9a1731a3afd3d/0a47e/connection-statediagram.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ë¡œê·¸ì™€ ë‹¤ì´ì–´ê·¸ë¨ì„ í†µí•´ Connectionì˜ ìƒíƒœê°€ ë³€í™”ë˜ëŠ” ë‹¨ê³„ë¥¼ í™•ì¸í•´ë³¼ ìˆ˜ ìˆì—ˆë‹¤.<br>\nì´ì œ PrematureCloseExceptionì´ ë°œìƒí•˜ëŠ” ì›ì¸ì— ëŒ€í•´ ë” ìì„¸í•˜ê²Œ í™•ì¸í•´ë³´ì.</p>\n<h1 id=\"prematurecloseexceptionì´-ë°œìƒí•˜ëŠ”-ì¼€ì´ìŠ¤\" style=\"position:relative;\">PrematureCloseExceptionì´ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤<a href=\"#prematurecloseexception%EC%9D%B4-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%BC%80%EC%9D%B4%EC%8A%A4\" aria-label=\"prematurecloseexceptionì´ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code class=\"language-text\">HttpClientOperations.onInboundClose()</code>ëŠ” ì›ê²© ì„œë²„ì—ì„œ FIN íŒ¨í‚·ì„ ë³´ë‚´ì–´ ìˆ˜ì‹  ì„œë²„ì—ì„œ EOF ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ì—°ê²°ì„ ë‹«ëŠ” ê²½ìš° í˜¸ì¶œëœë‹¤.</p>\n<ol>\n<li>(í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ macì´ë¼ì„œ) KQueueEventLoop ì—ì„œ FIN íŒ¨í‚·ì„ EV_EOF ì´ë²¤íŠ¸ë¡œ ê°ì§€</li>\n<li>EV_EOF ì´ë²¤íŠ¸ë¡œ ì¸í•´ EOF ì²˜ë¦¬, Half-closure ì„¤ì •ì— ë”°ë¼ ì…ë ¥ë§Œ ì¢…ë£Œ ë˜ëŠ” ì „ì²´ ì¢…ë£Œ ê²°ì •</li>\n<li>Channel inputShutdown í”Œë˜ê·¸ ì„¤ì • + ì‹œìŠ¤í…œ ë ˆë²¨ ì†Œì¼“ ìˆ˜ì‹  ë¶€ë¶„ ì¢…ë£Œ</li>\n<li>ì‹¤ì œ ì†Œì¼“ fd ë‹«ê¸° + closeInitiated í”Œë˜ê·¸ ì„¤ì •</li>\n<li>channelInactive ì´ë²¤íŠ¸ê°€ íŒŒì´í”„ë¼ì¸ í†µí•´ ì „íŒŒ EventLoopì—ì„œ ì±„ë„ ë“±ë¡ í•´ì œ</li>\n<li><strong>ChannelHandler.channelInactive() í”„ë¡œí† ì½œë³„ ì •ë¦¬ ì‘ì—…ì—ì„œ onInboundClose() í˜¸ì¶œ</strong> -> HTTP í”„ë¡œí† ì½œ ë ˆë²¨ì—ì„œ ì–´ë–¤ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆëŠ”ì§€ êµ¬ë¶„í•´ì„œ ì ì ˆí•œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e0e7f9a29c48c31fdd0971949c15ba2f/fe7a3/onInboundClose.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVR42m1S7W7bMAz0W2xtYsu2vizHi/xtt07cBh2QAkP/7P3f5XZyAgTY9uNAiiKPPEqRVhq+cihdhaLqYH+0sEUJbUooUyBXBlmmN6SZQn73hciR3CFSiafnBE07IEp4yKWBP3q4soINxMUBh6qGox9IlS4gld3ItSxgpCO5/D+h4EWYxrBIa0ewwDooNpG5vsWMg1UlrCw3K9LHdP8S8qC0RdsMaOsB3jeUfkTGiVKSplIjodQkfWBPwr14ICbHt10CHwhjTpgxqWVhbyx6yg3wJKtJ6nMJtxd/Ib0hvtkyzqC/77DUHaKKsj6THGcWL/aAM/f2QsKRu5ood2B84O562n6zBoO+x9i0pz9yEM+BfvEdIp8bfJHwQ1qcmHDmxTuJ30l6IfnK5EUbLMbgdPdP1uCVeNMaPyn/lTVTkuGr7REZyp2ExMjH6Jjc8wEGW26de8aC3/GlW5J1/GINFfXK0XeYqaLe9quxexZouhFRwYU2nGzl35sp64UyA2ZKmtg5xGYST8EybyDhGEB/pLqaOQGHWODS8VEuHPUqMlx0ias94rM44kpcSLKycOUnXrmONTSlXXJFSCxSbvbM88rmc5LidzfiD2XNJlv0V0AGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"onInboundClose\"\n        title=\"\"\n        src=\"/static/e0e7f9a29c48c31fdd0971949c15ba2f/1cfc2/onInboundClose.png\"\n        srcset=\"/static/e0e7f9a29c48c31fdd0971949c15ba2f/3684f/onInboundClose.png 225w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/fc2a6/onInboundClose.png 450w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/1cfc2/onInboundClose.png 900w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/21482/onInboundClose.png 1350w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/d61c2/onInboundClose.png 1800w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/fe7a3/onInboundClose.png 8106w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<ol>\n<li>ìš”ì²­ í—¤ë” ì „ì†¡</li>\n<li>ìš”ì²­ ë°”ë”” ì „ì†¡   â† ì—¬ê¸°ì„œ ë‹«íˆë©´ <code class=\"language-text\">\"while sending request body\"</code> <strong>ì•„ì§ ìš”ì²­ë„ ì™„ì „íˆ ëª» ë³´ë‚¸ ìƒíƒœ</strong></li>\n<li>ìš”ì²­ ì™„ë£Œ</li>\n<li>ì„œë²„ ì²˜ë¦¬ ì¤‘     â† ì—¬ê¸°ì„œ ë‹«íˆë©´ <code class=\"language-text\">\"BEFORE response\"</code> <strong>ìš”ì²­ì€ ë³´ëƒˆì§€ë§Œ ì‘ë‹µì„ ì•„ì§ ëª» ë°›ì€ ìƒíƒœ</strong></li>\n<li>ì‘ë‹µ í—¤ë” ìˆ˜ì‹ </li>\n<li>ì‘ë‹µ ë°”ë”” ìˆ˜ì‹    â† ì—¬ê¸°ì„œ ë‹«íˆë©´ <code class=\"language-text\">\"DURING response\"</code> <strong>ì‘ë‹µì„ ë°›ê¸° ì‹œì‘í–ˆì§€ë§Œ ì‘ë‹µì´ ì™„ì „íˆ ì•ˆ ì˜¨ ìƒíƒœ</strong></li>\n<li>ì‘ë‹µ ì™„ë£Œ</li>\n</ol>\n</blockquote>\n<h2 id=\"1-while-sending-request-body\" style=\"position:relative;\">1. while sending request body<a href=\"#1-while-sending-request-body\" aria-label=\"1 while sending request body permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>í´ë¼ì´ì–¸íŠ¸ ì„œë²„ê°€ ìš”ì²­ì„ ë³´ë‚´ê³  ìˆëŠ” ê²½ìš° ì»¤ë„¥ì…˜ì´ ë‹«íˆë©´ ë°œìƒí•œë‹¤.</p>\n<h2 id=\"2-before-response\" style=\"position:relative;\">2. BEFORE response<a href=\"#2-before-response\" aria-label=\"2 before response permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>ì†¡ì‹  ì„œë²„ì™€ ìˆ˜ì‹  ì„œë²„ê°€ ì—°ê²°ëœ ì´í›„ì— ìˆ˜ì‹  ì„œë²„ê°€ ì¼ë°©ì ìœ¼ë¡œ ì»¤ë„¥ì…˜ì„ ë‹«ëŠ” ê²½ìš°ë‹¤.<br>\nì¦‰, ChannelActive ìƒíƒœê¹Œì§€ ë„ë‹¬í•œ í›„ í´ë¼ì´ì–¸íŠ¸ê°€ ì‘ë‹µì„ ëŒ€ê¸°í•˜ê³  ìˆì§€ë§Œ ì„œë²„ê°€ í•´ë‹¹ ì±„ë„ì„ ë‹«ì•„ë²„ë¦¬ëŠ” ê²½ìš°ì´ë‹¤.</p>\n<details>\n<summary>ğŸ’¡ Netty ì˜ˆì œ ì½”ë“œ ë° ë¡œê·¸ ìì„¸íˆ ë³´ê¸°</summary>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">fun main() {\n    val parentGroup = NioEventLoopGroup()\n    val workerGroup = NioEventLoopGroup()\n\n    try {\n        ServerBootstrap()\n            .group(parentGroup, workerGroup)\n            .channel(NioServerSocketChannel::class.java)\n            .childHandler(object : ChannelInitializer&lt;SocketChannel&gt;() {\n                override fun initChannel(ch: SocketChannel) {\n                    ch.pipeline().addLast(RudeServerHandler())\n                }\n            })\n            .bind(8080).sync()\n            .channel().closeFuture().sync()\n    } finally {\n        parentGroup.shutdownGracefully()\n        workerGroup.shutdownGracefully()\n    }\n}\n\nprivate class RudeServerHandler : ChannelInboundHandlerAdapter() {\n\n    private val logger = org.slf4j.LoggerFactory.getLogger(this::class.java)\n\n    override fun channelRegistered(ctx: ChannelHandlerContext) {\n        logger.info(&quot;[REGISTERED] Channel registered: ${ctx.channel()}&quot;)\n        super.channelRegistered(ctx)\n    }\n\n    override fun channelUnregistered(ctx: ChannelHandlerContext) {\n        logger.info(&quot;[UNREGISTERED] Channel unregistered: ${ctx.channel()}&quot;)\n        super.channelUnregistered(ctx)\n    }\n\n    override fun channelActive(ctx: ChannelHandlerContext) {\n        logger.info(&quot;[ACTIVE] Channel active (connected): ${ctx.channel()}&quot;)\n        super.channelActive(ctx)\n    }\n\n    override fun channelInactive(ctx: ChannelHandlerContext) {\n        logger.info(&quot;[INACTIVE] Channel inactive (disconnected): ${ctx.channel()}&quot;)\n        super.channelInactive(ctx)\n    }\n\n    override fun channelRead(ctx: ChannelHandlerContext, msg: Any) {\n        logger.info(&quot;[READ] Data received from client: ${ctx.channel()}&quot;)\n        logger.info(&quot;[READ] Message content: ${msg}&quot;)\n\n        // ë°ì´í„°ë¥¼ ë°›ìë§ˆì ì¦‰ì‹œ ì—°ê²°ì„ ëŠìŒ (FIN íŒ¨í‚· ì „ì†¡)\n        ctx.close()\n        logger.info(&quot;[READ] Connection close initiated&quot;)\n    }\n\n    override fun channelReadComplete(ctx: ChannelHandlerContext) {\n        logger.info(&quot;[READ_COMPLETE] Channel read complete: ${ctx.channel()}&quot;)\n        super.channelReadComplete(ctx)\n    }\n}</code>\n        </deckgo-highlight-code>\n</details>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">[REGISTERED] Channel registered: [id: 0x19ba8155, L:/127.0.0.1:8080 - R:/127.0.0.1:58625]\n[ACTIVE] Channel active (connected): [id: 0x19ba8155, L:/127.0.0.1:8080 - R:/127.0.0.1:58625]\n[READ] Data received from client: [id: 0x19ba8155, L:/127.0.0.1:8080 - R:/127.0.0.1:58625]\n[READ] Message content: PooledUnsafeDirectByteBuf(ridx: 0, widx: 159, cap: 2048)\n[READ] Connection close initiated\n[READ_COMPLETE] Channel read complete: [id: 0x19ba8155, L:/127.0.0.1:8080 ! R:/127.0.0.1:58625]\n[INACTIVE] Channel inactive (disconnected): [id: 0x19ba8155, L:/127.0.0.1:8080 ! R:/127.0.0.1:58625]\n[UNREGISTERED] Channel unregistered: [id: 0x19ba8155, L:/127.0.0.1:8080 ! R:/127.0.0.1:58625]</code>\n        </deckgo-highlight-code>\n<ol>\n<li><code class=\"language-text\">ChannelRegistered</code> : Channel ì´ Event Loopì— ë“±ë¡ë¨</li>\n<li><code class=\"language-text\">ChannelActive</code> : Channelì´ í™œì„±í™”ë¨, ì´ì œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŒ</li>\n<li><code class=\"language-text\">Channellnactive</code> : Channelì´ ì›ê²© í”¼ì–´ë¡œ ì—°ê²°ë˜ì§€ ì•ŠìŒ</li>\n<li><code class=\"language-text\">ChannelUnregistered</code>: Channelì´ ìƒì„±ëì§€ë§Œ Event Loopì— ë“±ë¡ë˜ì§€ ì•ŠìŒ</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0021a9ec656e7946c29270483c4b3a9c/60708/beforeResponse.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAlUlEQVR42h3KywqCQACFYZ+/G0FEEJlpRQiRpaMRWU0tLEbLZkoJyoXZe5xGFz/nWxxluMzQMxOoiw9UK4NBCvTnL4zJT/oL3c7RnQl0phztyQONEUdNi9EyBOraHU2dVx5YOcxNAeV0DOGuKShlKB2xJ3w/wDVMwC4C5yCGTfayHTz5K3flbOF6h8qOjEjfohSpeOMPuld/EmQl+bUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"beforeResponse\"\n        title=\"\"\n        src=\"/static/0021a9ec656e7946c29270483c4b3a9c/1cfc2/beforeResponse.png\"\n        srcset=\"/static/0021a9ec656e7946c29270483c4b3a9c/3684f/beforeResponse.png 225w,\n/static/0021a9ec656e7946c29270483c4b3a9c/fc2a6/beforeResponse.png 450w,\n/static/0021a9ec656e7946c29270483c4b3a9c/1cfc2/beforeResponse.png 900w,\n/static/0021a9ec656e7946c29270483c4b3a9c/21482/beforeResponse.png 1350w,\n/static/0021a9ec656e7946c29270483c4b3a9c/d61c2/beforeResponse.png 1800w,\n/static/0021a9ec656e7946c29270483c4b3a9c/60708/beforeResponse.png 2872w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ì†¡ì‹  ì„œë²„ (í´ë¼ì´ì–¸íŠ¸)ëŠ” reactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE response ì˜ˆì™¸ë¥¼ ì „ë‹¬ë°›ì§€ë§Œ íŒ¨í‚·ìƒìœ¼ë¡œëŠ” ì •ìƒì ì¸ í†µì‹ ì´ ì™„ë£Œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>\n<h2 id=\"3-during-response\" style=\"position:relative;\">3. DURING response<a href=\"#3-during-response\" aria-label=\"3 during response permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>ì†¡ì‹  ì„œë²„ê°€ ìˆ˜ì‹  ì„œë²„ì—ê²Œ í—¤ë”ë¥¼ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µë°›ê³  ë°”ë””ë¥¼ ëŒ€ê¸°í•˜ëŠ” ë„ì¤‘ ì»¤ë„¥ì…˜ì´ ì†¡ì‹  ì„œë²„ê°€ ì»¤ë„¥ì…˜ì„ ì¼ë°©ì ìœ¼ë¡œ ë‹«ëŠ” ê²½ìš°ì´ë‹¤.<br>\nì¦‰ ì†¡ì‹  ì„œë²„ê°€ í—¤ë”ë¥¼ ì •ìƒì ìœ¼ë¡œ ë°›ê³  ë°”ë””ë¥¼ ì™„ì „íˆ ë°›ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ì¤‘ì— ìˆ˜ì‹  ì„œë²„ê°€ ì¼ë°©ì ìœ¼ë¡œ ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•˜ëŠ” ê²½ìš°ì´ë‹¤.</p>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">@GetMapping(&quot;/abort-connection&quot;)\nfun abortConnection(response: HttpServletResponse) {\n    logger.info(&quot;Starting abort connection...&quot;)\n    \n    try {\n        val writer = response.writer\n        \n        // ì‘ë‹µ ë°ì´í„°ë¥¼ í•œ ë²ˆ ì „ì†¡í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì½ê¸° ì‹œì‘í•˜ë„ë¡ ìœ ë„\n        writer.write(&quot;Starting response...&quot;)\n        writer.flush()\n\n        Thread.sleep(100)\n\n        // ì¼ë°©ì ìœ¼ë¡œ ì¢…ë£Œ! FIN íŒ¨í‚· ì „ë‹¬\n        response.outputStream.close()\n\n        writer.write(&quot;This should not be sent&quot;)\n        \n    } catch (e: IOException) {\n        logger.error(&quot;IOException during abort: ${e.message}&quot;)\n    }\n}</code>\n        </deckgo-highlight-code>\n<details>\n<summary>ğŸ’¡ WebClient Connection Pool ë¡œê·¸ ìì„¸íˆë³´ê¸°</summary>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Creating a new [my-provider] client pool [PoolFactory{evictionInterval=PT0S, leasingStrategy=fifo, maxConnections=1, maxIdleTime=-1, maxLifeTime=-1, metricsEnabled=false, pendingAcquireMaxCount=2, pendingAcquireTimeout=45000}] for [localhost/&lt;unresolved&gt;:9090]\n[551113d8] Created a new pooled channel, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[551113d8] REGISTERED\n[551113d8] CONNECT: localhost/127.0.0.1:9090\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Registering pool release on close event for channel\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Channel connected, now: 1 active connections, 0 inactive connections and 0 pending acquire requests.\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] ACTIVE\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}, [connected])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=null, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [configured])\n[New Connection] : GET{uri=null, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Handler is being applied: {uri=http://localhost:9090/force/abort-connection, method=GET}\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [request_prepared])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] WRITE: 108B GET /force/abort-connection HTTP/1.1\nuser-agent: ReactorNetty/1.1.22\nhost: localhost:9090\naccept: */*\n\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] FLUSH\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] WRITE: 0B\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] FLUSH\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [request_sent])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] READ: 108B HTTP/1.1 200 \nTransfer-Encoding: chunked\nDate: Sat, 27 Sep 2025 05:28:01 GMT\n14\nStarting response...    // ì²« ë²ˆì§¸ ì²­í‚¹ ë°ì´í„° ì •ìƒì ìœ¼ë¡œ ì‘ë‹µë°›ìŒ\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Received response (auto-read:false) : RESPONSE(decodeResult: success, version: HTTP/1.1)\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [response_received])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] [terminated=false, cancelled=false, pending=0, error=null]: subscribing inbound receiver\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] READ COMPLETE\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] READ COMPLETE\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] Channel closed, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[Connection Closed] : GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090]}}\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] INACTIVE\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090]}}, [response_incomplete])\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] UNREGISTERED\nServlet.service() for servlet [dispatcherServlet] in context with path [] threw exception \n[Request processing failed: org.springframework.web.reactive.function.client.WebClientResponseException: 200 OK from GET http://localhost:9090/force/abort-connection, \nbut response failed with cause: reactor.netty.http.client.PrematureCloseException: Connection prematurely closed DURING response] with root cause</code>\n        </deckgo-highlight-code>\n</details>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ff6649ca3efa0906969b2bcf54dd3e52/d9ed5/duringResponse.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.44444444444445%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42h2Q2Y7TQBBF/feDeOCBRTzAMNIgFAmJJcRx7MRxvLsd2x07jj1LMgogtr841PTD0a1WVd2+3VZaN3hxQlLXBj0MBIVCjyPbbk8puNK3g5BFFOPnGas8ZV3kLNMEX9QTLdqWuu+x0qrB2UREZWXQhwE/zdG9GLZ7lO6YS3+6WjMX05m/McaPIZwwlMti0Yi4qskajbXdHVlFDaq5o9T3jLe/SdTBaDf8YNef8WONu9maOXdTmdpPNF64NbWzVtTtifvTP6w4vcH2KsJ4IEpGqurMKuio6u+o8oFcHXGWDVNHYbsVs8WWz7PM1N/miqmt+GLnsj9Sy451NT3zctLz5tNJeODa/sPrj7dG39u/ePf1J68mA8+udzK35/mHjou3NU+vOp5c7ri41IYXkzvZ+SsJE/n0ZUkYtQalblgHjdE8H8iyA95KnuUpFjL3iL3IWcjZ8QpJmjN3C/xAS8Ij/wELcYjpVb2JLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"duringResponse\"\n        title=\"\"\n        src=\"/static/ff6649ca3efa0906969b2bcf54dd3e52/1cfc2/duringResponse.png\"\n        srcset=\"/static/ff6649ca3efa0906969b2bcf54dd3e52/3684f/duringResponse.png 225w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/fc2a6/duringResponse.png 450w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/1cfc2/duringResponse.png 900w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/21482/duringResponse.png 1350w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/d61c2/duringResponse.png 1800w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/d9ed5/duringResponse.png 2880w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"ì»¤ë„-tcp-ì†Œì¼“-ìƒíƒœì—-ë”°ë¥¸-ì²˜ë¦¬\" style=\"position:relative;\">ì»¤ë„ TCP ì†Œì¼“ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬<a href=\"#%EC%BB%A4%EB%84%90-tcp-%EC%86%8C%EC%BC%93-%EC%83%81%ED%83%9C%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%B2%98%EB%A6%AC\" aria-label=\"ì»¤ë„ tcp ì†Œì¼“ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>ì´ë•Œê¹Œì§€ ì •ìƒì ì¸ ì¢…ë£Œì¸ FIN íŒ¨í‚·ë§Œ ë³´ì•˜ëŠ”ë°, 4-way handshake ì¤‘ì— í•´ë‹¹ ì»¤ë„¥ì…˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¬ì „ì†¡í•˜ê²Œ ë˜ë©´ RST íŒ¨í‚·ì„ ì „ì†¡í•˜ê²Œ ë˜ëŠ” ê²½ìš°ë„ ìˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fcb9f339dfde65490a7ecb3b01faf28a/9a1cf/4way-handshake.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVR42m1Sa3ObMBDk//+zfmrS5otjM1OIjYTAoPcTRNdo4glNd2yNpNPe7t1Rrevq7ajlTUyt4o2cG6evwasNyOuWc15z0JoTwpqGU4pV9cxrnbetWpY1eKbFhXWvd/ZGrj+DrWMQ287Gf1nXqLUmHT1f+PXW17WmNBqDtJUxVvBxGq987tRMghq8pEv023BfT3V+rzfKYgiQitbKaXJaO6Wi98hbzfPcM0YI7dmAJI5LL1RUJkm1GRO56P989FcSHker71OCVYg+bOVqX3d7y+L3fAj7GKz3xpqBq9dz87v+0D4gZK1Fj7ZPVPkTuI0xbkes64LLFGHZonDG2LhjmibOefXl3ZOcY0qTUOMsQlqeoRBC4aBSrEqpA7nYBlxMNRl/Xdq70CmGlFJxCz5ocCGlfNj+TsZTbPphxM+h1Jwh65wrziml0O/7Hu8rQsjtdmvbFmcEjDEpRW1sTe4v55ZOwhjtvEfGhyPnDg3DAQE0DGowgw2OeCSEVFoXzhMQx1CeA6pAgDKcdF0HZbQBWcoLzBMNCzGVceAGvg7KyA0CUmAVQsQduMTasOnH23s78K/KB/JzBzXEiqVSi7Z2FlIoFXb8R/n7F/YPSjuA0mrUeDqdyqj+Aia9YZP7zMFVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4way handshake\"\n        title=\"\"\n        src=\"/static/fcb9f339dfde65490a7ecb3b01faf28a/1cfc2/4way-handshake.png\"\n        srcset=\"/static/fcb9f339dfde65490a7ecb3b01faf28a/3684f/4way-handshake.png 225w,\n/static/fcb9f339dfde65490a7ecb3b01faf28a/fc2a6/4way-handshake.png 450w,\n/static/fcb9f339dfde65490a7ecb3b01faf28a/1cfc2/4way-handshake.png 900w,\n/static/fcb9f339dfde65490a7ecb3b01faf28a/9a1cf/4way-handshake.png 924w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>Active Closerì˜ ì •ìƒì ì¸ ìƒíƒœ ì§„í–‰</strong> ESTABLISHED â†’ FIN_WAIT1 â†’ FIN_WAIT2 â†’ TIME_WAIT â†’ CLOSE</p>\n<ol>\n<li><code class=\"language-text\">FIN-WAIT-1</code>: ì›ê²© TCP í”¼ì–´ì˜ ì—°ê²° ì¢…ë£Œ ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ê±°ë‚˜, ìì‹ ì´ ë³´ë‚¸ ì¢…ë£Œ ìš”ì²­ì— ëŒ€í•œ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ</li>\n<li><code class=\"language-text\">CLOSE-WAIT</code>: ì‘ìš©í”„ë¡œê·¸ë¨ì´ ë” ì´ìƒ ë°ì´í„° ì†¡ìˆ˜ì‹ ì´ í•„ìš” ì—†ë‹¤ê³  close() ë˜ëŠ” ì—°ê²° ì¢…ë£Œ(ì¢…ë£Œ ê´€ë ¨ API í˜¸ì¶œ ë“±)ë¥¼ ì‹¤í–‰í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœë¥¼ ì˜ë¯¸ (ì—°ê²° ì¢…ë£Œ ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ)</li>\n<li><code class=\"language-text\">FIN-WAIT-2</code>: ì›ê²© TCP í”¼ì–´ì˜ ì—°ê²° ì¢…ë£Œ ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ</li>\n<li><code class=\"language-text\">LAST-ACK</code>: ì›ê²© TCP í”¼ì–´ì—ê²Œ ë³´ë‚¸ ì¢…ë£Œ ìš”ì²­ì— ëŒ€í•œ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ</li>\n<li><code class=\"language-text\">TIME-WAIT</code>: ìƒëŒ€ë°©ì´ ì¢…ë£Œ ìš”ì²­ì— ëŒ€í•œ ìŠ¹ì¸ì„ ìˆ˜ì‹ í–ˆìŒì„ í™•ì‹¤íˆ í•˜ê³ , <strong>ì´ì „ ì—°ê²°ì—ì„œ ì§€ì—°ëœ ì„¸ê·¸ë¨¼íŠ¸ê°€ ìƒˆ ì—°ê²°ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ ì¼ì • ì‹œê°„ ëŒ€ê¸°í•˜ëŠ” ìƒíƒœ</strong></li>\n<li><code class=\"language-text\">CLOSED</code>: ì—°ê²°ì´ ì™„ì „íˆ ì—†ëŠ” ìƒíƒœ</li>\n</ol>\n<p><a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_ipv4.c#L1905\">tcp_ipv4.c <code class=\"language-text\">tcp_v4_do_rcv(...)</code></a>í•¨ìˆ˜ë¥¼ ë³´ë©´ ì†Œì¼“ì´ <code class=\"language-text\">TCP_ESTABLISHED</code> ìƒíƒœê°€ ì•„ë‹Œ ê²½ìš° <code class=\"language-text\">tcp_rcv_state_process(...)</code>ë¥¼ í†µí•´ ì²˜ë¦¬í•œë‹¤.</p>\n<deckgo-highlight-code language=\"c\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">int tcp_v4_do_rcv(struct sock *sk, struct sk_buff *skb)\n{\n    enum skb_drop_reason reason;\n    struct sock *rsk;\n\n    // 1. ìˆ˜ì‹ ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©ì ì˜ì—­ì— ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ìƒíƒœì¸ ê²½ìš°\n    if (sk-&gt;sk_state == TCP_ESTABLISHED) { /* Fast path */\n        // ...\n        tcp_rcv_established(sk, skb);\n        return 0;\n    }\n\n    // 2. ì—°ê²° ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœì¸ ê²½ìš°\n    if (sk-&gt;sk_state == TCP_LISTEN) {\n        // ...\n    } else\n        sock_rps_save_rxhash(sk, skb);\n\n    // 3. ê·¸ ì™¸ì˜ ìƒíƒœì¸ ê²½ìš°\n    reason = tcp_rcv_state_process(sk, skb);\n    if (reason) {\n        rsk = sk;\n        goto reset;\n    }\n    return 0;\n\n// RST íŒ¨í‚· ì „ì†¡\nreset:\n    tcp_v4_send_reset(rsk, skb, sk_rst_convert_drop_reason(reason));\n\ntcp_rcv_state_process(struct sock *sk, struct sk_buff *skb)\n{\n    ... (ì¤‘ëµ) ...\n    switch (sk-&gt;sk_state) {\n    case TCP_CLOSE:\n        ... (ì¤‘ëµ) ...\n\n    case TCP_LISTEN:\n        if (th-&gt;ack)\n            return 1;\n\n        if (th-&gt;rst) {\n            ... (ì¤‘ëµ) ...\n        }\n        if (th-&gt;syn) {\n            ... (ì¤‘ëµ) ...\n        }\n        goto discard;\n\n    case TCP_SYN_SENT:\n        ... (ì¤‘ëµ) ...\n        return 0;\n    }\n    ... (ì¤‘ëµ) ...\n\n    switch (sk-&gt;sk_state) {\n    case TCP_SYN_RECV:\n        ... (ì¤‘ëµ) ...\n    case TCP_FIN_WAIT1:\n    case TCP_FIN_WAIT2:\n        if (sk-&gt;sk_shutdown &amp; RCV_SHUTDOWN) {\n            // ì„œë²„ê°€ close()ë¥¼ í˜¸ì¶œí–ˆìœ¼ë¯€ë¡œ RCV_SHUTDOWNì´ ì„¤ì •ë¨\n            if (TCP_SKB_CB(skb)-&gt;end_seq != TCP_SKB_CB(skb)-&gt;seq &amp;&amp;\n                after(TCP_SKB_CB(skb)-&gt;end_seq - th-&gt;fin, tp-&gt;rcv_nxt)) {\n                // ë°ì´í„°ê°€ í¬í•¨ëœ íŒ¨í‚·ì´ë©´\n                NET_INC_STATS(sock_net(sk), LINUX_MIB_TCPABORTONDATA);\n                tcp_reset(sk, skb);  // â† RST ì „ì†¡!\n                return SKB_DROP_REASON_TCP_ABORT_ON_DATA;\n            }\n        }\n        ... (ì¤‘ëµ) ...\n    case TCP_CLOSING:\n        ... (ì¤‘ëµ) ...\n    case TCP_LAST_ACK:\n        ... (ì¤‘ëµ) ...\n    }\n}</code>\n        </deckgo-highlight-code>\n<ol>\n<li>TCP_FIN_WAIT1, TCP_FIN_WAIT2 ìƒíƒœ : ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ ì¦‰ì‹œ RST íŒ¨í‚· ì „ì†¡</li>\n<li>TCP_TIME_WAIT ìƒíƒœ : RST íŒ¨í‚· ì „ì†¡ <a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_minisocks.c#L99\">tcp_minisocks.c#L99</a>\n<ul>\n<li>TIME_WAITì€ ë§ˆì§€ë§‰ ACKê°€ ìœ ì‹¤ë  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ìƒëŒ€ë°©ì´ FINì„ ì¬ì „ì†¡í•˜ëŠ” ê²½ìš° ëŒ€ì‘í•˜ê¸° ìœ„í•œ ìƒíƒœì´ë‹¤.</li>\n</ul>\n</li>\n</ol>\n<h1 id=\"ì›ì¸\" style=\"position:relative;\">ì›ì¸<a href=\"#%EC%9B%90%EC%9D%B8\" aria-label=\"ì›ì¸ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/426261f739ff0c2e9925d9b256aae296/7c1cd/timeout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuUlEQVR42oVS227TQBDNtyLxH7zxhPgEitQHnkEUibwAEhIVAdI6obXj2F4bO3jje9L4lvVhdu0mKUJirLPy7OyembMzIwiBjrDnIVr/F/ZrDnRdj1PrhFzwPxuJokBjL1GbBhrHQr0wILJ04KBkRNwdyLuD30MM6PoYfSORZRA2g3B9tMxB49J/EKCj/WNxe4jQQFdtDsR/mxiIR9K5ZBcY6+e4WX3Btf8R+mqCPEmw2RTgSYbEmKA5f4xq/BwJXyHNc/hegDn7hneLM0yDT/gZXioowgvjDK+0Z7hNvoIVN0i3EZjrwqNqb00b1ufXqF4+QvHmKRazH1hYFq6+X+PD9C1eTJ9gEoyxTK+Q7H73hNKqssLSNhGs/F7U8C5KTlPiTnuPmtuD4qPksiwpOVN3D5Kl5STDth3EUXxCeLS9bMI/ulrXFRhzwRz2kLBtWwTUjIK6ntD7xXGskKYpUvJNwwAPQ+WfxrM8A6dR2263/dicZtvtdliv1+qg4zgqQRRFCvLCPVFIxKZpKlUyxjmncRYPCe8lutQMeVjXdQWLGuB5nqpc0zQVk3sy4Xw+V7HZbKbeUhL+AVgX9OGkHTBxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"timeout\"\n        title=\"\"\n        src=\"/static/426261f739ff0c2e9925d9b256aae296/7c1cd/timeout.png\"\n        srcset=\"/static/426261f739ff0c2e9925d9b256aae296/3684f/timeout.png 225w,\n/static/426261f739ff0c2e9925d9b256aae296/fc2a6/timeout.png 450w,\n/static/426261f739ff0c2e9925d9b256aae296/7c1cd/timeout.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>WebClientë¥¼ ìƒì„±í•  ë•Œ maxIdleTimeì„ ì§€ì •í•´ì£¼ì§€ ì•Šì•„ ë¬´ì œí•œìœ¼ë¡œ ì„¤ì •ë˜ì–´, Bì„œë²„ì˜ keep-alive timeoutì´ ì´ˆê³¼í•œ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ê°€ stale connectionì„ ì‚¬ìš©í•  ê²½ìš°ê°€ ìƒê¸°ê¸° ë•Œë¬¸ì´ë‹¤.</p>\n<ol>\n<li>í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ ì™„ë£Œ í›„ ì»¤ë„¥ì…˜ì„ í’€ì— ë°˜í™˜ (ì‹œê° <code class=\"language-text\">T0</code>)</li>\n<li>ì„œë²„ì˜ keep-alive timeoutì€ <code class=\"language-text\">20</code>ì´ˆë¡œ ì„¤ì •ë¨</li>\n<li>í´ë¼ì´ì–¸íŠ¸ maxIdleTimeì€ ë¬´ì œí•œ</li>\n<li><code class=\"language-text\">T0 + 20</code>ì´ˆì— í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ì»¤ë„¥ì…˜ì„ ë‹¤ì‹œ ì‚¬ìš©í•˜ë ¤ê³  ì‹œë„</li>\n<li>ì„œë²„ëŠ” ì´ë¯¸ ì»¤ë„¥ì…˜ì„ ë‹«ì•˜ê±°ë‚˜ ë‹«ëŠ” ê³¼ì •ì— ìˆê±°ë‚˜ í´ë¼ì´ì–¸íŠ¸ê°€ ì‘ë‹µì„ ì™„ì „í•˜ê²Œ ë°›ì§€ ëª»í•œ ê²½ìš°</li>\n<li><strong>PrematureCloseException ë°œìƒ</strong></li>\n</ol>\n<p>ì„œë²„ê°€ ì»¤ë„¥ì…˜ì„ ë‹«ê¸° ì „ì— í´ë¼ì´ì–¸íŠ¸ê°€ proactiveí•˜ê²Œ ì»¤ë„¥ì…˜ì„ ì •ë¦¬í•´ì„œ race conditionì„ ë°©ì§€í•  ìˆ˜ ìˆê¸°ì— maxIdleTimeì„ ì„œë²„ì˜ keep-alive timeoutë³´ë‹¤ ì‘ê²Œ ì§€ì •í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p>\n<h1 id=\"ì •ë¦¬-í•„ìš”\" style=\"position:relative;\">ì •ë¦¬ í•„ìš”<a href=\"#%EC%A0%95%EB%A6%AC-%ED%95%84%EC%9A%94\" aria-label=\"ì •ë¦¬ í•„ìš” permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<ol>\n<li>maxIdleTimeì„ ì§€ì •í•´ì¤˜ì„œ í•´ê²°ë  ê±°ë¼ê³  íŒë‹¨</li>\n<li>í•˜ì§€ë§Œ ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ ë¬¸ì œ ë°œìƒ (ì»¤ë„¥ì…˜ì„ í• ë‹¹ë°›ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ë‹¤ê°€ ì˜ˆì™¸ ë°œìƒ. ì´ ì˜ˆì™¸ë¡œ ì¸í•´ ì¼ë°˜ Job ì½”ë£¨í‹´ ìŠ¤ì½”í”„ê°€ ë©ˆì¶¤)</li>\n</ol>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Exception in thread &quot;DefaultDispatcher-worker-5&quot; Exception in thread &quot;DefaultDispatcher-worker-1&quot; Exception in thread &quot;DefaultDispatcher-worker-7&quot; Exception in thread &quot;DefaultDispatcher-worker-10&quot; Exception in thread &quot;DefaultDispatcher-worker-3&quot; org.springframework.web.reactive.function.client.WebClientRequestException: Pending acquire queue has reached its maximum size of 32</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">// ê¸°ë³¸ê°’\nConnectionProvider.create()  // ê¸°ë³¸ ì„¤ì • ì‚¬ìš© ì‹œ\n    .maxIdleTime(-1)         // ë¬´ì œí•œ âš ï¸\n    .maxLifeTime(-1)         // ë¬´ì œí•œ âš ï¸  \n    .evictInBackground(0)    // ë¹„í™œì„± âš ï¸\n    .maxConnections(500)     // ì œí•œ ìˆìŒ\n    .pendingAcquireMaxCount(32)  // ì œí•œ ìˆìŒ</code>\n        </deckgo-highlight-code>\n<ul>\n<li>ì»¤ë„¥ì…˜ í’€ì˜ ë§¥ìŠ¤ ì»¤ë„¥ì…˜ ìˆ˜ë§Œí¼ Flowë¡œ ë°°ì••ì¡°ì ˆí•œë‹¤ë©´ ì»¤ë„¥ì…˜ ê³ ê°ˆ ë¬¸ì œëŠ” ì—†ì§€ ì•Šì„ê¹Œ? ê·¼ë° ë²„í¼ê°€ ì–´ëŠì •ë„ ê°ë‹¹ê°€ëŠ¥í•œì§€?</li>\n<li>ì»¤ë„¥ì…˜ì„ ë¨¼ì € ëŠëŠ” Active CloserëŠ” TIME_WAIT ì†Œì¼“ì„ ë³´ìœ í•˜ê²Œ ë˜ëŠ” ê²ƒì„ ì´í•´í–ˆë‹¤</li>\n</ul>\n<blockquote>\n<p>ì°¸ê³ </p>\n<ol>\n<li><a href=\"https://brewagebear.github.io/linux-kernel-internal-3/\">[Kernel] ì»¤ë„ê³¼ í•¨ê»˜ ì•Œì•„ë³´ëŠ” ì†Œì¼“ê³¼ TCP Deep Dive</a></li>\n<li><a href=\"https://blog.cjlee.io/post/webclient-timeout/\">í—·ê°ˆë¦¬ëŠ” WebClient Timeout</a></li>\n<li><a href=\"https://datatracker.ietf.org/doc/html/rfc9293#name-state-machine-overview\">RFC9293: Transmission Control Protocol (TCP) State Matchine Overview</a></li>\n<li><a href=\"https://projectreactor.io/docs/netty/release/reference/faq.html#faq.connection-closed\">How can I debug \"Connection prematurely closed BEFORE response\"?</a></li>\n<li><a href=\"https://www.baeldung.com/spring-webflux-concurrency\">Concurrency in Spring WebFlux</a></li>\n<li><a href=\"https://www.cs.unh.edu/cnrg/people/gherrin/linux-net.html\">Linux IP Networking: A Guide to the Implementation and Modification of the Linux Protocol Stack</a></li>\n</ol>\n</blockquote>","frontmatter":{"title":"WebClient PrematureCloseException ì›ì¸ ë¶„ì„í•˜ê¸°","date":"2025-09-22","update":"2025-09-22","description":null,"tags":["deep-dive","network","nio","postmortem"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%9C%EA%B2%AC\">ë¬¸ì œ ë°œê²¬</a></p>\n</li>\n<li>\n<p><a href=\"#webclient-connection-%EC%83%81%ED%83%9C-%EB%B3%80%ED%99%94\">WebClient Connection ìƒíƒœ ë³€í™”</a></p>\n</li>\n<li>\n<p><a href=\"#prematurecloseexception%EC%9D%B4-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%BC%80%EC%9D%B4%EC%8A%A4\">PrematureCloseExceptionì´ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤</a></p>\n<ul>\n<li><a href=\"#1-while-sending-request-body\">1. while sending request body</a></li>\n<li><a href=\"#2-before-response\">2. BEFORE response</a></li>\n<li><a href=\"#3-during-response\">3. DURING response</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BB%A4%EB%84%90-tcp-%EC%86%8C%EC%BC%93-%EC%83%81%ED%83%9C%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%B2%98%EB%A6%AC\">ì»¤ë„ TCP ì†Œì¼“ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9B%90%EC%9D%B8\">ì›ì¸</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC-%ED%95%84%EC%9A%94\">ì •ë¦¬ í•„ìš”</a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/2025y/coroutinescope/"},"frontmatter":{"title":"APIê°€ ì™œ ë©ˆì·„ì„ê¹Œ? ì½”ë£¨í‹´ ì´í•´í•˜ê¸°"}},"next":null},"pageContext":{"id":"e0b1b946-ea07-5d47-9d52-4627d912ebd9","previousPostId":"44185076-e856-5646-974d-b8c8a058bc63","nextPostId":null}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}