{"componentChunkName":"component---src-templates-blog-post-js","path":"/2025y/webclient/","result":{"data":{"site":{"siteMetadata":{"title":"ì½”ë”© ì£¼ë¨¸ë‹ˆ"}},"markdownRemark":{"id":"e0b1b946-ea07-5d47-9d52-4627d912ebd9","excerpt":"ë¬¸ì œ ë°œê²¬ ëª¨ë‹ˆí„°ë§ì„ í†µí•´ ë³´ë¦„ ê°„ê²©ìœ¼ë¡œ í•œ ë²ˆì”©  ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤. ì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ ì´ˆë‹¹ 400~50â€¦","html":"<h1 id=\"ë¬¸ì œ-ë°œê²¬\" style=\"position:relative;\">ë¬¸ì œ ë°œê²¬<a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%9C%EA%B2%AC\" aria-label=\"ë¬¸ì œ ë°œê²¬ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>ëª¨ë‹ˆí„°ë§ì„ í†µí•´ ë³´ë¦„ ê°„ê²©ìœ¼ë¡œ í•œ ë²ˆì”© <code class=\"language-text\">PrematureCloseException</code> ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.<br>\nì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ ì´ˆë‹¹ 400~500íšŒ ìš”ì²­ì„ ë³´ë‚´ê³ , ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠëŠ” ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ì¤‘ ë¶€í•˜ê°€ ëª°ë¦´ ë•Œ ë°œìƒí•˜ëŠ” ê²ƒì„ ì¶”ê°€ë¡œ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.</p>\n<p>ì˜ˆì™¸ì˜ ì›ì¸ì„ í™•ì‹¤í•˜ê²Œ ì´í•´í•˜ê¸° ìœ„í•´ WebClientì˜ ì»¤ë„¥ì…˜ í’€ì´ ì–´ë–»ê²Œ ê´€ë¦¬ë˜ëŠ”ì§€ ì •ìƒì ì¸ ì¼€ì´ìŠ¤ë¥¼ ë¨¼ì € í™•ì¸í•´ë³´ì.</p>\n<h1 id=\"webclient-connection-ìƒíƒœ-ë³€í™”\" style=\"position:relative;\">WebClient Connection ìƒíƒœ ë³€í™”<a href=\"#webclient-connection-%EC%83%81%ED%83%9C-%EB%B3%80%ED%99%94\" aria-label=\"webclient connection ìƒíƒœ ë³€í™” permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p>8080í¬íŠ¸ì˜ ì„œë²„ì—ì„œ 9090í¬íŠ¸ì˜ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  1ì´ˆ í›„ì— ì‘ë‹µí•˜ëŠ” APIë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ë‹¤.<br>\n(keep-alive timeout = 3000ms)</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5ea0ecd5cd827df7dd23f51fa247aae4/0ad08/success_network_log.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABP0lEQVR42iWP3UvCcBiF+/8v+4IuIkuzkbp0mzO/m/v4mW6OzMwsJCuhAiXSUst6mvbC4XmuDuddIzi/2UbRi5QMgeW4FMo2tvCoWDV0SUY/kNDDx2Qiy8RWfhqwcCRT1/Is7vssngb8zL9YWxbWm5fI2RxFR2C73oqi4SM8n0Q0hrR7QCx0SCIcRY5IxAMuXTuWsTMFZrc95r0+s+my8Bc6vS4VX9C4a9F+7OIH7AzuuB7ccuZaFEQ5oIm4FFRbVawLC+fCxu24dB9ueBt9MB1/BtN+g8LXV/xsFiUaJWcYGOdVchUDs17DrNVQ0ipyUkZRUyhaEk1XV1TTKbL5DFdNn+/3MYsgTCb/L3uNNknFoFT2MM0mxZKH41zh2C3Se3GUzX3U7QjyeojUVpiTjdDK9R2JtmbAyzMMhzAa8Qe64k2+vcc34QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"success network log\"\n        title=\"\"\n        src=\"/static/5ea0ecd5cd827df7dd23f51fa247aae4/1cfc2/success_network_log.png\"\n        srcset=\"/static/5ea0ecd5cd827df7dd23f51fa247aae4/3684f/success_network_log.png 225w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/fc2a6/success_network_log.png 450w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/1cfc2/success_network_log.png 900w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/21482/success_network_log.png 1350w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/d61c2/success_network_log.png 1800w,\n/static/5ea0ecd5cd827df7dd23f51fa247aae4/0ad08/success_network_log.png 2978w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>WebClientë¥¼ ìƒì„±í•  ë•Œ metricsë¥¼ í™œì„±í™”í•˜ì—¬ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤.</p>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">val httpClient = HttpClient.create(connectionProvider)\n    .metrics(true) { uriTagValue -&gt; uriTagValue }</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">+ 1. ì»¤ë„¥ì…˜ í’€ ìƒì„±\nCreating a new [my-provider] client pool [PoolFactory{evictionInterval=PT0S, leasingStrategy=fifo, maxConnections=1, maxIdleTime=-1, maxLifeTime=-1, metricsEnabled=false, pendingAcquireMaxCount=2, pendingAcquireTimeout=45000}] for [localhost/&lt;unresolved&gt;:9090]\n[1965a96f] Created a new pooled channel, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n\n+ 2. TCP ì—°ê²°ì„ ì™„ë£Œí•˜ê³  ì»¤ë„¥ì…˜ í’€ì— ë“±ë¡\n[1965a96f] REGISTERED\n[1965a96f] CONNECT: localhost/127.0.0.1:9090\n[1965a96f] Registering pool release on close event for channel\n[1965a96f] Channel connected, now: 1 active connections, 0 inactive connections and 0 pending acquire requests.\n[1965a96f] ACTIVE\n[1965a96f] onStateChange(PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}, [connected])\n\n+ 3. ìš”ì²­ ì¤€ë¹„\n[1965a96f-1] onStateChange(GET{uri=null, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [configured])\n[1965a96f-1] Handler is being applied: {uri=http://localhost:9090/internal/delay/1, method=GET}\n[1965a96f-1] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [request_prepared])\n\n+ 4. ìš”ì²­ ì „ì†¡\n[1965a96f-1] WRITE: 102B GET /internal/delay/1 HTTP/1.1\nuser-agent: ReactorNetty/1.1.22\nhost: localhost:9090\naccept: */*\n[1965a96f-1] FLUSH\n[1965a96f-1] WRITE: 0B\n[1965a96f-1] FLUSH\n[1965a96f-1] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [request_sent])\n\n+ 5. ì‘ë‹µ í—¤ë” ìˆ˜ì‹ \n[1965a96f-1] READ: 142B HTTP/1.1 200 \nContent-Type: text/plain;charset=UTF-8\nContent-Length: 28\nDate: Tue, 23 Sep 2025 06:09:17 GMT\n\n+ 6. ì‘ë‹µ ë°”ë”” ìˆ˜ì‹ \ndelay api success. seconds=1\n[1965a96f-1] Received response (auto-read:false) : RESPONSE(decodeResult: success, version: HTTP/1.1)\nHTTP/1.1 200 \nContent-Type: &lt;filtered&gt;\nContent-Length: &lt;filtered&gt;\nDate: &lt;filtered&gt;\n[1965a96f-1] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [response_received])\n[1965a96f-1] [terminated=false, cancelled=false, pending=0, error=null]: subscribing inbound receiver\n\n+ 6-1. ì‘ë‹µ ë°”ë”” ìˆ˜ì‹  ì™„ë£Œ\n[1965a96f-1] Received last HTTP packet\n[1965a96f] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [response_completed])\n\n+ 7. ì—°ê²° í•´ì œ ë° ì»¤ë„¥ì…˜ì„ í’€ì— ë°˜í™˜í•˜ì—¬ idle ìƒíƒœë¡œ ì „í™˜\n[1965a96f] onStateChange(GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 - R:localhost/127.0.0.1:9090]}}, [disconnecting])\n[1965a96f] Releasing channel\n[1965a96f] Channel cleaned, now: 0 active connections, 1 inactive connections and 0 pending acquire requests.\n[1965a96f] READ COMPLETE\n\n-- 3ì´ˆ ì´í›„ --\n\n+ 8. ì»¤ë„¥ì…˜ ìµœì¢… ì—°ê²° ì¢…ë£Œ\n[1965a96f] READ COMPLETE\n[Connection Closed] : GET{uri=/internal/delay/1, connection=PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 ! R:localhost/127.0.0.1:9090]}}\n[1965a96f] INACTIVE\n[1965a96f] onStateChange(PooledConnection{channel=[id: 0x1965a96f, L:/127.0.0.1:59768 ! R:localhost/127.0.0.1:9090]}, [disconnecting])\n[1965a96f] UNREGISTERED</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 1. í’€ ìƒì„±    â”‚ â†’  â”‚ 2. TCP ì—°ê²°   â”‚ â†’  â”‚ 3. HTTP ìš”ì²­ â”‚ â†’  â”‚ 4. HTTP ì‘ë‹µ  â”‚ â†’\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  Pool Init         REGISTERED            configured          response\n                    CONNECT               request_prepared    received\n                    ACTIVE                request_sent        completed\n                    (1 active)            (WRITE/FLUSH)       (200 OK)\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 5. ì—°ê²° í•´ì œ   â”‚ â†’  â”‚ 6. ìœ íœ´ ëŒ€ê¸°   â”‚ â†’  â”‚ 7. ìµœì¢… ì¢…ë£Œ   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n  disconnecting     Keep-Alive          INACTIVE\n  Release           (ì¬ì‚¬ìš© ëŒ€ê¸°)        UNREGISTERED\n  (0 active,        (~3ì´ˆ)              (Poolì—ì„œ ì œê±°)\n   1 inactive)</code>\n        </deckgo-highlight-code>\n<p>ë¡œê·¸ì™€ ë‹¤ì´ì–´ê·¸ë¨ì„ í†µí•´ Connectionì˜ ìƒíƒœê°€ ë³€í™”ë˜ëŠ” ì£¼ìš” ë‹¨ê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>\nì´ì œ PrematureCloseExceptionì´ ë°œìƒí•˜ëŠ” ì›ì¸ì— ëŒ€í•´ ë” ìì„¸í•˜ê²Œ í™•ì¸í•´ë³´ì.</p>\n<h1 id=\"prematurecloseexceptionì´-ë°œìƒí•˜ëŠ”-ì¼€ì´ìŠ¤\" style=\"position:relative;\">PrematureCloseExceptionì´ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤<a href=\"#prematurecloseexception%EC%9D%B4-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%BC%80%EC%9D%B4%EC%8A%A4\" aria-label=\"prematurecloseexceptionì´ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>ì¦‰, <code class=\"language-text\">PrematureCloseException</code>ì€ HTTP í†µì‹  ì¤‘ ì˜ˆìƒí•˜ì§€ ëª»í•œ ì‹œì ì— ì—°ê²°ì´ ì¢…ë£Œë  ë•Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë‹¤.<br>\nìì„¸íˆëŠ” ë„¤íŠ¸ì›Œí¬ì˜ ì…ì¶œë ¥ê³¼ ìƒëª…ì£¼ê¸°, ì´ë²¤íŠ¸, ìƒíƒœ ê´€ë¦¬ ë“±ì„ ê´€ë¦¬í•˜ëŠ” ChannelOperationsë¥¼ ìƒì†í•œ <code class=\"language-text\">HttpClientOperations</code>ì—ì„œ ì±„ë„ì„ ì •ë¦¬í•  ë•Œ ì‹¤í–‰ë˜ëŠ” <code class=\"language-text\">onInboundClose()</code>í•¨ìˆ˜ì—ì„œ EOF ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³  í˜„ì¬ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ ì˜ˆì™¸ë¥¼ ìƒì„±í•œë‹¤.</p>\n<h4>ì—°ê²° ì¢…ë£Œ ê°ì§€ ê³¼ì •</h4>\n<ol>\n<li>(í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ macì´ë¼ì„œ) KQueueEventLoopì—ì„œ FIN íŒ¨í‚·ì„ EV_EOF ì´ë²¤íŠ¸ë¡œ ê°ì§€</li>\n<li>EV_EOF ì´ë²¤íŠ¸ë¡œ ì¸í•´ EOF ì²˜ë¦¬, Half-closure ì„¤ì •ì— ë”°ë¼ ì…ë ¥ë§Œ ì¢…ë£Œ ë˜ëŠ” ì „ì²´ ì¢…ë£Œ ê²°ì •</li>\n<li>Channel inputShutdown í”Œë˜ê·¸ ì„¤ì • + ì‹œìŠ¤í…œ ë ˆë²¨ ì†Œì¼“ ìˆ˜ì‹  ë¶€ë¶„ ì¢…ë£Œ</li>\n<li>ì‹¤ì œ ì†Œì¼“ fd ë‹«ê¸° + closeInitiated í”Œë˜ê·¸ ì„¤ì •</li>\n<li>channelInactive ì´ë²¤íŠ¸ê°€ íŒŒì´í”„ë¼ì¸ í†µí•´ ì „íŒŒ EventLoopì—ì„œ ì±„ë„ ë“±ë¡ í•´ì œ</li>\n<li><strong>ChannelHandler.channelInactive() í”„ë¡œí† ì½œë³„ ì •ë¦¬ ì‘ì—…ì—ì„œ onInboundClose() í˜¸ì¶œ</strong> â†’ HTTP í”„ë¡œí† ì½œ ë ˆë²¨ì—ì„œ ì–´ë–¤ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆëŠ”ì§€ êµ¬ë¶„í•´ì„œ ì ì ˆí•œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e0e7f9a29c48c31fdd0971949c15ba2f/fe7a3/onInboundClose.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVR42m1S7W7bMAz0W2xtYsu2vizHi/xtt07cBh2QAkP/7P3f5XZyAgTY9uNAiiKPPEqRVhq+cihdhaLqYH+0sEUJbUooUyBXBlmmN6SZQn73hciR3CFSiafnBE07IEp4yKWBP3q4soINxMUBh6qGox9IlS4gld3ItSxgpCO5/D+h4EWYxrBIa0ewwDooNpG5vsWMg1UlrCw3K9LHdP8S8qC0RdsMaOsB3jeUfkTGiVKSplIjodQkfWBPwr14ICbHt10CHwhjTpgxqWVhbyx6yg3wJKtJ6nMJtxd/Ib0hvtkyzqC/77DUHaKKsj6THGcWL/aAM/f2QsKRu5ood2B84O562n6zBoO+x9i0pz9yEM+BfvEdIp8bfJHwQ1qcmHDmxTuJ30l6IfnK5EUbLMbgdPdP1uCVeNMaPyn/lTVTkuGr7REZyp2ExMjH6Jjc8wEGW26de8aC3/GlW5J1/GINFfXK0XeYqaLe9quxexZouhFRwYU2nGzl35sp64UyA2ZKmtg5xGYST8EybyDhGEB/pLqaOQGHWODS8VEuHPUqMlx0ias94rM44kpcSLKycOUnXrmONTSlXXJFSCxSbvbM88rmc5LidzfiD2XNJlv0V0AGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"onInboundClose\"\n        title=\"\"\n        src=\"/static/e0e7f9a29c48c31fdd0971949c15ba2f/1cfc2/onInboundClose.png\"\n        srcset=\"/static/e0e7f9a29c48c31fdd0971949c15ba2f/3684f/onInboundClose.png 225w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/fc2a6/onInboundClose.png 450w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/1cfc2/onInboundClose.png 900w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/21482/onInboundClose.png 1350w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/d61c2/onInboundClose.png 1800w,\n/static/e0e7f9a29c48c31fdd0971949c15ba2f/fe7a3/onInboundClose.png 8106w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<ol>\n<li>ìš”ì²­ í—¤ë” ì „ì†¡</li>\n<li>ìš”ì²­ ë°”ë”” ì „ì†¡   â† ì—¬ê¸°ì„œ ë‹«íˆë©´ <code class=\"language-text\">\"while sending request body\"</code> <strong>ì•„ì§ ìš”ì²­ë„ ì™„ì „íˆ ëª» ë³´ë‚¸ ìƒíƒœ</strong></li>\n<li>ìš”ì²­ ì™„ë£Œ</li>\n<li>ì„œë²„ ì²˜ë¦¬ ì¤‘     â† ì—¬ê¸°ì„œ ë‹«íˆë©´ <code class=\"language-text\">\"BEFORE response\"</code> <strong>ìš”ì²­ì€ ë³´ëƒˆì§€ë§Œ ì‘ë‹µì„ ì•„ì§ ëª» ë°›ì€ ìƒíƒœ</strong></li>\n<li>ì‘ë‹µ í—¤ë” ìˆ˜ì‹ </li>\n<li>ì‘ë‹µ ë°”ë”” ìˆ˜ì‹    â† ì—¬ê¸°ì„œ ë‹«íˆë©´ <code class=\"language-text\">\"DURING response\"</code> <strong>ì‘ë‹µì„ ë°›ê¸° ì‹œì‘í–ˆì§€ë§Œ ì‘ë‹µì´ ì™„ì „íˆ ì•ˆ ì˜¨ ìƒíƒœ</strong></li>\n<li>ì‘ë‹µ ì™„ë£Œ</li>\n</ol>\n</blockquote>\n<h2 id=\"1-before-response-while-sending-request-body\" style=\"position:relative;\">1. BEFORE response while sending request body<a href=\"#1-before-response-while-sending-request-body\" aria-label=\"1 before response while sending request body permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>ì†¡ì‹  ì„œë²„ì˜ ìš”ì²­ì„ ìˆ˜ì‹  ì„œë²„ê°€ ìˆ˜ì‹  ì¤‘ì— (ë°”ë””ë¥¼ ì™„ì „íˆ ë°›ê¸° ì „ì—) ì—°ê²°ì„ ì¢…ë£Œí•˜ëŠ” ê²½ìš°ì— ë°œìƒí•œë‹¤.<br>\n<strong>í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</strong>: ìŠ¤íŠ¸ë¦¬ë° ë°”ë””ë¥¼ ì „ì†¡í•˜ëŠ” ì¤‘ì— ì„œë²„ê°€ ë‘ ë²ˆì§¸ ì²­í¬ë¥¼ ë°›ìœ¼ë©´ ì¦‰ì‹œ ì—°ê²°ì„ ì¢…ë£Œ</p>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">// WebClient Body\nval chunkData = &quot;X&quot;.repeat(4096) // 4KB per chunk\nval streamingBody = Flux.interval(Duration.ofMillis(500))\n    .take(20)  // 20ê°œ ì²­í¬ = 80KB\n    .map { index -&gt;\n        logger.info(&quot;Preparing to send chunk ${index + 1}/20&quot;)\n        chunkData\n    }\n    .doOnNext {\n        logger.info(&quot;Sending chunk of ${it.length} bytes...&quot;)\n    }\n    .doOnComplete {\n        logger.info(&quot;All chunks sent&quot;)\n    }\n\n// Netty ì„œë²„\nfun main() {\n    val parentGroup = NioEventLoopGroup()\n    val workerGroup = NioEventLoopGroup()\n\n    try {\n        ServerBootstrap()\n            .group(parentGroup, workerGroup)\n            .channel(NioServerSocketChannel::class.java)\n            .handler(LoggingHandler(LogLevel.DEBUG))    // ì„œë²„ ìì²´ ì´ë²¤íŠ¸ ë¡œê¹… (bind, accept ë“±)\n            .childHandler(object : ChannelInitializer&lt;SocketChannel&gt;() {\n                override fun initChannel(ch: SocketChannel) {           // chëŠ” ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ ì±„ë„\n                    ch.pipeline().addLast(LoggingHandler(LogLevel.DEBUG))   // í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° ì†¡ìˆ˜ì‹  ì²´í¬\n                    ch.pipeline().addLast(RudeServerHandler())\n                }\n            })\n            .bind(9090).sync()\n            .channel()\n            .closeFuture().sync()\n    } finally {\n        parentGroup.shutdownGracefully()\n        workerGroup.shutdownGracefully()\n    }\n}\n\nprivate class RudeServerHandler : ChannelInboundHandlerAdapter() {\n    private val logger = org.slf4j.LoggerFactory.getLogger(&quot;RudeServer&quot;)\n    private var readCount = 0\n    private var totalBytesReceived = 0\n\n    override fun channelActive(ctx: ChannelHandlerContext) {\n        super.channelActive(ctx)\n        logger.info(&quot;Client connected: ${ctx.channel().remoteAddress()}&quot;)\n    }\n\n    override fun channelRead(ctx: ChannelHandlerContext, msg: Any) {\n        val buffer = msg as io.netty.buffer.ByteBuf\n        val readableBytes = buffer.readableBytes()\n        readCount++\n        totalBytesReceived += readableBytes\n        \n        logger.info(&quot;channelRead #$readCount: Received $readableBytes bytes (total: $totalBytesReceived)&quot;)\n        \n        // ì²« ë²ˆì§¸ readì—ì„œ í—¤ë”ê°€ í¬í•¨ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ\n        // ë‘ ë²ˆì§¸ readëŠ” ë°”ë”” ë°ì´í„°\n        // ë‘ ë²ˆì§¸ ì²­í¬ë¥¼ ë°›ìœ¼ë©´ ì—°ê²° ëŠê¸°\n        if (readCount &gt;= 2) {\n            logger.info(&quot;Received 2nd chunk, closing connection WITHOUT sending response!&quot;)\n            buffer.release()\n            ctx.close().await()\n        } else {\n            logger.info(&quot;Waiting for more data...&quot;)\n            buffer.release()\n        }\n    }\n}</code>\n        </deckgo-highlight-code>\n<br/>  \n<details>\n<summary>ğŸ“‹ WebClientì™€ Netty ë¡œê·¸ ìì„¸íˆë³´ê¸° (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">+ &lt;Spring WebClient ë¡œê·¸&gt;\n\n[reactor-http-kqueue-7] DEBUG r.n.r.PooledConnectionProvider - [c437bfe8] Created a new pooled channel, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8] REGISTERED\n[reactor-http-kqueue-7] DEBUG i.n.r.dns.DnsNameResolverBuilder - resolveCache and TTLs are mutually exclusive. TTLs are ignored.\n[reactor-http-kqueue-7] DEBUG i.n.r.dns.DnsNameResolverBuilder - cnameCache and TTLs are mutually exclusive. TTLs are ignored.\n[reactor-http-kqueue-7] DEBUG i.n.r.dns.DnsNameResolverBuilder - authoritativeDnsServerCache and TTLs are mutually exclusive. TTLs are ignored.\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8] CONNECT: localhost/127.0.0.1:9090\n[reactor-http-kqueue-7] DEBUG r.n.r.DefaultPooledConnectionProvider - [c437bfe8, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] Registering pool release on close event for channel\n[reactor-http-kqueue-7] DEBUG r.n.r.PooledConnectionProvider - [c437bfe8, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] Channel connected, now: 1 active connections, 0 inactive connections and 0 pending acquire requests.\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] ACTIVE\n[reactor-http-kqueue-7] DEBUG r.n.r.DefaultPooledConnectionProvider - [c437bfe8, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] onStateChange(PooledConnection{channel=[id: 0xc437bfe8, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090]}, [connected])\n[reactor-http-kqueue-7] DEBUG r.n.r.DefaultPooledConnectionProvider - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=null, connection=PooledConnection{channel=[id: 0xc437bfe8, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090]}}, [configured])\n[reactor-http-kqueue-7] DEBUG r.n.http.client.HttpClientConnect - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] Handler is being applied: {uri=http://localhost:9090/any-path, method=POST}\n[reactor-http-kqueue-7] DEBUG r.n.r.DefaultPooledConnectionProvider - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] onStateChange(POST{uri=/any-path, connection=PooledConnection{channel=[id: 0xc437bfe8, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090]}}, [request_prepared])\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] WRITE: 155B POST /any-path HTTP/1.1\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] FLUSH\n[parallel-6] INFO  e.s.PrematureCloseExceptionService - Preparing to send chunk 1/20\n[parallel-6] INFO  e.s.PrematureCloseExceptionService - Sending chunk of 4096 bytes...\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] WRITE: 6B 1000\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] WRITE: 4096B XXXX... // send data ...\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] WRITE: 2B \n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] FLUSH\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 - R:localhost/127.0.0.1:9090] READ COMPLETE\n[reactor-http-kqueue-7] DEBUG r.n.r.PooledConnectionProvider - [c437bfe8-1, L:/127.0.0.1:52226 ! R:localhost/127.0.0.1:9090] Channel closed, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 ! R:localhost/127.0.0.1:9090] INACTIVE\n[reactor-http-kqueue-7] DEBUG r.n.r.DefaultPooledConnectionProvider - [c437bfe8-1, L:/127.0.0.1:52226 ! R:localhost/127.0.0.1:9090] onStateChange(POST{uri=/any-path, connection=PooledConnection{channel=[id: 0xc437bfe8, L:/127.0.0.1:52226 ! R:localhost/127.0.0.1:9090]}}, [response_incomplete])\n[reactor-http-kqueue-7] WARN  r.n.http.client.HttpClientConnect - [c437bfe8-1, L:/127.0.0.1:52226 ! R:localhost/127.0.0.1:9090] The connection observed an error\nreactor.netty.http.client.PrematureCloseException: Connection has been closed BEFORE response, while sending request body\n[reactor-http-kqueue-7] INFO  my-webclient - [c437bfe8-1, L:/127.0.0.1:52226 ! R:localhost/127.0.0.1:9090] UNREGISTERED\n[http-nio-8080-exec-2] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.web.reactive.function.client.WebClientRequestException: Connection has been closed BEFORE response, while sending request body] with root cause\nreactor.netty.http.client.PrematureCloseException: Connection has been closed BEFORE response, while sending request body</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">+ &lt;Netty ì„œë²„ ë¡œê·¸&gt;\n\n-- ë¦¬ìŠ¤ë„ˆ í¬íŠ¸ ë“±ë¡ ë° í™œì„±í™” ì™„ë£Œ\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xc281fdae] REGISTERED\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xc281fdae] BIND: 0.0.0.0/0.0.0.0:9090\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xc281fdae, L:/[0:0:0:0:0:0:0:0]:9090] ACTIVE\n\n-- ìš”ì²­ ìˆ˜ì‹ \n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x5421fff9, L:/[0:0:0:0:0:0:0:0]:9090] READ: [id: 0x57861e0a, L:/127.0.0.1:9090 - R:/127.0.0.1:52226]\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x5421fff9, L:/[0:0:0:0:0:0:0:0]:9090] READ COMPLETE\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 - R:/127.0.0.1:52226] REGISTERED\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 - R:/127.0.0.1:52226] ACTIVE\n[nioEventLoopGroup-3-3] INFO  RudeServer - Client connected: /127.0.0.1:52226\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 - R:/127.0.0.1:52226] READ: 155B\n[nioEventLoopGroup-3-3] INFO  RudeServer - channelRead #1: Received 155 bytes (total: 155)\n[nioEventLoopGroup-3-3] INFO  RudeServer - Waiting for more data...\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 - R:/127.0.0.1:52226] READ COMPLETE\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 - R:/127.0.0.1:52226] READ: 2048B\n[nioEventLoopGroup-3-3] INFO  RudeServer - channelRead #2: Received 2048 bytes (total: 2203)\n[nioEventLoopGroup-3-3] INFO  RudeServer - Received 2nd chunk, closing connection WITHOUT sending response!\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 - R:/127.0.0.1:52226] CLOSE\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 ! R:/127.0.0.1:52226] READ COMPLETE\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 ! R:/127.0.0.1:52226] USER_EVENT: io.netty.channel.socket.ChannelInputShutdownReadComplete@6a0d7782\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 ! R:/127.0.0.1:52226] INACTIVE\n[nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 ! R:/127.0.0.1:52226] UNREGISTERED</code>\n        </deckgo-highlight-code>\n</details>\n<br/>\n<ol>\n<li><code class=\"language-text\">ChannelRegistered</code> : Channel ì´ Event Loopì— ë“±ë¡ë¨</li>\n<li><code class=\"language-text\">ChannelActive</code> : Channelì´ í™œì„±í™”ë¨, ì´ì œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŒ</li>\n<li><code class=\"language-text\">Channellnactive</code> : Channelì´ ì›ê²© í”¼ì–´ë¡œ ì—°ê²°ë˜ì§€ ì•ŠìŒ</li>\n<li><code class=\"language-text\">ChannelUnregistered</code>: Channelì´ ìƒì„±ëì§€ë§Œ Event Loopì— ë“±ë¡ë˜ì§€ ì•ŠìŒ</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c89228419bd6fa200e076aae3d9f741b/d7ceb/whileSending.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABaklEQVR42i2QS2+bQBSF+f8/oFJXVSNVtgyOU2MMDMObCWADfudhx0m66KqNlEVVZfd1jLq4Oufec+48jrFYHQjzBWWzo2737O+fyatVj+v9iW77iMxr3KggSCtEUiKzSs8u/JYgK/ETRbO5xw9zDJGmjB1HL0R4caIPq7BF0GOslL6sYDxzGH6fYtoOluYTd86N72E6Nteam7MpodI+e4qxuXsjKZ9pd79YHX5zevmg6n7y9PrB4/kvu4f3XpfFkbR6IVJnRPqg8Yno9ky2+KG1E4fTHwqtG8XQRXy9phjMUQOXxgpJv9m0VkRjSsqhj7ya9J7gP86/mAjN3c8jPF2zTwOWI0lypV+4VhWZJ+nyknVRc2w2LJOCY7vlru44VA0qiLVHx+CHZL4kDySLNNN9QKH7S/U+EWEEOnBrHuJfAs9q1HKLEypUs9VfXBGXLRMv1nlJxm7U42gmuBExlnuZhT1GZYeIFf8A6EuHde0hP+QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"whileSending\"\n        title=\"\"\n        src=\"/static/c89228419bd6fa200e076aae3d9f741b/1cfc2/whileSending.png\"\n        srcset=\"/static/c89228419bd6fa200e076aae3d9f741b/3684f/whileSending.png 225w,\n/static/c89228419bd6fa200e076aae3d9f741b/fc2a6/whileSending.png 450w,\n/static/c89228419bd6fa200e076aae3d9f741b/1cfc2/whileSending.png 900w,\n/static/c89228419bd6fa200e076aae3d9f741b/21482/whileSending.png 1350w,\n/static/c89228419bd6fa200e076aae3d9f741b/d7ceb/whileSending.png 1446w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">+ Netty ì„œë²„ ë¡œê·¸\n18:09:15.348 [nioEventLoopGroup-3-3] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x57861e0a, L:/127.0.0.1:9090 ! R:/127.0.0.1:52226] USER_EVENT: io.netty.channel.socket.ChannelInputShutdownReadComplete@6a0d7782\n\n+ RST íŒ¨í‚·\nUTC Arrival Time: Oct  1, 2025 09:09:15.348334000 UTC\nTransmission Control Protocol, Src Port: 9090, Dst Port: 52226, Seq: 2, Ack: 4260, Len: 0\nFlags: 0x014 (RST, ACK)</code>\n        </deckgo-highlight-code>\n<h2 id=\"2-before-response\" style=\"position:relative;\">2. BEFORE response<a href=\"#2-before-response\" aria-label=\"2 before response permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><code class=\"language-text\">BEFORE response while sending request body</code>ì™€ ë¹„ìŠ·í•œ ì¼€ì´ìŠ¤ì´ì§€ë§Œ ìš”ì²­ bodyê°€ ì—†ëŠ” ê²½ìš° ì´ ë©”ì„¸ì§€ì˜ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.<br>\n<strong>í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</strong>: ìš”ì²­ í—¤ë”ë§Œ ë°›ê³  ì¦‰ì‹œ ì—°ê²°ì„ ì¢…ë£Œ</p>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">fun main() {\n    val parentGroup = NioEventLoopGroup()\n    val workerGroup = NioEventLoopGroup()\n\n    try {\n        ServerBootstrap()\n            .group(parentGroup, workerGroup)\n            .channel(NioServerSocketChannel::class.java)\n            .handler(LoggingHandler(LogLevel.DEBUG))    // ì„œë²„ ìì²´ ì´ë²¤íŠ¸ ë¡œê¹… (bind, accept ë“±)\n            .childHandler(object : ChannelInitializer&lt;SocketChannel&gt;() {\n                override fun initChannel(ch: SocketChannel) {           // chëŠ” ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ ì±„ë„\n                    ch.pipeline().addLast(LoggingHandler(LogLevel.DEBUG))   // í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° ì†¡ìˆ˜ì‹  ì²´í¬\n                    ch.pipeline().addLast(RudeServerHandler())\n                }\n            })\n            .bind(9090).sync()\n            .channel()\n            .closeFuture().sync()\n    } finally {\n        parentGroup.shutdownGracefully()\n        workerGroup.shutdownGracefully()\n    }\n}\n\nprivate class RudeServerHandler : ChannelInboundHandlerAdapter() {\n    private val logger = org.slf4j.LoggerFactory.getLogger(&quot;RudeServer&quot;)\n\n    override fun channelActive(ctx: ChannelHandlerContext) {\n        super.channelActive(ctx)\n        logger.info(&quot;Client connected: ${ctx.channel().remoteAddress()}&quot;)\n    }\n\n    override fun channelRead(ctx: ChannelHandlerContext, msg: Any) {\n        logger.info(&quot;Received message: $msg&quot;)\n        logger.info(&quot;Closing connection !!!&quot;)\n        ctx.close().await()\n    }\n}</code>\n        </deckgo-highlight-code>\n<br/>\n<details>\n<summary>ğŸ“‹ WebClientì™€ Netty ë¡œê·¸ ìì„¸íˆë³´ê¸° (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">+ &lt;Spring WebClient ë¡œê·¸&gt;\n\n[reactor-http-kqueue-4] DEBUG r.n.r.PooledConnectionProvider - [ace71497] Created a new pooled channel, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497] REGISTERED\n[reactor-http-kqueue-4] DEBUG i.n.r.dns.DnsNameResolverBuilder - resolveCache and TTLs are mutually exclusive. TTLs are ignored.\n[reactor-http-kqueue-4] DEBUG i.n.r.dns.DnsNameResolverBuilder - cnameCache and TTLs are mutually exclusive. TTLs are ignored.\n[reactor-http-kqueue-4] DEBUG i.n.r.dns.DnsNameResolverBuilder - authoritativeDnsServerCache and TTLs are mutually exclusive. TTLs are ignored.\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497] CONNECT: localhost/127.0.0.1:9090\n[reactor-http-kqueue-4] DEBUG r.n.r.DefaultPooledConnectionProvider - [ace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] Registering pool release on close event for channel\n[reactor-http-kqueue-4] DEBUG r.n.r.PooledConnectionProvider - [ace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] Channel connected, now: 1 active connections, 0 inactive connections and 0 pending acquire requests.\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] ACTIVE\n[reactor-http-kqueue-4] DEBUG r.n.r.DefaultPooledConnectionProvider - [ace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] onStateChange(PooledConnection{channel=[id: 0xace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090]}, [connected])\n[reactor-http-kqueue-4] DEBUG r.n.r.DefaultPooledConnectionProvider - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=null, connection=PooledConnection{channel=[id: 0xace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090]}}, [configured])\n[reactor-http-kqueue-4] DEBUG r.n.http.client.HttpClientConnect - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] Handler is being applied: {uri=http://localhost:9090/any-path, method=POST}\n[reactor-http-kqueue-4] DEBUG r.n.r.DefaultPooledConnectionProvider - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] onStateChange(POST{uri=/any-path, connection=PooledConnection{channel=[id: 0xace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090]}}, [request_prepared])\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] WRITE: 123B POST /any-path HTTP/1.1\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] FLUSH\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] WRITE: 5B 0\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] FLUSH\n[reactor-http-kqueue-4] DEBUG r.n.r.DefaultPooledConnectionProvider - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] onStateChange(POST{uri=/any-path, connection=PooledConnection{channel=[id: 0xace71497, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090]}}, [request_sent])\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497-1, L:/127.0.0.1:50390 - R:localhost/127.0.0.1:9090] READ COMPLETE\n[reactor-http-kqueue-4] DEBUG r.n.r.PooledConnectionProvider - [ace71497-1, L:/127.0.0.1:50390 ! R:localhost/127.0.0.1:9090] Channel closed, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497-1, L:/127.0.0.1:50390 ! R:localhost/127.0.0.1:9090] INACTIVE\n[reactor-http-kqueue-4] DEBUG r.n.r.DefaultPooledConnectionProvider - [ace71497-1, L:/127.0.0.1:50390 ! R:localhost/127.0.0.1:9090] onStateChange(POST{uri=/any-path, connection=PooledConnection{channel=[id: 0xace71497, L:/127.0.0.1:50390 ! R:localhost/127.0.0.1:9090]}}, [response_incomplete])\n[reactor-http-kqueue-4] WARN  r.n.http.client.HttpClientConnect - [ace71497-1, L:/127.0.0.1:50390 ! R:localhost/127.0.0.1:9090] The connection observed an error\nreactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE response\n[reactor-http-kqueue-4] INFO  my-webclient - [ace71497-1, L:/127.0.0.1:50390 ! R:localhost/127.0.0.1:9090] UNREGISTERED\n[http-nio-8080-exec-6] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.web.reactive.function.client.WebClientRequestException: Connection prematurely closed BEFORE response] with root cause\nreactor.netty.http.client.PrematureCloseException: Connection prematurely closed BEFORE response</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">+ &lt;Netty ì„œë²„ ë¡œê·¸&gt;\n\n-- ë¦¬ìŠ¤ë„ˆ í¬íŠ¸ ë“±ë¡ ë° í™œì„±í™” ì™„ë£Œ\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x1828781c] REGISTERED\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x1828781c] BIND: 0.0.0.0/0.0.0.0:9090\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x1828781c, L:/[0:0:0:0:0:0:0:0]:9090] ACTIVE\n\n-- ìš”ì²­ ìˆ˜ì‹ \n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x1828781c, L:/[0:0:0:0:0:0:0:0]:9090] READ: [id: 0xb065a578, L:/127.0.0.1:9090 - R:/127.0.0.1:50390]\n[nioEventLoopGroup-2-1] DEBUG i.n.handler.logging.LoggingHandler - [id: 0x1828781c, L:/[0:0:0:0:0:0:0:0]:9090] READ COMPLETE\n[nioEventLoopGroup-3-2] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xb065a578, L:/127.0.0.1:9090 - R:/127.0.0.1:50390] REGISTERED\n[nioEventLoopGroup-3-2] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xb065a578, L:/127.0.0.1:9090 - R:/127.0.0.1:50390] ACTIVE\n[nioEventLoopGroup-3-2] INFO  RudeServer - Client connected: /127.0.0.1:50390\n[nioEventLoopGroup-3-2] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xb065a578, L:/127.0.0.1:9090 - R:/127.0.0.1:50390] READ: 128B\n[nioEventLoopGroup-3-2] INFO  RudeServer - Received message: PooledUnsafeDirectByteBuf(ridx: 0, widx: 128, cap: 2048)\n[nioEventLoopGroup-3-2] INFO  RudeServer - Closing connection !!!\n[nioEventLoopGroup-3-2] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xb065a578, L:/127.0.0.1:9090 - R:/127.0.0.1:50390] CLOSE\n[nioEventLoopGroup-3-2] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xb065a578, L:/127.0.0.1:9090 ! R:/127.0.0.1:50390] READ COMPLETE\n[nioEventLoopGroup-3-2] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xb065a578, L:/127.0.0.1:9090 ! R:/127.0.0.1:50390] INACTIVE\n[nioEventLoopGroup-3-2] DEBUG i.n.handler.logging.LoggingHandler - [id: 0xb065a578, L:/127.0.0.1:9090 ! R:/127.0.0.1:50390] UNREGISTERED</code>\n        </deckgo-highlight-code>\n</details>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f548df5c4bf745e84c88fd244cdd323f/b297c/beforeResponse.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVR42iWR6Y7aQBCE/f5PkEirTUgWAsthsMEYbPAxNr4Bc0ssLEk2kXK8w5fB+VGqrqlqdbdG+dIboo4shhMHf5HT0Uy8IGUyC/DDrPKe2gMaXb1CUx1WeO4bNHo6Lcn1zoC27BtbHopmWUyFjxtHFNsNpueSb9aEeSZ1iRX4DGRGs220mY3hzZkIFyv0Gfv/a9N3cNOIVPYpmrFg7pUE0ZHd7ie2s2KzfSPLL+yldvyt3D7BmGaM7VxuXkgdV7VuxoymaaVn3hpX7FDGQuDlOVG55vh6ZR4nHK4Xiv2B4/WKXxQYvo8pAuZJLLMps2SBV2SSI5w0xopCYnnN6faKouoCU06fOSVp+oJhJiTxGSH2ZOml8lRNoI0W9PWgQrvnMhiGdFSXbt+reDItZP4FxcmWpPsT5fnKt99/iTZ7br/+cLx956vk7HDCyQrEsuSe9fIV3nIp3w+E8qqwLBGrJclux/ntB8pDrcVTU6XZ0RmN59TqXfSRLaeOK/1Zeu8/NHj89MzDxyb3/LvHOrVGV/60SUvm7mgPJngi5x9pP8eTAzpr6wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"beforeResponse\"\n        title=\"\"\n        src=\"/static/f548df5c4bf745e84c88fd244cdd323f/1cfc2/beforeResponse.png\"\n        srcset=\"/static/f548df5c4bf745e84c88fd244cdd323f/3684f/beforeResponse.png 225w,\n/static/f548df5c4bf745e84c88fd244cdd323f/fc2a6/beforeResponse.png 450w,\n/static/f548df5c4bf745e84c88fd244cdd323f/1cfc2/beforeResponse.png 900w,\n/static/f548df5c4bf745e84c88fd244cdd323f/21482/beforeResponse.png 1350w,\n/static/f548df5c4bf745e84c88fd244cdd323f/d61c2/beforeResponse.png 1800w,\n/static/f548df5c4bf745e84c88fd244cdd323f/b297c/beforeResponse.png 2844w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">BEFORE response while sending request body</code> ë‹¤ë¥¸ ì ì€ Netty ì„œë²„ì—ì„œ USER_EVENTê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì°¨ì´ì ì´ ìˆë‹¤.</p>\n<h2 id=\"3-during-response\" style=\"position:relative;\">3. DURING response<a href=\"#3-during-response\" aria-label=\"3 during response permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>ì†¡ì‹  ì„œë²„ê°€ ìˆ˜ì‹  ì„œë²„ì—ê²Œ í—¤ë”ë¥¼ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µë°›ê³  ë°”ë””ë¥¼ ëŒ€ê¸°í•˜ëŠ” ë„ì¤‘ ì»¤ë„¥ì…˜ì´ ì†¡ì‹  ì„œë²„ê°€ ì»¤ë„¥ì…˜ì„ ì¼ë°©ì ìœ¼ë¡œ ë‹«ëŠ” ê²½ìš°ì´ë‹¤.<br>\nì¦‰, ì†¡ì‹  ì„œë²„ê°€ í—¤ë”ë¥¼ ì •ìƒì ìœ¼ë¡œ ë°›ê³  ë°”ë””ë¥¼ ì™„ì „íˆ ë°›ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ì¤‘ì— ìˆ˜ì‹  ì„œë²„ê°€ ì¼ë°©ì ìœ¼ë¡œ ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•˜ëŠ” ê²½ìš°ì´ë‹¤.<br>\n<strong>í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤</strong>: ì‘ë‹µ í—¤ë”ì™€ ì¼ë¶€ ë°”ë””ë¥¼ ì „ì†¡í•œ í›„ ì—°ê²° ì¢…ë£Œ</p>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">// ì†¡ì‹  ì„œë²„ì˜ API\n@GetMapping(&quot;/abort-connection&quot;)\nfun abortConnection(response: HttpServletResponse) {\n    logger.info(&quot;Starting abort connection...&quot;)\n    \n    try {\n        val writer = response.writer\n        \n        // ì‘ë‹µ ë°ì´í„°ë¥¼ í•œ ë²ˆ ì „ì†¡í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì½ê¸° ì‹œì‘í•˜ë„ë¡ ìœ ë„\n        writer.write(&quot;Starting response...&quot;)\n        writer.flush()\n\n        Thread.sleep(100)\n\n        // ì¼ë°©ì ìœ¼ë¡œ ì¢…ë£Œ! FIN íŒ¨í‚· ì „ë‹¬\n        response.outputStream.close()\n\n        writer.write(&quot;This should not be sent&quot;)\n        \n    } catch (e: IOException) {\n        logger.error(&quot;IOException during abort: ${e.message}&quot;)\n    }\n}</code>\n        </deckgo-highlight-code>\n<br/>\n<details>\n<summary>ğŸ’¡ WebClient Connection Pool ë¡œê·¸ ìì„¸íˆë³´ê¸°</summary>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Creating a new [my-provider] client pool [PoolFactory{evictionInterval=PT0S, leasingStrategy=fifo, maxConnections=1, maxIdleTime=-1, maxLifeTime=-1, metricsEnabled=false, pendingAcquireMaxCount=2, pendingAcquireTimeout=45000}] for [localhost/&lt;unresolved&gt;:9090]\n[551113d8] Created a new pooled channel, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[551113d8] REGISTERED\n[551113d8] CONNECT: localhost/127.0.0.1:9090\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Registering pool release on close event for channel\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Channel connected, now: 1 active connections, 0 inactive connections and 0 pending acquire requests.\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] ACTIVE\n[551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}, [connected])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=null, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [configured])\n[New Connection] : GET{uri=null, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Handler is being applied: {uri=http://localhost:9090/force/abort-connection, method=GET}\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [request_prepared])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] WRITE: 108B GET /force/abort-connection HTTP/1.1\nuser-agent: ReactorNetty/1.1.22\nhost: localhost:9090\naccept: */*\n\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] FLUSH\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] WRITE: 0B\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] FLUSH\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [request_sent])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] READ: 108B HTTP/1.1 200 \nTransfer-Encoding: chunked\nDate: Sat, 27 Sep 2025 05:28:01 GMT\n14\nStarting response...    // ì²« ë²ˆì§¸ ì²­í‚¹ ë°ì´í„° ì •ìƒì ìœ¼ë¡œ ì‘ë‹µë°›ìŒ\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] Received response (auto-read:false) : RESPONSE(decodeResult: success, version: HTTP/1.1)\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090]}}, [response_received])\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] [terminated=false, cancelled=false, pending=0, error=null]: subscribing inbound receiver\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] READ COMPLETE\n[551113d8-1, L:/127.0.0.1:53169 - R:localhost/127.0.0.1:9090] READ COMPLETE\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] Channel closed, now: 0 active connections, 0 inactive connections and 0 pending acquire requests.\n[Connection Closed] : GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090]}}\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] INACTIVE\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] onStateChange(GET{uri=/force/abort-connection, connection=PooledConnection{channel=[id: 0x551113d8, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090]}}, [response_incomplete])\n[551113d8-1, L:/127.0.0.1:53169 ! R:localhost/127.0.0.1:9090] UNREGISTERED\nServlet.service() for servlet [dispatcherServlet] in context with path [] threw exception \n[Request processing failed: org.springframework.web.reactive.function.client.WebClientResponseException: 200 OK from GET http://localhost:9090/force/abort-connection, \nbut response failed with cause: reactor.netty.http.client.PrematureCloseException: Connection prematurely closed DURING response] with root cause</code>\n        </deckgo-highlight-code>\n</details>\n<br/>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ff6649ca3efa0906969b2bcf54dd3e52/d9ed5/duringResponse.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.44444444444445%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42h2Q2Y7TQBBF/feDeOCBRTzAMNIgFAmJJcRx7MRxvLsd2x07jj1LMgogtr841PTD0a1WVd2+3VZaN3hxQlLXBj0MBIVCjyPbbk8puNK3g5BFFOPnGas8ZV3kLNMEX9QTLdqWuu+x0qrB2UREZWXQhwE/zdG9GLZ7lO6YS3+6WjMX05m/McaPIZwwlMti0Yi4qskajbXdHVlFDaq5o9T3jLe/SdTBaDf8YNef8WONu9maOXdTmdpPNF64NbWzVtTtifvTP6w4vcH2KsJ4IEpGqurMKuio6u+o8oFcHXGWDVNHYbsVs8WWz7PM1N/miqmt+GLnsj9Sy451NT3zctLz5tNJeODa/sPrj7dG39u/ePf1J68mA8+udzK35/mHjou3NU+vOp5c7ri41IYXkzvZ+SsJE/n0ZUkYtQalblgHjdE8H8iyA95KnuUpFjL3iL3IWcjZ8QpJmjN3C/xAS8Ij/wELcYjpVb2JLQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"duringResponse\"\n        title=\"\"\n        src=\"/static/ff6649ca3efa0906969b2bcf54dd3e52/1cfc2/duringResponse.png\"\n        srcset=\"/static/ff6649ca3efa0906969b2bcf54dd3e52/3684f/duringResponse.png 225w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/fc2a6/duringResponse.png 450w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/1cfc2/duringResponse.png 900w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/21482/duringResponse.png 1350w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/d61c2/duringResponse.png 1800w,\n/static/ff6649ca3efa0906969b2bcf54dd3e52/d9ed5/duringResponse.png 2880w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ì´ ì„¸ ê°€ì§€ ë‹¤ë¥¸ ì˜ˆì™¸ ë©”ì‹œì§€ëŠ” ë³µì¡í•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ ë” ìì„¸í•˜ê²Œ í‘œí˜„í•˜ê¸° ìœ„í•´ ë‚˜ë‰˜ì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>\n<h1 id=\"ì»¤ë„-tcp-ì†Œì¼“-ìƒíƒœì—-ë”°ë¥¸-ì²˜ë¦¬\" style=\"position:relative;\">ì»¤ë„ TCP ì†Œì¼“ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬<a href=\"#%EC%BB%A4%EB%84%90-tcp-%EC%86%8C%EC%BC%93-%EC%83%81%ED%83%9C%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%B2%98%EB%A6%AC\" aria-label=\"ì»¤ë„ tcp ì†Œì¼“ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>4-way handshake ë‹¨ê³„ë¥¼ ì§„í–‰ ì¤‘ì¸ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚´ë©´ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.<br>\nì‹¤ì œë¡œëŠ” êµ‰ì¥íˆ ì§§ì€ ì‹œê°„ì— ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ì¬í˜„í•˜ê¸° í˜ë“¤ì–´ TCP ì»¤ë„ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë©´ì„œ ìœ ì¶”í•´ë³´ì.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fcb9f339dfde65490a7ecb3b01faf28a/9a1cf/4way-handshake.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVR42m1Sa3ObMBDk//+zfmrS5otjM1OIjYTAoPcTRNdo4glNd2yNpNPe7t1Rrevq7ajlTUyt4o2cG6evwasNyOuWc15z0JoTwpqGU4pV9cxrnbetWpY1eKbFhXWvd/ZGrj+DrWMQ287Gf1nXqLUmHT1f+PXW17WmNBqDtJUxVvBxGq987tRMghq8pEv023BfT3V+rzfKYgiQitbKaXJaO6Wi98hbzfPcM0YI7dmAJI5LL1RUJkm1GRO56P989FcSHker71OCVYg+bOVqX3d7y+L3fAj7GKz3xpqBq9dz87v+0D4gZK1Fj7ZPVPkTuI0xbkes64LLFGHZonDG2LhjmibOefXl3ZOcY0qTUOMsQlqeoRBC4aBSrEqpA7nYBlxMNRl/Xdq70CmGlFJxCz5ocCGlfNj+TsZTbPphxM+h1Jwh65wrziml0O/7Hu8rQsjtdmvbFmcEjDEpRW1sTe4v55ZOwhjtvEfGhyPnDg3DAQE0DGowgw2OeCSEVFoXzhMQx1CeA6pAgDKcdF0HZbQBWcoLzBMNCzGVceAGvg7KyA0CUmAVQsQduMTasOnH23s78K/KB/JzBzXEiqVSi7Z2FlIoFXb8R/n7F/YPSjuA0mrUeDqdyqj+Aia9YZP7zMFVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4way handshake\"\n        title=\"\"\n        src=\"/static/fcb9f339dfde65490a7ecb3b01faf28a/1cfc2/4way-handshake.png\"\n        srcset=\"/static/fcb9f339dfde65490a7ecb3b01faf28a/3684f/4way-handshake.png 225w,\n/static/fcb9f339dfde65490a7ecb3b01faf28a/fc2a6/4way-handshake.png 450w,\n/static/fcb9f339dfde65490a7ecb3b01faf28a/1cfc2/4way-handshake.png 900w,\n/static/fcb9f339dfde65490a7ecb3b01faf28a/9a1cf/4way-handshake.png 924w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>Active Closerì˜ ì •ìƒì ì¸ ìƒíƒœ ì§„í–‰</strong> ESTABLISHED â†’ FIN_WAIT1 â†’ FIN_WAIT2 â†’ TIME_WAIT â†’ CLOSE</p>\n<h2 id=\"ì»¤ë„-ë ˆë²¨-ì²˜ë¦¬-ë¡œì§\" style=\"position:relative;\">ì»¤ë„ ë ˆë²¨ ì²˜ë¦¬ ë¡œì§<a href=\"#%EC%BB%A4%EB%84%90-%EB%A0%88%EB%B2%A8-%EC%B2%98%EB%A6%AC-%EB%A1%9C%EC%A7%81\" aria-label=\"ì»¤ë„ ë ˆë²¨ ì²˜ë¦¬ ë¡œì§ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_ipv4.c#L1905\">tcp_ipv4.c <code class=\"language-text\">tcp_v4_do_rcv(...)</code></a> í•¨ìˆ˜ë¥¼ ë³´ë©´ ì†Œì¼“ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬ ë°©ì‹ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>\n<h4>ì£¼ìš” TCP ìƒíƒœ ì„¤ëª…</h4>\n<ol>\n<li><strong>FIN-WAIT-1</strong>: ìì‹ ì´ ë³´ë‚¸ ì¢…ë£Œ ìš”ì²­(FIN)ì— ëŒ€í•œ ACKì„ ê¸°ë‹¤ë¦¬ê±°ë‚˜, ìƒëŒ€ë°©ì˜ FINì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ</li>\n<li><strong>CLOSE-WAIT</strong>: ìƒëŒ€ë°©ìœ¼ë¡œë¶€í„° FINì„ ë°›ê³  ACKë¥¼ ë³´ë‚¸ í›„, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ close()ë¥¼ í˜¸ì¶œí•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ</li>\n<li><strong>FIN-WAIT-2</strong>: ìƒëŒ€ë°©ì˜ FINì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ (ìì‹ ì˜ FINì— ëŒ€í•œ ACKëŠ” ì´ë¯¸ ë°›ìŒ)</li>\n<li><strong>LAST-ACK</strong>: ìì‹ ì´ ë³´ë‚¸ FINì— ëŒ€í•œ ACKë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœ</li>\n<li><strong>TIME-WAIT</strong>: ìƒëŒ€ë°©ì´ ë§ˆì§€ë§‰ ACKë¥¼ í™•ì‹¤íˆ ë°›ì•˜ìŒì„ ë³´ì¥í•˜ê³ , ì´ì „ ì—°ê²°ì˜ ì§€ì—°ëœ íŒ¨í‚·ì´ ìƒˆ ì—°ê²°ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ ì¼ì • ì‹œê°„ ëŒ€ê¸°í•˜ëŠ” ìƒíƒœ (ë³´í†µ 2*MSL)</li>\n<li><strong>CLOSED</strong>: ì—°ê²°ì´ ì™„ì „íˆ ì¢…ë£Œëœ ìƒíƒœ</li>\n</ol>\n<deckgo-highlight-code language=\"c\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">int tcp_v4_do_rcv(struct sock *sk, struct sk_buff *skb)\n{\n    // 1. ìˆ˜ì‹ ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©ì ì˜ì—­ì— ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ìƒíƒœì¸ ê²½ìš°\n    if (sk-&gt;sk_state == TCP_ESTABLISHED) { /* Fast path */\n        // ...\n        tcp_rcv_established(sk, skb);\n        return 0;\n    }\n\n    // 2. ì—°ê²° ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœì¸ ê²½ìš°\n    if (sk-&gt;sk_state == TCP_LISTEN) {\n        // ...\n    } else\n        sock_rps_save_rxhash(sk, skb);\n\n    // 3. ê·¸ ì™¸ì˜ ìƒíƒœì¸ ê²½ìš°\n    reason = tcp_rcv_state_process(sk, skb);\n    if (reason) {\n        rsk = sk;\n        goto reset;\n    }\n    return 0;\n\n// RST íŒ¨í‚· ì „ì†¡\nreset:\n    tcp_v4_send_reset(rsk, skb, sk_rst_convert_drop_reason(reason));\n\ntcp_rcv_state_process(struct sock *sk, struct sk_buff *skb)\n{\n    ... (ì¤‘ëµ) ...\n    switch (sk-&gt;sk_state) {\n    case TCP_CLOSE:\n        ... (ì¤‘ëµ) ...\n\n    case TCP_LISTEN:\n        if (th-&gt;ack)\n            return 1;\n\n        if (th-&gt;rst) {\n            ... (ì¤‘ëµ) ...\n        }\n        if (th-&gt;syn) {\n            ... (ì¤‘ëµ) ...\n        }\n        goto discard;\n\n    case TCP_SYN_SENT:\n        ... (ì¤‘ëµ) ...\n        return 0;\n    }\n    ... (ì¤‘ëµ) ...\n\n    switch (sk-&gt;sk_state) {\n    case TCP_SYN_RECV:\n        ... (ì¤‘ëµ) ...\n    case TCP_FIN_WAIT1:\n    case TCP_FIN_WAIT2:\n        if (sk-&gt;sk_shutdown &amp; RCV_SHUTDOWN) {\n            // ì„œë²„ê°€ close()ë¥¼ í˜¸ì¶œí–ˆìœ¼ë¯€ë¡œ RCV_SHUTDOWNì´ ì„¤ì •ë¨\n            if (TCP_SKB_CB(skb)-&gt;end_seq != TCP_SKB_CB(skb)-&gt;seq &amp;&amp;\n                after(TCP_SKB_CB(skb)-&gt;end_seq - th-&gt;fin, tp-&gt;rcv_nxt)) {\n                // ë°ì´í„°ê°€ í¬í•¨ëœ íŒ¨í‚·ì´ë©´\n                NET_INC_STATS(sock_net(sk), LINUX_MIB_TCPABORTONDATA);\n                tcp_reset(sk, skb);  // â† RST ì „ì†¡!\n                return SKB_DROP_REASON_TCP_ABORT_ON_DATA;\n            }\n        }\n        ... (ì¤‘ëµ) ...\n    case TCP_CLOSING:\n        ... (ì¤‘ëµ) ...\n    case TCP_LAST_ACK:\n        ... (ì¤‘ëµ) ...\n    }\n}</code>\n        </deckgo-highlight-code>\n<ol>\n<li><strong>TCP_FIN_WAIT1, TCP_FIN_WAIT2 ìƒíƒœ</strong> : ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ ì¦‰ì‹œ RST íŒ¨í‚· ì „ì†¡</li>\n<li><strong>TCP_TIME_WAIT ìƒíƒœ</strong> : RST íŒ¨í‚· ì „ì†¡ <a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_minisocks.c#L99\">tcp_minisocks.c#L99</a>\n<ul>\n<li>TIME_WAITì€ ë§ˆì§€ë§‰ ACKê°€ ìœ ì‹¤ë  ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ìƒëŒ€ë°©ì´ FINì„ ì¬ì „ì†¡í•˜ëŠ” ê²½ìš° ëŒ€ì‘í•˜ê¸° ìœ„í•œ ìƒíƒœì´ë‹¤.</li>\n</ul>\n</li>\n</ol>\n<p>ì´ëŠ” ì¢…ë£Œ ì ˆì°¨ê°€ ì§„í–‰ ì¤‘ì¸ ì—°ê²°ì— ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì˜¤ëŠ” ê²ƒì„ ë¹„ì •ìƒì ì¸ ìƒí™©ìœ¼ë¡œ ê°„ì£¼í•˜ì—¬ ê°•ì œë¡œ ì—°ê²°ì„ ë¦¬ì…‹í•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p>\n<h1 id=\"ì›ì¸ê³¼-ì˜ˆë°©-ë°©ë²•\" style=\"position:relative;\">ì›ì¸ê³¼ ì˜ˆë°© ë°©ë²•<a href=\"#%EC%9B%90%EC%9D%B8%EA%B3%BC-%EC%98%88%EB%B0%A9-%EB%B0%A9%EB%B2%95\" aria-label=\"ì›ì¸ê³¼ ì˜ˆë°© ë°©ë²• permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code class=\"language-text\">PrematureCloseException</code>ì˜ˆì™¸ê°€ ë¬´ì—‡ì¸ì§€, ì˜ˆì™¸ì˜ ë©”ì„¸ì§€ê°€ ì™œ ì„œë¡œ ë‹¤ë¥¸ì§€ ì•Œì•„ë³´ì•˜ë‹¤.<br>\nì´ ì˜ˆì™¸ì˜ ì›ì¸ì¸ ì„œë²„ê°€ ê°‘ìê¸° ì—°ê²°ì„ ëŠëŠ” ê²½ìš°ëŠ” ì–´ë–¤ ê²½ìš°ê°€ ìˆëŠ”ì§€, ì˜ˆë°© ë°©ë²•ì€ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë³´ì.</p>\n<h2 id=\"ë¡œë“œë°¸ëŸ°ì„œì™€-ì„œë²„ê°„-timeoutì´-ë‹¤ë¥¸-ê²½ìš°\" style=\"position:relative;\">ë¡œë“œë°¸ëŸ°ì„œì™€ ì„œë²„ê°„ timeoutì´ ë‹¤ë¥¸ ê²½ìš°<a href=\"#%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%84%9C%EC%99%80-%EC%84%9C%EB%B2%84%EA%B0%84-timeout%EC%9D%B4-%EB%8B%A4%EB%A5%B8-%EA%B2%BD%EC%9A%B0\" aria-label=\"ë¡œë“œë°¸ëŸ°ì„œì™€ ì„œë²„ê°„ timeoutì´ ë‹¤ë¥¸ ê²½ìš° permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/555356b46aaaacb57ab39a73ef22b7fd/ba4d9/diff-timeout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7klEQVR42o1Sy4/ScBDu3+tFjRf/iI2evJh4Xh+JHtb14EUJsOtKd8FCX9JSHqVPoNDyaCntZ+dHVyAbEyf50pn5Tef1DZfnGfI8P8GJkH2PUqIohO9O0HUEXA0/w5hJUP1b/PbvwOF/5KhQFEW4/nGNmzqPT403eNV4Ct76io5Xh7nQwA0CGeNQhxX2MJjLmK7sQ5Lik82GiD8+Ryp8Ye75fA5Zlpkeb9ewJiMYIw2mO0BWTMu9qD3CW+EMd/Y3KBMeXasDVVWha13wv0RIF6+BD48Rnj+B1GqgVr9Cq9lkCbfbBOPxGGJHKuJ1pLsUnBUacMIhzKmOcBOwwCwr9lqAJPH6WJw/w6p1yewgCKAoyiEOeTnQngu2Q3Nkgv95C9+flI+nxGRHPhq5WqtCU3uoKpd4336JpllBc/wdLasCjmX+WyV/iLLbPNsxO01TOK4DuaOiolzgnXgGeXoDbdZElAT7Dqn13W73T5IpyYNzKv9zPQeKKqPX17GJN/uEy+USmqYVI/twXRe2bcNxHKZ7ngdRFGFZFtPJR28E23YgSRIjkciJk/hwh0mSsP0sFgsYhsGWT1itVojjmPnDMGRF+/0+a4J8hKwkkIQ7JkHXdQaqSLdGXdMhr9drCILA2KV3Kthut5lNMVTwPuEfIdQ56qr3vvQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"diff timeout\"\n        title=\"\"\n        src=\"/static/555356b46aaaacb57ab39a73ef22b7fd/ba4d9/diff-timeout.png\"\n        srcset=\"/static/555356b46aaaacb57ab39a73ef22b7fd/3684f/diff-timeout.png 225w,\n/static/555356b46aaaacb57ab39a73ef22b7fd/fc2a6/diff-timeout.png 450w,\n/static/555356b46aaaacb57ab39a73ef22b7fd/ba4d9/diff-timeout.png 564w\"\n        sizes=\"(max-width: 564px) 100vw, 564px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ì´ ì´ë¯¸ì§€ì™€ ê°™ì´ LBì™€ ì„œë²„ì˜ timeout ê°’ì´ ì„œë¡œ ë‹¤ë¥¼ ë•Œ RST íŒ¨í‚·ìœ¼ë¡œ ì¸í•´ PrematureCloseException ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8f7e0090625157b9cdad1b2377d1bf26/dcc98/lb-timeout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABq0lEQVR42pWT2W7bMBBF8/+P/ZYCfW+B1q0TBAgQGHFs2ZYlWZIlaiW1kTxlk9gPTtHGAxDDbQ5nBrw3XFjfGw5RxjSObmXIsxpvHdHUEpEX7P2IvutJ4pLlMkYp/RJn7Wv8zSXQGEPX7emHnYPv3HxHnj8hxJKqWrn1Bj2EjMqnV8cz6GTvgVhqXZPKlLiKyVVONZYUfUHpvDLqnJG9pP0daGhMS4tE0dFaV2pXsEm27POAdpJXAq0D6splJTjUAaLPHDCjGDO3l6N0ex3QomnaBVI9ktZ3ROmcTDzQjWvX14XzISfix4B2QHf3yPI7xfEbqvzKIG8x0xZ0iNXH6zLETi5o68ba1b+nSD7jLT5RHr8wygd0710B1O5PqRYrQ0wbMDUBVsWM+Rx5nNGIGWN3Av6r5NNB6xoeHbCHlGEX0KxW1JtbKu8HUxm9XjX2AxmegTWTv6JdLRCP99TPS8TTnMb7iRbhFUDeLnWCJrwj9WYI/xdDHDAcMnRSuscUf1jTpN8UZRlH83+lSGkIgpoXKTvLMoXn5S+aLUuJ76dOkpokaXlepu+0/Bu4ZvLLzmbgdAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"lb timeout\"\n        title=\"\"\n        src=\"/static/8f7e0090625157b9cdad1b2377d1bf26/1cfc2/lb-timeout.png\"\n        srcset=\"/static/8f7e0090625157b9cdad1b2377d1bf26/3684f/lb-timeout.png 225w,\n/static/8f7e0090625157b9cdad1b2377d1bf26/fc2a6/lb-timeout.png 450w,\n/static/8f7e0090625157b9cdad1b2377d1bf26/1cfc2/lb-timeout.png 900w,\n/static/8f7e0090625157b9cdad1b2377d1bf26/21482/lb-timeout.png 1350w,\n/static/8f7e0090625157b9cdad1b2377d1bf26/d61c2/lb-timeout.png 1800w,\n/static/8f7e0090625157b9cdad1b2377d1bf26/dcc98/lb-timeout.png 2613w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ë¡œë“œë°¸ëŸ°ì„œì˜ ì„¸ì…˜ í…Œì´ë¸”ì´ ê°±ì‹ ë˜ëŠ” ê²½ìš° ì§ì ‘ì ìœ¼ë¡œ FIN ì´ë‚˜ RSTë¥¼ ë³´ë‚´ì§€ ì•Šê³  ì¡°ìš©íˆ ì„¸ì…˜ í…Œì´ë¸”ì„ ê°±ì‹ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.<br>\nì†¡ì‹  ì„œë²„ëŠ” ì´ë¯¸ 3-way handshakeê°€ ëë‚¬ë‹¤ê³  ê¸°ì–µí•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë°”ë¡œ ë°”ë””ë¥¼ ì „ì†¡í•˜ëŠ” ê²½ìš° ë¡œë“œë°¸ëŸ°ì„œëŠ” RST í”Œë˜ê·¸ë¥¼ ë°˜í™˜í•˜ëŠ” ì¼€ì´ìŠ¤ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.</p>\n<blockquote>\n<p>Itâ€™s also important to note that almost all firewalls will silently remove idle connections from their state and will not initiate a close (send a TCP FIN or RST) to the client or server.<br>\nThe NLB has a fixed idle timeout of 350 seconds for TCP flows. Once the idle timeout is reached or a TCP connection is closed, it is removed from NLBâ€™s connection state table.<br>\n<a href=\"https://aws.amazon.com/ko/blogs/networking-and-content-delivery/introducing-configurable-idle-timeout-for-connection-tracking/\"><code class=\"language-text\">AWS</code> Introducing configurable Idle timeout for Connection tracking</a></p>\n</blockquote>\n<h2 id=\"webclient-maxidletime-ì„¤ì •-ë¶€ì¬\" style=\"position:relative;\">WebClient maxIdleTime ì„¤ì • ë¶€ì¬<a href=\"#webclient-maxidletime-%EC%84%A4%EC%A0%95-%EB%B6%80%EC%9E%AC\" aria-label=\"webclient maxidletime ì„¤ì • ë¶€ì¬ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f556678baa511f7b90dcfc8b3d7ea39d/7c1cd/timeout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwUlEQVR42m2SS4/TQBCE81uR+B9cOCPOHAAhceHEsloOvCSEeBwSEpRk14/YiZ3YjhPs2FFix+vxx4yNs2HZlkr29ExXTVdPByGoypIy8Lmeu5TrEKj4Lypxd/5WdMRmw2FicjA0CtuikF+VazikWFXVaBLVcd1ANKiFGnREHCOcOcL1uJ5NKVyH0vOoks3J5UpEaFLl2zZz+/qISp6R5B21/Gqf8UF/yaX3jcH8E0bQZRsnbLcpqyghNrsUL+6Tv3tEvArYpCn+ImA06/HWeErf+8xo+Z1x+KMhPLt6wqvRY/S4h5NeEW9/M53NcJ0Zl6aN9eU1+fN7pG8eov/qok8m9LsDPv4851n/AT3/PWbcJ9ovG0LlR7bPMEwNz1/Q5trWRJGxG1xwCCZHL9vYZ3scKazLWiH+tqwikZ45jkMsPb0hvAlR3T3jPM9xXbeGqjkSFkWBJ4eRSn+iKDpCCUQSpqETLpds5As43U+ShNVqJf1uBtY5VdvtdoRhyHq9ZiJ9UqrtWgmpQvXv+z6aptWEaj8IAkr5lv8hbFucTqc1ma7rNQzDYLFY1DcZDoeYpollWdi2zXg8rm1S+SzLasI/F9j0hSJXFcYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"timeout\"\n        title=\"\"\n        src=\"/static/f556678baa511f7b90dcfc8b3d7ea39d/7c1cd/timeout.png\"\n        srcset=\"/static/f556678baa511f7b90dcfc8b3d7ea39d/3684f/timeout.png 225w,\n/static/f556678baa511f7b90dcfc8b3d7ea39d/fc2a6/timeout.png 450w,\n/static/f556678baa511f7b90dcfc8b3d7ea39d/7c1cd/timeout.png 582w\"\n        sizes=\"(max-width: 582px) 100vw, 582px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ì‹¤ë¬´ì˜ ìš´ì˜í™˜ê²½ì€ ìœ„ì™€ ê°™ì´ ë¡œë“œë°¸ëŸ¬ì„œì™€ ìˆ˜ì‹  ì„œë²„ì˜ timeout ì„¤ì •ì´ ë™ì¼í–ˆê¸° ë•Œë¬¸ì— ì„¸ì…˜ í…Œì´ë¸” ê°±ì‹ ì´ ì›ì¸ì´ ë˜ì§€ëŠ” ì•Šì„ ê²ƒì´ë‹¤.<br>\në˜ ë‹¤ë¥¸ ì¶”ì •ìœ¼ë¡œëŠ” Reactor Netty í´ë¼ì´ì–¸íŠ¸ê°€ ì»¤ë„¥ì…˜ í’€ì„ í†µí•´ Connectionì„ íšë“í–ˆì„ ë•ŒëŠ” ì—´ë ¤ ìˆì—ˆì§€ë§Œ ê·¸ ì§í›„ ì™¸ë¶€ ìš”ì¸(ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ìš”ì†Œ ë“±)ìœ¼ë¡œ ì¸í•´ ì—°ê²°ì´ ë‹«íŒ ê²½ìš°ì´ë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9728c777cc33f970040b2d8c296358da/7b857/connection-race-condition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSklEQVR42p2Ta2/bIBSG+/9/0jR1Hzd1UqN2UpXm0jSzXV8wmYHYYAd4hrZ8bSSbI4R0dHh4X+DccWPI9sRJHBlMjRQ5Z11SFgWXS/x0z90t4MWfObsdonshr55Q/RrjcjxhGdDHQN1LDuJAJo903qCjY0qxCBgS0HhNcVpRiO90/RZhtjivrhVxJjBYxiljsEeU3qH1L+ywSflxrsL/J4dLi7ePWPXAqfqKkd+I0+aWhhsKB0sUktA2THXOWJWM4oX2/Z4w6jmWr0X9GVesGPIVLsvpf6fvUn4wFkdwdoHCBIxVRvP2TPP6SqgbSIpj2yXguMwyQuHKBrnd82e3p39fow/PBGtmWI7XBzECuf5Bs3nAZm9pVkxFxpjvibaff4d+VDTZT8rDF9THE329x7U7ok7W/cJO6TqL6jTaGOpaYoz6t3r/eS//BS6H+CC+SY/lAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connection race condition\"\n        title=\"\"\n        src=\"/static/9728c777cc33f970040b2d8c296358da/1cfc2/connection-race-condition.png\"\n        srcset=\"/static/9728c777cc33f970040b2d8c296358da/3684f/connection-race-condition.png 225w,\n/static/9728c777cc33f970040b2d8c296358da/fc2a6/connection-race-condition.png 450w,\n/static/9728c777cc33f970040b2d8c296358da/1cfc2/connection-race-condition.png 900w,\n/static/9728c777cc33f970040b2d8c296358da/21482/connection-race-condition.png 1350w,\n/static/9728c777cc33f970040b2d8c296358da/d61c2/connection-race-condition.png 1800w,\n/static/9728c777cc33f970040b2d8c296358da/7b857/connection-race-condition.png 1941w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ ì™„ë£Œ í›„ ì»¤ë„¥ì…˜ì„ í’€ì— ë°˜í™˜ (ì‹œê° <code class=\"language-text\">T0</code>)</li>\n<li>ì„œë²„ì˜ keep-alive timeoutì€ <code class=\"language-text\">60ì´ˆ</code></li>\n<li>í´ë¼ì´ì–¸íŠ¸ maxIdleTimeì€ ë¬´ì œí•œ</li>\n<li><code class=\"language-text\">T0 + 60ì´ˆ ì´ìƒ</code>ì— í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ì»¤ë„¥ì…˜ì„ ë‹¤ì‹œ ì‚¬ìš©í•˜ë ¤ê³  ì‹œë„</li>\n<li>ì„œë²„ëŠ” ì´ë¯¸ ì»¤ë„¥ì…˜ì„ ë‹«ì•˜ê±°ë‚˜ ë‹«ëŠ” ê³¼ì •ì— ìˆìŒ</li>\n<li><strong>Race Condition ë°œìƒ</strong>: í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì„ ë³´ë‚´ëŠ” ì‹œì ê³¼ ì„œë²„ì˜ ì—°ê²° ì¢…ë£Œ ì‹œì ì´ ê²¹ì¹¨</li>\n<li><strong>PrematureCloseException ë°œìƒ</strong></li>\n</ol>\n<p>ì´ ê²½ìš° Reactor Nettyì˜ timeout ê´€ë ¨ ì˜µì…˜ì„ ì ì ˆíˆ ì¡°ì •í•˜ë©´ ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤.</p>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">// AS-IS\nprivate val client = WebClient.builder()\n    .baseUrl({url})\n    .build()\n\n// TO-BE\nprivate fun connectionProvider(): ConnectionProvider =\n    ConnectionProvider.builder(&quot;client-pool&quot;)\n        .maxIdleTime(Duration.ofSeconds(45)) // ì„œë²„ keep-alive timeout ë³´ë‹¤ ì§§ê²Œ ì„¤ì •\n        .build()\n\nprivate val httpClient = HttpClient.create(connectionProvider())\n\nprivate val client = WebClient\n    .builder()\n    .clientConnector(ReactorClientHttpConnector(httpClient))\n    .baseUrl(baseURL)\n    .build()</code>\n        </deckgo-highlight-code>\n<p>ì„œë²„ê°€ ì»¤ë„¥ì…˜ì„ ë‹«ê¸° ì „ì— í´ë¼ì´ì–¸íŠ¸ê°€ proactiveí•˜ê²Œ ì»¤ë„¥ì…˜ì„ ì •ë¦¬í•´ì„œ race conditionì„ ë°©ì§€í•  ìˆ˜ ìˆê¸°ì— maxIdleTimeì„ ì„œë²„ì˜ keep-alive timeoutë³´ë‹¤ ì‘ê²Œ ì§€ì •í•˜ì˜€ë‹¤.</p>\n<h2 id=\"maxidletime-ì„¤ì •-ì´í›„-ì»¤ë„¥ì…˜-í’€-ì˜ˆì™¸-ë°œìƒ\" style=\"position:relative;\">maxIdleTime ì„¤ì • ì´í›„ ì»¤ë„¥ì…˜ í’€ ì˜ˆì™¸ ë°œìƒ<a href=\"#maxidletime-%EC%84%A4%EC%A0%95-%EC%9D%B4%ED%9B%84-%EC%BB%A4%EB%84%A5%EC%85%98-%ED%92%80-%EC%98%88%EC%99%B8-%EB%B0%9C%EC%83%9D\" aria-label=\"maxidletime ì„¤ì • ì´í›„ ì»¤ë„¥ì…˜ í’€ ì˜ˆì™¸ ë°œìƒ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>maxIdleTimeì„ ì„¤ì •í•œ ì´í›„ ì»¤ë„¥ì…˜ í’€ì˜ ì»¤ë„¥ì…˜ ê³ ê°ˆ ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²ƒì„ í™•ì¸í–ˆë‹¤.</p>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Exception in thread &quot;DefaultDispatcher-worker-5&quot; Exception in thread &quot;DefaultDispatcher-worker-1&quot; Exception in thread &quot;DefaultDispatcher-worker-7&quot; Exception in thread &quot;DefaultDispatcher-worker-10&quot; Exception in thread &quot;DefaultDispatcher-worker-3&quot; org.springframework.web.reactive.function.client.WebClientRequestException: Pending acquire queue has reached its maximum size of 32</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Creating a new [client-pool] client pool \n[\n    PoolFactory{\n        evictionInterval=PT0S,\n        leasingStrategy=fifo, \n+       maxConnections=16, \n        maxIdleTime=45000, \n        maxLifeTime=-1, \n        metricsEnabled=false, \n+       pendingAcquireMaxCount=32, \n        pendingAcquireTimeout=45000\n    }\n] \nfor [{url}]</code>\n        </deckgo-highlight-code>\n<h4>maxIdleTime ì„¤ì • ì „</h4>\n<ul>\n<li>ì—°ê²°ì€ ì¶©ë¶„íˆ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê¸°ì— ë¶ˆê·œì¹™í•œ íŠ¸ë˜í”½ì— ìœ ìš©í•¨.</li>\n<li>í•˜ì§€ë§Œ ì„œë²„ê°€ FIN íŒ¨í‚·ì„ ë³´ë‚¼ ë•Œê¹Œì§€ Connectionì„ ë³´ìœ í•˜ê¸°ì— PrematureCloseException ë°œìƒ ê°€ëŠ¥ì„± ë†’ì•˜ìŒ.</li>\n<li>ë˜í•œ Stale Connection ë¬¸ì œë¡œ Connection reset by peer ì˜ˆì™¸ë„ ë°œìƒ ê°€ëŠ¥ì„± ìˆìŒ.</li>\n</ul>\n<h4>maxIdleTime ì„¤ì • í›„</h4>\n<ul>\n<li>PrematureCloseException ë°œìƒ ê°€ëŠ¥ì„± ë° Stale Connection ë¬¸ì œë¥¼ ì˜ˆë°©í•  ìˆ˜ ìˆìŒ.</li>\n<li>í•˜ì§€ë§Œ idle ì‹œê°„ ì´ˆê³¼ë¡œ ì¸í•´ Connectionì´ ìì£¼ ì œê±°ë˜ì–´ ìƒˆ ì—°ê²°ì„ ê³„ì† ìƒì„±í•˜ê¸°ì— TCP ì˜¤ë²„í—¤ë“œ ì¦ê°€.</li>\n<li><code class=\"language-text\">ì—°ê²° ìƒì„± ì†ë„ &lt; ìš”ì²­ ì†ë„</code> ëŒ€ê¸° íì— ìš”ì²­ì´ ìŒ“ì—¬ Connection ê³ ê°ˆ ë¬¸ì œ ë°œìƒí•  ìˆ˜ ìˆìŒ.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/12ded8d31c9f1e0ef99a553a9ff648b3/0eb6d/rate-limiter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.444444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVR42m2QS0vDQBSF84v9O65cuRBBFy7cWFA3glIoLYpQW/Nq05lJkzaZpnknn0nFF3iGy+Hce5lzZgyxs/CTBUmqycuaTFnUo0tyHZJlJTJyWcRvqG4nrTU6THBnHktTEIgtPSzb5fjkFK13GE/ODU44Jdz4rPwQMb5jf3aEmk9wXMnjdMD9+wVz/4WClMVMcHv1wPX5gNfhjCpr8IOA4WjCfp9iCCHYRp9OPdq6os4TfkNJhVLqWxdFgbf0yPP8oM0u4Wj8jLeSGHEc01cYhsRR1PGGYLNlpzXrYN09Qx9mVVX9mHbnC03TdF+Tk3WX92z0jT6laZrYto2UsksksS0Lx3EOvZ7LsvyTum3bf/UH8Pl4Oofp6BwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"rate limiter\"\n        title=\"\"\n        src=\"/static/12ded8d31c9f1e0ef99a553a9ff648b3/1cfc2/rate-limiter.png\"\n        srcset=\"/static/12ded8d31c9f1e0ef99a553a9ff648b3/3684f/rate-limiter.png 225w,\n/static/12ded8d31c9f1e0ef99a553a9ff648b3/fc2a6/rate-limiter.png 450w,\n/static/12ded8d31c9f1e0ef99a553a9ff648b3/1cfc2/rate-limiter.png 900w,\n/static/12ded8d31c9f1e0ef99a553a9ff648b3/0eb6d/rate-limiter.png 913w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<br/></p>\n<p>ì´ ìƒí™©ì„ ê³ ë ¤í•´ì„œ ì„¤ì •ì„ ë‹¤ì‹œ í–ˆë‹¤.</p>\n<ol>\n<li><strong>í•˜ë£¨ì— Në²ˆ ì •ê¸°ì ìœ¼ë¡œ í˜¸ì¶œ</strong></li>\n<li><strong>400 ~ 500ëª…ì— ëŒ€í•œ ë°°ì¹˜ì„± ë¶€í•˜</strong></li>\n<li><strong>ì‹¤ì‹œê°„ì´ ë³´ì¥ë˜ì§€ ì•Šì•„ë„ ì¢‹ìŒ</strong></li>\n<li><strong>í•œ ë²ˆì¯¤ ì „ì†¡ë˜ì§€ ì•Šì•„ë„ í° ë¬¸ì œê°€ ìˆì§€ ì•ŠìŒ</strong></li>\n<li><strong>B ì„œë²„ì˜ ì‘ë‹µì€ 300ms ì´ë‚´ ì‘ë‹µ</strong></li>\n<li><strong>ì™¸ë¶€ API ì„œë²„ì— rate limiterê°€ ì¡´ì¬í•¨</strong></li>\n</ol>\n<deckgo-highlight-code language=\"diff\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Creating a new [client-pool] client pool \n[\n    PoolFactory{\n        evictionInterval=PT0S,\n        leasingStrategy=fifo, \n-       maxConnections=16,         \n+       maxConnections=10, -- rate limiterê°€ ì¡´ì¬í•˜ì—¬ ë°©ì–´ì ìœ¼ë¡œ ì „ì†¡\n        maxIdleTime=45000, \n        maxLifeTime=-1, \n        metricsEnabled=false, \n-       pendingAcquireMaxCount=32, \n+       pendingAcquireMaxCount=500,  -- ìµœëŒ€ ìš”ì²­ì— ìˆ˜ìš© ê°€ëŠ¥í•œ ì •ë„\n-       pendingAcquireTimeout=45000\n+       pendingAcquireTimeout=180000  -- ìµœëŒ€ ìš”ì²­ì´ ì¦ê°€í•¨ì— ëŒ€ë¹„í•˜ì—¬ ì—¬ìœ ë¡­ê²Œ ëŒ€ê¸°\n    }\n] \nfor [{url}]</code>\n        </deckgo-highlight-code>\n<h1 id=\"-db-connection-poolì€-ì–´ë–»ê²Œ-ì„¤ì •í•˜ëŠ”ê²Œ-ì¢‹ì„ê¹Œ\" style=\"position:relative;\">ğŸ’¡ DB Connection Poolì€ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ?<a href=\"#-db-connection-pool%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%84%A4%EC%A0%95%ED%95%98%EB%8A%94%EA%B2%8C-%EC%A2%8B%EC%9D%84%EA%B9%8C\" aria-label=\" db connection poolì€ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>ê·¸ë ‡ë‹¤ë©´ DB Connection Poolì€ ì–´ë–»ê²Œ ì„¤ì •í•´ì•¼ í• ê¹Œ?<br>\n<a href=\"https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing\">HikariCP About Pool Sizing</a>ì„ í†µí•´ Pool Sizingì— ëŒ€í•œ ê°€ì´ë“œë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.</p>\n<ul>\n<li>í’€ ì‚¬ì´ì¦ˆ ê´€ë ¨ ì„¤ì •ë“¤(<strong>maximumPoolSize</strong>, minimumIdle, idleTimeout)</li>\n<li>ì»¤ë„¥ì…˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬(maxLifetime, <strong>keepaliveTime</strong>)</li>\n<li>ì»¤ë„¥ì…˜ ìš”ì²­ ëŒ€ê¸°(<strong>connectionTimeout</strong>)</li>\n</ul>\n<p>í’€ ì‚¬ì´ì¦ˆ ê´€ë ¨ ì„¤ì • ì¤‘ maximumPoolSizeì— ëŒ€í•´ ì¼ë°˜ì ìœ¼ë¡œ ì¶”ì²œí•˜ëŠ” ì‚¬ì´ì¦ˆëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">core_count: í•˜ì´í¼ìŠ¤ë ˆë”© ì œì™¸í•œ ë¬¼ë¦¬ ì½”ì–´ ìˆ˜\neffective_spindle_count: ì‹¤ì œ ë””ìŠ¤í¬ ë™ì‹œ ì²˜ë¦¬ ê°€ëŠ¥ ìˆ˜ (ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ì— ìºì‹±ë˜ì–´ ìˆìœ¼ë©´ 0)\n\nconnections = ((core_count * 2) + effective_spindle_count)</code>\n        </deckgo-highlight-code>\n<p>ê·¸ë ‡ë‹¤ê³  í’€ ì‚¬ì´ì¦ˆë¥¼ ë‹¨ìˆœíˆ í¬ê²Œ ì§€ì •í•œë‹¤ê³  í•´ì„œ ì„±ëŠ¥ì´ ë³´ì¥ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.</p>\n<ul>\n<li>ì†Œìˆ˜ ì»¤ë„¥ì…˜ì´ ìŠ¤ë ˆë“œì— ì˜í•´ í¬í™”ë  ë•Œê°€ ìµœì </li>\n<li>ë‚˜ë¨¸ì§€ ìŠ¤ë ˆë“œëŠ” ì»¤ë„¥ì…˜ì„ ê¸°ë‹¤ë¦¬ë„ë¡ í•˜ê³ , <strong>ë°ì´í„°ë² ì´ìŠ¤ê°€ ë™ì‹œì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ ìˆ˜(max)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í’€ í¬ê¸° ì‚°ì •</strong></li>\n<li>ê¸°ë³¸ ê°’ì€ 10ê°œ (4ì½”ì–´ + 1ìŠ¤í•€ë“¤ -> 9 ~ 10ê°œ ì ì •)</li>\n</ul>\n<p>ë˜í•œ ë°ë“œ ë½ì„ í”¼í•  ìˆ˜ ìˆëŠ” <strong>ìµœì†Œ ì»¤ë„¥ì…˜ ìˆ˜ ì‚°ì • ê³µì‹</strong>ë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">Tn: ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ìµœëŒ€ ì“°ë ˆë“œ ìˆ˜ (ì˜ˆ: ë™ì‹œ ì²˜ë¦¬ ìš”ì²­ ìˆ˜)\nCm: í•œ ìš”ì²­(Task)ì´ ë™ì‹œì— í•„ìš”ë¡œ í•˜ëŠ” ì»¤ë„¥ì…˜ ìˆ˜ (ì˜ˆ: ID ì±„ë²ˆ/ë©”ì¸ ì¿¼ë¦¬ ë“± ë‹¤ì¤‘ ì»¤ë„¥ì…˜)\n\nìµœì†Œ ì»¤ë„¥ì…˜ í’€ ì‚¬ì´ì¦ˆ = Tn Ã— (Cm âˆ’ 1) + 1</code>\n        </deckgo-highlight-code>\n<p>ì˜ˆë¥¼ ë“¤ì–´, 16ê°œì˜ ìš”ì²­(Tn)ì´ ê°ê° 2ê°œ(Cm)ì˜ ì»¤ë„¥ì…˜ì„ í•„ìš”ë¡œ í•˜ë©´ ìµœì†Œ 17ê°œì˜ ì»¤ë„¥ì…˜ í’€ì„ ì„¤ì •í•´ì•¼ ë°ë“œë½ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.</p>\n<ul>\n<li>ë™ì‹œ ìš”ì²­ 10ê°œ(Tn=10), ìš”ì²­ë‹¹ ìµœëŒ€ 2ê°œ ì»¤ë„¥ì…˜ í•„ìš”(Cm=2) â†’ <code class=\"language-text\">10Ã—(2âˆ’1)+1=11</code></li>\n<li>ë™ì‹œ ìš”ì²­ 20ê°œ, ìš”ì²­ë‹¹ 3ê°œ ì»¤ë„¥ì…˜ í•„ìš” â†’ <code class=\"language-text\">20Ã—(3âˆ’1)+1=41</code></li>\n</ul>\n<blockquote>\n<p><strong>maximumPoolSize (idle + in-use connection)ì™€ ì—°ê´€ëœ ì†ì„±</strong></p>\n<ul>\n<li>minimumIdle: í’€ì—ì„œ ìœ ì§€í•˜ëŠ” ìµœì†Œ idle ì»¤ë„¥ì…˜ ê°¯ìˆ˜ (default: maximumPoolSizeì™€ ë™ì¼)</li>\n<li>idleTimeout: í’€ì—ì„œ ì»¤ë„¥ì…˜ì´ idle ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” ìµœëŒ€ ì‹œê°„ (minimum: 10ì´ˆ, default: 10ë¶„)</li>\n</ul>\n<p>ì¦‰, idle connection ìˆ˜ê°€ minimulIdleë³´ë‹¤ ì‘ê³ , ì „ì²´ connection ìˆ˜ë„ maximumPoolSizeë³´ë‹¤ ì‘ë‹¤ë©´ ì‹ ì†í•˜ê²Œ ì¶”ê°€ë¡œ connectionì„ ë§Œë“ ë‹¤.<br>\n<strong>ê¸°ë³¸ì ìœ¼ë¡œ minimumIdleê³¼ maximumPoolSizeëŠ” ë™ì¼í•œ ê°’ìœ¼ë¡œ ì§€ì •ë˜ì–´ ìˆë‹¤. minimumIdleì„ maximumPoolSizeë³´ë‹¤ ì‘ê²Œ ì„¤ì •í•œ ê²½ìš° ì˜ˆìƒí•˜ì§€ ëª»í•œ íŠ¸ë˜í”½ì´ ëª°ë ¤ì˜¤ë©´ connectionì„ ìƒì„±í•˜ëŠ” ë¹„ìš© ë•Œë¬¸ì— ë³‘ëª©ì´ ìƒê¸¸ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê¸°ë³¸ê°’ì„ í™œìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</strong></p>\n</blockquote>\n<p>ì„œë¹„ìŠ¤ í™˜ê²½ì˜ ë„¤íŠ¸ì›Œí¬ì™€ DB ì†ì„±ì„ í™•ì¸í•˜ì—¬ ì•„ë˜ì˜ ì„¤ì •ë„ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p>\n<ol>\n<li><strong>maxLifetime</strong> : DB í˜¹ì€ ë„¤íŠ¸ì›Œí¬ infraì—ì„œ ì„¤ì •ëœ \"ìµœëŒ€ ì»¤ë„¥ì…˜ ìƒì¡´ ì‹œê°„(wait_timeout ë“±)\"ë³´ë‹¤ ìˆ˜ ì´ˆ ì§§ê²Œ ì„¤ì • í•„ìš” (default 30ë¶„). poolë¡œ ë°˜í™˜ì´ ì•ˆë˜ë©´ connectionì„ ì œê±°í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— poolë¡œ ë°˜í™˜ì„ ì˜ ì‹œì¼œì£¼ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.</li>\n<li><strong>keepaliveTime</strong> : idle ì»¤ë„¥ì…˜ ìƒì¡´ì„ ìœ„í•´ ìƒíƒœ í™•ì¸ ì£¼ê¸°, db/network timeoutë³´ë‹¤ ì§§ê²Œ (default 2ë¶„)</li>\n<li><strong>connectionTimeout</strong> : í’€ì—ì„œ ì»¤ë„¥ì…˜ì„ ê°€ì ¸ì˜¬ ë•Œ ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„, ê¸°ë³¸ ê°’ì€ ë„ˆë¬´ ì»¤ íŠ¸ë˜í”½ì´ ëª°ë¦¬ëŠ” ê²½ìš° ì„œë²„ ìŠ¤ë ˆë“œê°€ ì»¤ë„¥ì…˜ì„ íšë“í•˜ê¸° ìœ„í•´ ëŒ€ëŸ‰ìœ¼ë¡œ ë¸”ë¡œí‚¹ë  ê°€ëŠ¥ì„±ì´ ìˆìŒ (default 30ì´ˆ)</li>\n</ol>\n<blockquote>\n<p>ğŸ’¡ DB ì„œë²„ ì„¤ì •ì€?</p>\n<ul>\n<li><code class=\"language-text\">max_connections</code> : clientì™€ ë§ºì„ ìˆ˜ ìˆëŠ” ìµœëŒ€ connection ìˆ˜ì´ë‹¤. ìŠ¤ì¼€ì¼ ì•„ì›ƒì— ëŒ€ë¹„í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë“¤ì˜ ìµœëŒ€ ì‚¬ìš© ìˆ˜ë¥¼ í™•ì¸í•˜ì—¬ ì„¤ì •í•˜ëŠ”ê²Œ ì¢‹ë‹¤.</li>\n<li><code class=\"language-text\">wait_timeout</code> (default 28800) : connectionì´ inactiveí•  ë•Œ ë‹¤ì‹œ ìš”ì²­ì´ ì˜¤ê¸°ê¹Œì§€ ì–¼ë§ˆì˜ ì‹œê°„ì„ ê¸°ë‹¤ë¦°ë’¤ì— close í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •í•œë‹¤. (ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ keepaliveTimeë³´ë‹¤ ê¸¸ê²Œ ì„¤ì •ë˜ì–´ì•¼ í•œë‹¤.)</li>\n</ul>\n</blockquote>\n<p>ì‹¤ì œ ìµœì ê°’ì„ ì°¾ê¸° ìœ„í•´ ê³µì‹ ê°€ì´ë“œë‚˜ ì¶”ì²œì„ í†µí•´ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆì§€ë§Œ, ì„œë¹„ìŠ¤ íŠ¹ì„±ì— ë”°ë¥¸ íŠ¸ë˜í”½ íŒ¨í„´ì´ë‚˜ ì¿¼ë¦¬ íŒ¨í„´ì€ ë‹¤ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ê¾¸ì¤€í•œ ëª¨ë‹ˆí„°ë§ê³¼ í…ŒìŠ¤íŠ¸ê°€ í•„ìš”í•˜ë‹¤.</p>\n<p>maximumPoolSize: 5 &#x3C;-> max_connections: 30\ní˜„ì¬ ì²˜ë¦¬í•˜ê³  ìˆëŠ” íŠ¸ë˜í”½ì˜ ë‘,ì„¸ ë°°ê°€ ìœ ì…ë˜ë©´ í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ëŒ€ì‘ì´ ê°€ëŠ¥í• ê¹Œ?<br>\nDB ì„œë²„ ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë” ì˜ í™œìš©í•˜ê³  ì‹¶ì€ë° ì ì ˆí•œ ì„¤ì •ì¼ê¹Œ?</p>\n<ol>\n<li>ëª¨ë‹ˆí„°ë§ í™˜ê²½ êµ¬ì¶• (ì„œë²„ ë¦¬ì†ŒìŠ¤, ì„œë²„ ìŠ¤ë ˆë“œ ìˆ˜, DBCP ë“±ë“±)</li>\n<li>ë°±ì—”ë“œ ì‹œìŠ¤í…œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ (nGrinder, K6 ë“±)</li>\n<li>request per secondì™€ avg response time í™•ì¸</li>\n<li>ë°±ì—”ë“œ ì„œë²„, DB ì„œë²„ì˜ CPU, Memory ë“± ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥ ì„ í™•ì¸í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ ìŠ¤ì¼€ì¼ ì•„ì›ƒìœ¼ë¡œ ëŒ€ì‘ ê°€ëŠ¥í•œì§€ í™•ì¸\n<ul>\n<li>ë°±ì—”ë“œì˜ ìŠ¤ë ˆë“œ í’€ì˜ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ëª¨ë“  ìŠ¤ë ˆë“œë¥¼ í™œìš©í•˜ëŠ”ì§€, ì•„ë‹ˆë©´ idleì´ ìˆëŠ”ì§€ë¡œ ì–´ë”” ë¶€ë¶„ì´ ë³‘ëª©ì¸ì§€ ìœ ì¶”í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</li>\n</ul>\n</li>\n<li>ìŠ¤ì¼€ì¼ ì•„ì›ƒìœ¼ë¡œ ëŒ€ì‘ ê°€ëŠ¥í•˜ì§€ë§Œ DBì—ì„œ ë³‘ëª©ì´ ìƒê¸°ëŠ” ê²½ìš° secondary ì¶”ê°€, cache ë ˆì´ì–´ ì¶”ê°€, ìƒ¤ë”©, íŒŒí‹°ì…”ë‹, ì¿¼ë¦¬ íŠœë‹ ë“±ë“±ìœ¼ë¡œ ê°œì„ ì  í™•ì¸</li>\n</ol>\n<p>í”„ë¡œë©”í…Œìš°ìŠ¤ì™€ ê·¸ë¼íŒŒë‚˜ë¥¼ ì´ìš©í•˜ì—¬ ìì„¸í•œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì´ ê°€ëŠ¥í•˜ê¸°ì— ì„¸íŒ…í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤ì œë¡œ í•´ë´ì•¼ê² ë‹¤.</p>\n<h1 id=\"ëŠë‚€ì \" style=\"position:relative;\">ëŠë‚€ì <a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"ëŠë‚€ì  permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>ì´ë²ˆ PrematureCloseException ì›ì¸ ë¶„ì„ì„ í†µí•´ ë§ì€ ê²ƒì„ ë°°ìš¸ ìˆ˜ ìˆì—ˆë‹¤.<br>\nê¸°ì¡´ì—ëŠ” WebClientì˜ ê¸°ë³¸ ì„¤ì •ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í–ˆì—ˆëŠ”ë°, ì´ë²ˆ ê²½í—˜ì„ í†µí•´ ìš´ì˜ í™˜ê²½ì˜ íŠ¹ì„±ì„ íŒŒì•…í•˜ê³  ì ì ˆí•œ ì„¤ì •ì„ ì ìš©í•´ì•¼í•¨ì„ ê¹¨ë‹¬ì•˜ë‹¤.</p>\n<ul>\n<li><strong>ê¸°ë³¸ê°’ â‰  ìµœì ê°’</strong>: ê¸°ë³¸ ì„¤ì •ì€ ì¼ë°˜ì ì¸ ìƒí™©ì„ ê°€ì •í•˜ë¯€ë¡œ, íŠ¹ì • í™˜ê²½ì—ì„œëŠ” ì ì ˆí•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤</li>\n<li><strong>ìƒí™©ë³„ íŠœë‹ í•„ìš”</strong>: íŠ¸ë˜í”½ íŒ¨í„´, ì„œë²„ í™˜ê²½, ë¹„ì¦ˆë‹ˆìŠ¤ í™˜ê²½, ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì„ ê³ ë ¤í•œ ì„¸ë°€í•œ ì¡°ì •ì´ í•„ìš”í•˜ë‹¤</li>\n</ul>\n<p>ì´ë²ˆì— ì ìš©í•œ ì„¤ì •ìœ¼ë¡œ ë¬¸ì œê°€ ìƒë‹¹íˆ ê°œì„ ë˜ì—ˆì§€ë§Œ, <strong>ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì˜ˆì™¸ë¥¼ ì™„ì „íˆ ë°©ì§€í•  ìˆ˜ëŠ” ì—†ë‹¤</strong>.<br>\nìš°ë¦¬ê°€ ì œì–´í•  ìˆ˜ ì—†ëŠ” ì˜ì—­ì¸ ì™¸ë¶€ íšŒì‚¬ì˜ ì„œë¹„ìŠ¤ APIëŠ” ë¶ˆê°€í”¼í•œ ë„¤íŠ¸ì›Œí¬ ì˜ˆì™¸ì— ëŒ€ë¹„í•œ ì ì ˆí•œ ì¬ì‹œë„ ì „ëµê³¼ ì•Œë¦¼ ì „ëµì´ í•„ìš”í•˜ë‹¤.</p>\n<p>ì‹¤ë¬´ì—ì„œëŠ” ì‹œê°„ ì••ë°•ìœ¼ë¡œ ì¸í•´ ê¸‰í•˜ê²Œ ì²˜ë¦¬í–ˆì§€ë§Œ, FIN/RST íŒ¨í‚·ì˜ ì†¡ì‹ ìë¥¼ ì •í™•íˆ íŒŒì•…í•˜ê¸° ìœ„í•´ TCP dumpë¥¼ ëœ¨ëŠ” ê²ƒì´ ë” ì •í™•í•  ê²ƒì´ë‹¤.<br>\n(ECS í™˜ê²½ì—ì„œì˜ TCP dumpë¥¼ ëœ¨ê¸° ìœ„í•œ ë°©ë²•ì„ ì •ë¦¬í•´ì•¼ê² ë‹¤.)</p>\n<blockquote>\n<p>ì°¸ê³ </p>\n<ol>\n<li><a href=\"https://brewagebear.github.io/linux-kernel-internal-3/\">[Kernel] ì»¤ë„ê³¼ í•¨ê»˜ ì•Œì•„ë³´ëŠ” ì†Œì¼“ê³¼ TCP Deep Dive</a></li>\n<li><a href=\"https://blog.cjlee.io/post/webclient-timeout/\">í—·ê°ˆë¦¬ëŠ” WebClient Timeout</a></li>\n<li><a href=\"https://datatracker.ietf.org/doc/html/rfc9293#name-state-machine-overview\">RFC9293: Transmission Control Protocol (TCP) State Matchine Overview</a></li>\n<li><a href=\"https://projectreactor.io/docs/netty/release/reference/faq.html#faq.connection-closed\">How can I debug \"Connection prematurely closed BEFORE response\"?</a></li>\n<li><a href=\"https://www.baeldung.com/spring-webflux-concurrency\">Concurrency in Spring WebFlux</a></li>\n<li><a href=\"https://www.cs.unh.edu/cnrg/people/gherrin/linux-net.html\">Linux IP Networking: A Guide to the Implementation and Modification of the Linux Protocol Stack</a></li>\n</ol>\n</blockquote>","frontmatter":{"title":"WebClient PrematureCloseException ì›ì¸ ë¶„ì„í•˜ê¸°","date":"2025-09-22","update":"2025-11-05","description":null,"tags":["deep-dive","network","nio","postmortem"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%9C%EA%B2%AC\">ë¬¸ì œ ë°œê²¬</a></p>\n</li>\n<li>\n<p><a href=\"#webclient-connection-%EC%83%81%ED%83%9C-%EB%B3%80%ED%99%94\">WebClient Connection ìƒíƒœ ë³€í™”</a></p>\n</li>\n<li>\n<p><a href=\"#prematurecloseexception%EC%9D%B4-%EB%B0%9C%EC%83%9D%ED%95%98%EB%8A%94-%EC%BC%80%EC%9D%B4%EC%8A%A4\">PrematureCloseExceptionì´ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤</a></p>\n<ul>\n<li><a href=\"#1-before-response-while-sending-request-body\">1. BEFORE response while sending request body</a></li>\n<li><a href=\"#2-before-response\">2. BEFORE response</a></li>\n<li><a href=\"#3-during-response\">3. DURING response</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%BB%A4%EB%84%90-tcp-%EC%86%8C%EC%BC%93-%EC%83%81%ED%83%9C%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%B2%98%EB%A6%AC\">ì»¤ë„ TCP ì†Œì¼“ ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬</a></p>\n<ul>\n<li><a href=\"#%EC%BB%A4%EB%84%90-%EB%A0%88%EB%B2%A8-%EC%B2%98%EB%A6%AC-%EB%A1%9C%EC%A7%81\">ì»¤ë„ ë ˆë²¨ ì²˜ë¦¬ ë¡œì§</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%9B%90%EC%9D%B8%EA%B3%BC-%EC%98%88%EB%B0%A9-%EB%B0%A9%EB%B2%95\">ì›ì¸ê³¼ ì˜ˆë°© ë°©ë²•</a></p>\n<ul>\n<li><a href=\"#%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%84%9C%EC%99%80-%EC%84%9C%EB%B2%84%EA%B0%84-timeout%EC%9D%B4-%EB%8B%A4%EB%A5%B8-%EA%B2%BD%EC%9A%B0\">ë¡œë“œë°¸ëŸ°ì„œì™€ ì„œë²„ê°„ timeoutì´ ë‹¤ë¥¸ ê²½ìš°</a></li>\n<li><a href=\"#webclient-maxidletime-%EC%84%A4%EC%A0%95-%EB%B6%80%EC%9E%AC\">WebClient maxIdleTime ì„¤ì • ë¶€ì¬</a></li>\n<li><a href=\"#maxidletime-%EC%84%A4%EC%A0%95-%EC%9D%B4%ED%9B%84-%EC%BB%A4%EB%84%A5%EC%85%98-%ED%92%80-%EC%98%88%EC%99%B8-%EB%B0%9C%EC%83%9D\">maxIdleTime ì„¤ì • ì´í›„ ì»¤ë„¥ì…˜ í’€ ì˜ˆì™¸ ë°œìƒ</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-db-connection-pool%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%84%A4%EC%A0%95%ED%95%98%EB%8A%94%EA%B2%8C-%EC%A2%8B%EC%9D%84%EA%B9%8C\">ğŸ’¡ DB Connection Poolì€ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ?</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\">ëŠë‚€ì </a></p>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/2025y/coroutinescope/"},"frontmatter":{"title":"APIê°€ ì™œ ë©ˆì·„ì„ê¹Œ? ì½”ë£¨í‹´ ì´í•´í•˜ê¸°"}},"next":{"fields":{"slug":"/2025y/labs/"},"frontmatter":{"title":"MySQL Lock ì‹¤í—˜ì‹¤"}}},"pageContext":{"id":"e0b1b946-ea07-5d47-9d52-4627d912ebd9","previousPostId":"44185076-e856-5646-974d-b8c8a058bc63","nextPostId":"9adc1019-637b-546b-ba6a-a7b3328b7519"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}