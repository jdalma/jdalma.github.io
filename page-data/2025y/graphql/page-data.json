{"componentChunkName":"component---src-templates-blog-post-js","path":"/2025y/graphql/","result":{"data":{"site":{"siteMetadata":{"title":"코딩 주머니"}},"markdownRemark":{"id":"003a0373-05e2-5137-a60a-e2d20bc60346","excerpt":"GraphQL 기반 서비스를 처음으로 접하면서 다음과 같은 고민을 한적이 있다.      이 글에서는 Netflix DGS Framework를 기준으로 이러한 고민들을 해소해보고자 한다. 이 글을 통해 아래의 내용을 학습할 수 있다. GraphQL API의 호출 구조 이해 Query…","html":"<p>GraphQL 기반 서비스를 처음으로 접하면서 다음과 같은 고민을 한적이 있다.</p>\n<ul>\n<li><code class=\"language-text\">\"스키마를 어떤 기준으로 작성해야 할까?\"</code></li>\n<li><code class=\"language-text\">\"조회 쿼리가 너무 많이 발생하는데 어떻게 개선할 수 있을까?\"</code></li>\n<li><code class=\"language-text\">\"Selection Set의 필드는 어떤 원리로 채워지는 걸까?\"</code></li>\n<li><code class=\"language-text\">\"/graphql은 누가 라우팅할까?\"</code></li>\n<li><code class=\"language-text\">\"예외는 어떻게 처리할까?\"</code></li>\n</ul>\n<p>이 글에서는 Netflix DGS Framework를 기준으로 이러한 고민들을 해소해보고자 한다.</p>\n<blockquote>\n<p>이 글을 통해 아래의 내용을 학습할 수 있다.</p>\n<ol>\n<li>GraphQL API의 호출 구조 이해</li>\n<li>Query의 <code class=\"language-text\">Selection set</code> 동작 원리</li>\n<li><code class=\"language-text\">Data Loaders</code>를 통한 N+1 문제 해결 방법</li>\n<li>GraphQL의 예외 처리 방식</li>\n</ol>\n</blockquote>\n<h1 id=\"company-employee-예제로-보는-graphql\" style=\"position:relative;\">Company-Employee 예제로 보는 GraphQL<a href=\"#company-employee-%EC%98%88%EC%A0%9C%EB%A1%9C-%EB%B3%B4%EB%8A%94-graphql\" aria-label=\"company employee 예제로 보는 graphql permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>간단한 회사-직원 관계<code class=\"language-text\">(Company 1:N Employee)</code> 예제를 통해 GraphQL의 데이터 조회와 변경 작업을 살펴보자.</p>\n<blockquote>\n<p>GraphQL에서는 <code class=\"language-text\">schema</code>를 통해 클라이언트와 서버 간의 통신을 명시적으로 정의하여 안전한 타입 체킹, 자동 문서화, 코드 생성 등을 가능하게 한다.<br>\n아래의 코드 블록에서 <code class=\"language-text\"># schema</code>는 <code class=\"language-text\">*.graphql</code>에 작성된 schema 정보임을 뜻한다.</p>\n</blockquote>\n<h2 id=\"dgsquery와-dgsdata를-이용한-조회\" style=\"position:relative;\">@DgsQuery와 @DgsData를 이용한 조회<a href=\"#dgsquery%EC%99%80-dgsdata%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A1%B0%ED%9A%8C\" aria-label=\"dgsquery와 dgsdata를 이용한 조회 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6d805fe4e752719e6a93498fae60b617/c23ad/schema.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVR42mWS647aMBBG8/7P1H+V0BYWrQoESIhawobESQi5Oiabyyk2pRet5dFItr+ZMzO2pmni05r+MeMm+r6nbmqGYeCpGceRPM+ZzWYsl0uKosDSF1JK4jg2FkYh3Uf3CPRbKDOJ/dXm9csr3tyjqx735/MZx3HwfZ/b7Wb0ls7cdZ0h0CRDNzDKEe4a4++7/FnytnzDdVxkKUnchCAM2G63bDYb9vu9Ib1er1jz+ZzL5YJs7g8vCWInaOOWLMiQgUTFCuEIXNfF3tokIiH1UpNctcpQ6VKzLCOKIqzD4UDTNKRpSiQiUjc1Jb4f32nihiqoCDYBnucRhiFt09In/aMl42T6eDweEUKYM6uuaxOwqiqKskCVijEfmep7+dkAH1D8KHj59sLO2VHmJf53nyiOjE73cbVaocEM4XMomlBjK6X+TPa5+qJHhYo2bFFnhcqVSa4DLRYLTqeT6Z8mtfQk//s60+dvY/z4157vde9t22a9XhtCHfAXU2dfVS2uoPYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"schema\"\n        title=\"\"\n        src=\"/static/6d805fe4e752719e6a93498fae60b617/1cfc2/schema.png\"\n        srcset=\"/static/6d805fe4e752719e6a93498fae60b617/3684f/schema.png 225w,\n/static/6d805fe4e752719e6a93498fae60b617/fc2a6/schema.png 450w,\n/static/6d805fe4e752719e6a93498fae60b617/1cfc2/schema.png 900w,\n/static/6d805fe4e752719e6a93498fae60b617/c23ad/schema.png 1193w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 이미지의 의미는 아래와 같다.</p>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">@DgsComponent\nclass CompanyFetcher {\n\n    @DgsQuery\n    fun findAllCompanies(@InputArgument filter: CompanyFilter): Connection&lt;Company&gt; {\n        ...\n    }\n\n    @DgsData(parentType = &quot;CompanyResponse&quot;, field = &quot;staffs&quot;)\n    fun staff(environment: DgsDataFetchingEnvironment): CompletableFuture&lt;List&lt;Staff&gt;&gt; {\n        val dataLoader = environment.getDataLoader&lt;String, List&lt;Employee&gt;&gt;(EmployeeDataLoader.EMPLOYEE_LOADER_NAME)\n        return dataLoader.load(..)\n    }\n}</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"graphql\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\"># schema\ntype Query {\n    findAllCompanies(filter: CompanyFilter): CompanyConnection!\n}\n\ntype CompanyConnection {\n    totalCount: Int!\n    responses: [CompanyResponse!]!\n}\n\ntype CompanyResponse {\n    id: ID!\n    alias: String!\n    state: CompanyState!,\n    employees: [Employee]\n}\n\ntype Employee {\n    id: Int,\n    companyId: String\n    name: String\n}\n\n# request\nquery {\n    findAllCompanies(filter: {\n        statusIn: [NORMAL]\n    }) {\n        totalCount\n        responses {\n            id\n            alias\n            state\n            employees {\n                name\n            }\n        }\n    }\n}\n\n# response\n{\n  &quot;data&quot;: {\n    &quot;findAllCompanies&quot;: {\n      &quot;totalCount&quot;: 3,\n      &quot;responses&quot;: [\n        {\n          &quot;id&quot;: &quot;별빛기술&quot;,\n          &quot;alias&quot;: &quot;STAR&quot;,\n          &quot;state&quot;: &quot;NORMAL&quot;,\n          &quot;employees&quot;: [\n            {\n              &quot;name&quot;: &quot;하늘솔&quot;\n            },\n            {\n              &quot;name&quot;: &quot;달빛솔&quot;\n            }\n          ]\n        },\n        { ... }\n      ]\n    }\n  }\n}</code>\n        </deckgo-highlight-code>\n<p>주요 특징은 <code class=\"language-text\">CompanyResponse</code>를 <code class=\"language-text\">@DgsQuery</code>와 <code class=\"language-text\">@DgsData</code>의 응답을 합쳐서 만든다는 것이다.<br>\n(이 기능을 지원하는 BatchLoader에 대해서는 뒤에서 자세히 다룬다.)<br>\nGraphQL의 가장 큰 특징인 <code class=\"language-text\">selection set</code>을 필요한 것만 선택하여 지정할 수 있다.</p>\n<p><code class=\"language-text\">selection set</code>이란, <strong>GraphQL 쿼리에서 어떤 필드를 선택할지 지정하는 중괄호(<code class=\"language-text\">{}</code>) 내부의 집합이다.</strong></p>\n<deckgo-highlight-code language=\"graphql\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">query {\n    findAllCompanies(filter: {\n        ...\n    }) {\n        # &lt;selections set&gt;\n        totalCount\n        responses {\n            id\n            alias\n            state\n            employees {\n                name\n            }\n        }\n        # &lt;/selection set&gt;\n    }\n}</code>\n        </deckgo-highlight-code>\n<p><code class=\"language-text\">&lt;selection set></code> 영역에 있는 최상위 필드 또는 중첩된 필드를 필요한 것만 선택하여 응답을 받을 수 있기에 오버페칭과 언더페칭을 해결할 수 있다.<br>\n당연히 schema에 type으로 응답 타입의 필드에 작성된 필드를 기준으로 선택해야 한다.</p>\n<h2 id=\"dgsmutation을-이용한-조작\" style=\"position:relative;\">@DgsMutation을 이용한 조작<a href=\"#dgsmutation%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A1%B0%EC%9E%91\" aria-label=\"dgsmutation을 이용한 조작 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<deckgo-highlight-code language=\"kotlin\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">@DgsComponent\nclass CompanyMutation {\n    @DgsMutation\n    fun createCompany(createRequest: CreateCompanyRequest): Company {\n        val company = ...\n        return company\n    }\n}</code>\n        </deckgo-highlight-code>\n<deckgo-highlight-code language=\"graphql\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\"># schema\ntype Mutation {\n    createCompany(createCompanyRequest: CreateCompanyRequest!): CompanyResponse!\n}\ninput CreateCompanyRequest {\n    id: String!\n    alias: String!\n    employees: [EmployeeInput!]!\n}\ninput EmployeeInput {\n    name: String\n}</code>\n        </deckgo-highlight-code>\n<p>위와 같이 schema를 정의하고 그에 맞게 Mutation을 등록한 후에, Spring Web API 작성하듯이 <code class=\"language-text\">@DgsComponent</code>와 <code class=\"language-text\">@DgsMutation</code>을 작성하면 호출할 수 있게 된다.</p>\n<deckgo-highlight-code language=\"graphql\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\"># request\nmutation {\n createCompany(createCompanyRequest: {\n   id: &quot;company-123&quot;\n   alias: &quot;신규회사&quot; \n   employees: [\n     {\n       name: &quot;김철수&quot;\n     },\n     {\n       name: &quot;이영희&quot;  \n     }\n   ]\n }) {\n   id\n   alias\n   state\n   employees {\n     id\n     name\n   }\n }\n}\n\n# response\n{\n  &quot;data&quot;: {\n    &quot;createCompany&quot;: {\n      &quot;id&quot;: &quot;company-123&quot;,\n      &quot;alias&quot;: &quot;신규회사&quot;,\n      &quot;state&quot;: &quot;NORMAL&quot;,\n      &quot;employees&quot;: [\n        {\n          &quot;id&quot;: 9,\n          &quot;name&quot;: &quot;김철수&quot;\n        },\n        {\n          &quot;id&quot;: 10,\n          &quot;name&quot;: &quot;이영희&quot;\n        }\n      ]\n    }\n  }\n}</code>\n        </deckgo-highlight-code>\n<h2 id=\"정리\" style=\"position:relative;\">정리<a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>각 어노테이션의 주요 특징과 사용 목적을 정리하면 다음과 같다.</p>\n<table>\n<thead>\n<tr>\n<th>어노테이션</th>\n<th>용도</th>\n<th>사용 위치</th>\n<th>특징</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">@DgsQuery</code></td>\n<td>데이터 조회 작업</td>\n<td>최상위 레벨</td>\n<td>1. Query 타입 구현 (1:1 관계)<br>2. 읽기 전용 작업</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">@DgsData</code></td>\n<td>타입의 필드 구현</td>\n<td>중첩 필드</td>\n<td>1. 특정 Query 타입 내부의 필드를 구현 (1:1 또는 1:N 관계)<br>2. <code class=\"language-text\">parentType</code> 지정 필요<br>3. DataLoader와 함께 사용하여 N+1 문제 해결<br>4. DgsDataFetchingEnvironment로 부모 컨텍스트 접근 가능</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">@DgsMutation</code></td>\n<td>데이터 변경 작업</td>\n<td>최상위 레벨</td>\n<td>1. Mutation 타입 구현 및 (1:1 관계)<br>2. 생성/수정/삭제 작업</td>\n</tr>\n</tbody>\n</table>\n<p>GraphQL의 내부 동작 원리와 최적화 방법에 대해 더 자세히 알아보자.</p>\n<hr>\n<h1 id=\"graphql-분석하기\" style=\"position:relative;\">GraphQL 분석하기<a href=\"#graphql-%EB%B6%84%EC%84%9D%ED%95%98%EA%B8%B0\" aria-label=\"graphql 분석하기 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/6c960/overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtElEQVR42m2Sb5OiMAzG/f7fa1/sK29uOM9zFQRUEAvInxYKlN+VOrpzu5dMppk0efqkyYovoo2m7EvyPn+Z6AT+1ef91ztvP97wfI+0Sf/JWawZGlZPoNnqIkVfoEa1BJjn+RVvu5Z7c2c0I2YyzlzdPL/IpCr9BHxKoQvKqsT3fYqicICT1aRKCM4BvelfBJ4PmvkB7lc+q7ZtkVKitXasFkCpJFmaUcua6/3KqToRNzHJPSFX+VcOL8CgDlhtt1vW6zWe53HLbu5vojgiyzIaq/vLnkAExPeY7X7LSZwwg2HUI7rT7ny279eWoRCCw+HAZrMhPIZEIsLbeAQfASITiFIwTROztvRt3aAHknPC5XThml7p2555etz5uQVsmgallGtzSV6mNZnJ/U0RFlz+XFCpYsxH+rJnyAciLyL4GVAeS0xrqLKKqZz4CD++T3lZkQXQiR32+fcZsRPIoyTaRehQU4c1aZCij5ohtQ/4Ebfwxm6/+z/gYIZnENPZFZGGWc2OzdK6aWystn5nE0ZcnA7iW/x9bdqhdbvYTZ3bRzU9THYS2cvP8+mrh990DUIJ/gKoJACBQRT3iQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"overview\"\n        title=\"\"\n        src=\"/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/1cfc2/overview.png\"\n        srcset=\"/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/3684f/overview.png 225w,\n/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/fc2a6/overview.png 450w,\n/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/1cfc2/overview.png 900w,\n/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/21482/overview.png 1350w,\n/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/d61c2/overview.png 1800w,\n/static/d4ed9a3f45a5f88a7cd5427f1d1a654c/6c960/overview.png 2135w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"graphql-request는-다른-spring-request와-어떻게-구분될까\" style=\"position:relative;\">GraphQL Request는 다른 Spring Request와 어떻게 구분될까?<a href=\"#graphql-request%EB%8A%94-%EB%8B%A4%EB%A5%B8-spring-request%EC%99%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B5%AC%EB%B6%84%EB%90%A0%EA%B9%8C\" aria-label=\"graphql request는 다른 spring request와 어떻게 구분될까 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>DispatcherServlet은 요청이 들어오면 아래의 과정을 거친다.</p>\n<ol>\n<li>API 요청을 처리할 수 있는 <code class=\"language-text\">핸들러</code>를 조회한다.</li>\n<li>핸들러를 실행시킬 수 있는 <code class=\"language-text\">핸들러 어댑터</code>를 조회한다.</li>\n<li>핸들러 어댑터를 이용하여 <code class=\"language-text\">핸들러를 실행</code>한다.</li>\n</ol>\n<p>GraphQL도 DispatcherServlet을 통해 실행되기에 Spring Boot의 Auto Configuration을 통해 GraphQL의 요청을 처리하기 위해 필요한 구성들을 자동으로 등록한다.</p>\n<h3>1. GraphQL 요청을 처리하는 핸들러 찾기</h3>\n<p>아래는 GraphQL 요청을 처리할 수 있는 <code class=\"language-text\">핸들러</code>를 조회할 때 사용되는 조건이다.<br>\n<code class=\"language-text\">GraphQlHttpRequestPredicate</code> 구현체는 DispatcherServlet에서 Handler를 조회할 때 사용된다.</p>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">public final class GraphQlRequestPredicates {\n    ...\n    private static class GraphQlHttpRequestPredicate implements RequestPredicate {\n\n        @Override\n        public boolean test(ServerRequest request) {\n            return httpMethodMatch(request, HttpMethod.POST)\n                    &amp;&amp; contentTypeMatch(request, this.contentTypes)\n                    &amp;&amp; acceptMatch(request, this.acceptedMediaTypes)\n                    &amp;&amp; pathMatch(request, this.pattern);\n        }\n        ...\n    }\n}</code>\n        </deckgo-highlight-code>\n<ol>\n<li><code class=\"language-text\">POST</code> 요청</li>\n<li><code class=\"language-text\">content-type</code> : application/json || applciation/graphql</li>\n<li><code class=\"language-text\">media-type</code> : application/json || application/graphql-response+json</li>\n<li><code class=\"language-text\">/graphql</code> 경로</li>\n</ol>\n<p>위 4가지 조건에 모두 만족한다면 <code class=\"language-text\">GraphQlHttpHandler</code>를 반환한다.<br>\n(GraphQlHttpHandler는 <code class=\"language-text\">GraphQlWebMvcAutoConfiguration</code>에서 자동으로 등록된 빈이다.)</p>\n<h3>2. GraphQlHttpHandler를 이용해 핸들러 어댑터 찾기</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/992d95b0ba43a2df0fa44094f68c2863/f96db/handlerAdapter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVR42k3R2W7TQBQGYD9OVYkmXmPP6hlvMW6ICmHJoqRuQEBaoYIEEgLUCx7853jShYvPZ86M5veM7Ymyx+LiK968/YHF6+/YX92hv/yD7fY3+YX3+zscPv3FavUTtj6gqK//c3DK5gYVSaa38Po4wGcrcNsVOFQKW6Oxs+aJMdjkGislsZRH74SgfphTri6lwnqYC0N4m/EpZsOmVy+wLiUaxtEJiedCEYmWdLRhprWrZZLARhEMbR5YkpM68LGmLM+kDDse4Vsr8aUW2MiMMGfJJvRm5mwUv0cn4RleBiPnwj/DjHwcnyAJY3gRk4gahWldomkqdG2Dlur8fAppCkSyQKwKJLpyhp7V57DzBUJd4yQWUEEITZ6FKbwgnIBlEpa+R54X4NJCKAupC1JCUphwLLSpIGiu5QJzUkcxOn+Ehq47phyfeCNKzTOODyzAXkzQixRXdO0dS3DJqedDz2icurWe1q6DU1T+GJJONaFrnlGG/xDoRyk4U+joL06NpZMaVNqioGpVjnIYk8dK83leIsyUCxpRSHAfdgykR5IKChVgMseEHyVMO8M4FeaxOlyDUR9ETyd7CPwHCSJABvXPO0EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"handlerAdapter\"\n        title=\"\"\n        src=\"/static/992d95b0ba43a2df0fa44094f68c2863/f96db/handlerAdapter.png\"\n        srcset=\"/static/992d95b0ba43a2df0fa44094f68c2863/3684f/handlerAdapter.png 225w,\n/static/992d95b0ba43a2df0fa44094f68c2863/fc2a6/handlerAdapter.png 450w,\n/static/992d95b0ba43a2df0fa44094f68c2863/f96db/handlerAdapter.png 470w\"\n        sizes=\"(max-width: 470px) 100vw, 470px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>DispatcherServlet에서는 4개의 HandlerAdapter를 보유하고 있다.</p>\n<ul>\n<li>RequestMappingHandlerAdapter (일반적인 스프링 어노테이션 기반 Web API)</li>\n<li><strong>HandlerFunctionAdapter (함수형 스타일)</strong></li>\n<li>HttpRequestHandlerAdapter (HTTP 요청 직접 처리)</li>\n<li>SimpleControllerHandlerAdapter (레거시 Controller 인터페이스 구현체 지원)</li>\n</ul>\n<p>GraphQL은 Spring에서 지원하는 <code class=\"language-text\">RouterFunction</code>을 통해 함수형으로 라우팅 기능을 구현해놓았기에 <code class=\"language-text\">HandlerFunctionAdapter</code>를 사용한다.<br>\nGraphQL은 4개의 RouterFunction이 존재하며, 일반적인 요청은 <code class=\"language-text\">GraphQlHttpHandler</code>가 처리한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07efeffeef66478b1559af1e0670f32c/2e92a/routerFunction.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpElEQVR42o2SW2/aQBCF/fP7kD+Q9zYXQSCplJaU5gYKMdBQaCSwIWZt1tddYwOqEtJInM4uIOUhqTrSkXa+PbPSrI6xWgFvSdVy+YxYpAgTAZlmeM/7Wgb+UY9PT3AYgzUcYcJ9/E8Z+WyObCN1zueLtTYsSnO4fgyZv+/ZajafwwhFhq38JIUfS0wiqVdt2QF2qh4+fHWwW/fh8ghBMgWne04+5d/OKh4kEkYkErgTj1aaIJL0EP1VnEowzwXjHE4g4IQS4yAmnwuPfCKbIpYkIXWvvGFCW2Q5jINyB3sFEx8PTZxd9DF4iFA46eITsb1iC7XGCINRgOLnHvaPWpqXT+/JF+LL9z71Tc32j+7wa8Bh1EwXNZPh+pah2XFhO4Hula6Itbse+jbH5Y2DepN85hi1WwfWA0fjh+qZ5lcNhsGQHkz4GNyxELojzKYCLy9/oNnY1myRS6gU5TKCz4bELWLpOgW/FwgUo/lMhOvYnJ+UUC0XUSkcoP/zDkuKyvlxCd9KBc3s+54e7tzUUSke4oxk9bqa+RSpKvkUa19f6tj8BbF+j0vvI9eFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"routerFunction\"\n        title=\"\"\n        src=\"/static/07efeffeef66478b1559af1e0670f32c/1cfc2/routerFunction.png\"\n        srcset=\"/static/07efeffeef66478b1559af1e0670f32c/3684f/routerFunction.png 225w,\n/static/07efeffeef66478b1559af1e0670f32c/fc2a6/routerFunction.png 450w,\n/static/07efeffeef66478b1559af1e0670f32c/1cfc2/routerFunction.png 900w,\n/static/07efeffeef66478b1559af1e0670f32c/21482/routerFunction.png 1350w,\n/static/07efeffeef66478b1559af1e0670f32c/d61c2/routerFunction.png 1800w,\n/static/07efeffeef66478b1559af1e0670f32c/2e92a/routerFunction.png 2508w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"executionstrategy\" style=\"position:relative;\">ExecutionStrategy<a href=\"#executionstrategy\" aria-label=\"executionstrategy permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>HandlerFunctionAdapter가 GraphQlHttpHandler를 통하여 GraphQl의 요청을 처리하게 된다.</p>\n<ul>\n<li>중첩 필드가 실행될 때 재귀적으로 실행하는 것을 확인했음. 더 분석 필요</li>\n</ul>\n<h2 id=\"batchloader-규칙\" style=\"position:relative;\">BatchLoader 규칙<a href=\"#batchloader-%EA%B7%9C%EC%B9%99\" aria-label=\"batchloader 규칙 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<deckgo-highlight-code language=\"java\" terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">// DataLoaderHelper\n\nprivate void assertResultSize(List&lt;K&gt; keys, List&lt;V&gt; values) {\n    assertState(keys.size() == values.size(), () -&gt; &quot;The size of the promised values MUST be the same size as the key list&quot;);\n}</code>\n        </deckgo-highlight-code>\n<ul>\n<li>각 companyId에 대해 빈 리스트라도 반환해야 함</li>\n<li>결과는 반드시 입력 keys와 같은 순서를 유지해야 함</li>\n<li>반환 타입이 List&#x3C;List<Staff>>이어야 함 (각 companyId당 하나의 List)</li>\n</ul>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-light\" line-numbers=\"true\"  >\n          <code slot=\"code\">// 입력 keys\ncompanyIds = [1, 2, 3]\n\n// 올바른 결과 (size = 3)\n[\n    [staff1, staff2],  // company1의 직원들\n    [],                // company2의 직원 (없음)\n    [staff3]           // company3의 직원\n]\n\n// 잘못된 결과 (size = 4 != keys.size)\n[staff1, staff2, staff3, staff4]</code>\n        </deckgo-highlight-code>\n<h2 id=\"todo\" style=\"position:relative;\">TODO<a href=\"#todo\" aria-label=\"todo permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li>DgsContext</li>\n<li>DataLoaderRegistry</li>\n<li>dgsSpringConfigurationProperties.webmvc.asyncdispatch.enabled</li>\n</ul>","frontmatter":{"title":"GraphQL 이해하고 사용하기 (작성 중)","date":"2025-01-24","update":"2025-04-05","description":null,"tags":["graphql","deep-dive"]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#company-employee-%EC%98%88%EC%A0%9C%EB%A1%9C-%EB%B3%B4%EB%8A%94-graphql\">Company-Employee 예제로 보는 GraphQL</a></p>\n<ul>\n<li><a href=\"#dgsquery%EC%99%80-dgsdata%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A1%B0%ED%9A%8C\">@DgsQuery와 @DgsData를 이용한 조회</a></li>\n<li><a href=\"#dgsmutation%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A1%B0%EC%9E%91\">@DgsMutation을 이용한 조작</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#graphql-%EB%B6%84%EC%84%9D%ED%95%98%EA%B8%B0\">GraphQL 분석하기</a></p>\n<ul>\n<li><a href=\"#graphql-request%EB%8A%94-%EB%8B%A4%EB%A5%B8-spring-request%EC%99%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B5%AC%EB%B6%84%EB%90%A0%EA%B9%8C\">GraphQL Request는 다른 Spring Request와 어떻게 구분될까?</a></li>\n<li><a href=\"#executionstrategy\">ExecutionStrategy</a></li>\n<li><a href=\"#batchloader-%EA%B7%9C%EC%B9%99\">BatchLoader 규칙</a></li>\n<li><a href=\"#todo\">TODO</a></li>\n</ul>\n</li>\n</ul>"},"previous":{"fields":{"slug":"/2025y/review/"},"frontmatter":{"title":"2025년 기록"}},"next":{"fields":{"slug":"/2025y/multiplexing/"},"frontmatter":{"title":"I/O 멀티플렉싱에 대해"}}},"pageContext":{"id":"003a0373-05e2-5137-a60a-e2d20bc60346","previousPostId":"07da9609-30a9-5e7d-b3bc-1b778a140552","nextPostId":"e3d18442-a047-5f12-84d4-4bab1d333bc7"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}