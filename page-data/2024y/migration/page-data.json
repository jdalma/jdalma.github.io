{"componentChunkName":"component---src-templates-blog-post-js","path":"/2024y/migration/","result":{"data":{"site":{"siteMetadata":{"title":"코딩 주머니"}},"markdownRemark":{"id":"1bc66bf5-0d43-5f57-bea4-42dc03cb37e1","excerpt":"단일 데이터베이스를 ProxySQL을 사용하여 RW를 분리하고 Orchestrator를 통하여 페일백/페일오버를 직접 구성 스프링에서 RW 커넥션을 분리 Aurora 클러스터 페일오버, 페일백 AWS 인스턴스 장애 발생 시 진행되는 페일오버, 페일백이 진행되면 대략 30초 정도 read…","html":"<p>단일 데이터베이스를</p>\n<ol>\n<li><a href=\"https://proxysql.com/\">ProxySQL</a>을 사용하여 RW를 분리하고 <a href=\"https://github.com/openark/orchestrator\">Orchestrator</a>를 통하여 페일백/페일오버를 직접 구성</li>\n<li>스프링에서 RW 커넥션을 분리</li>\n<li>Aurora 클러스터 페일오버, 페일백\n<ol>\n<li>AWS 인스턴스 장애 발생 시 진행되는 페일오버, 페일백이 진행되면 대략 30초 정도 read only connection 예외가 발생, 30초 정도의 시간은 감내 가능하다고 판단 <a href=\"https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/AuroraUserGuide/Concepts.AuroraHighAvailability.html#Aurora.Managing.FaultTolerance\">참고</a></li>\n</ol>\n</li>\n<li>Aurora 클러스터 가용성 <a href=\"https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Replication.html\">참고</a>\n<ol>\n<li>Aurora 복제본은 클러스터 볼륨의 읽기 작업 전용이므로 읽기 확장에 적합합니다. 쓰기 작업은 기본 인스턴스에서 관리합니다.</li>\n<li>클러스터 볼륨은 Aurora MySQL DB 클러스터의 모든 인스턴스 간에 공유되므로 각 Aurora 복제본에 대한 데이터 사본을 복제하는 데 추가 작업이 필요하지 않습니다.</li>\n<li>반면, MySQL 읽기 복제본은 소스 DB 인스턴스에서 로컬 데이터 저장소에 대한 모든 쓰기 작업을 단일 스레드에서 재생해야 합니다. 이러한 제한은 MySQL 읽기 복제본이 대량의 읽기 트래픽을 지원하는 기능에 영향을 미칠 수 있습니다.</li>\n<li>MySQL read replicas must replay, on a single thread, all write operations from the source DB instance to their local data store.</li>\n</ol>\n</li>\n<li>Aurora 클러스터 스토리지 조사\n<ol>\n<li><a href=\"https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/AuroraUserGuide/Aurora.Overview.StorageReliability.html\">Aurora 클러스터 스토리지 구성</a></li>\n<li><a href=\"https://aws.amazon.com/ko/rds/aurora/pricing/\">Aurora 클러스터 스토리지 요금</a></li>\n</ol>\n</li>\n<li>Aurora 인스턴스 스펙 선정을 위한 부하 테스트\n<ol>\n<li>mysqlslap</li>\n<li>sysbench</li>\n</ol>\n</li>\n<li>MySQL 8 버전으로 업그레이드하면서 확인한 것들\n<ol>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/keywords.html#keywords-8-0-detailed-C\">예약어</a></li>\n<li>기존에 사용중이던 DB의 환경변수 (max-allow-packet, max-connections)</li>\n<li>utf8mb3을 utf8mb4로 변경하면서 컬럼 사이즈(VARCHAR는 최대 65535자를 저장)와 인덱스 사이즈(The DYNAMIC row format supports index key prefixes up to 3072 bytes.) 확인\n<ol>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-row-format-dynamic\">DYNAMIC Row Format</a></li>\n</ol>\n</li>\n<li>MySQL 8.0.17부터 숫자 데이터 유형에 대한 ZEROFILL 속성과 정수 데이터 유형에 대한 표시 너비 속성은 더 이상 사용되지 않습니다. 향후 MySQL 버전에서는 정수 데이터 유형에 대한 ZEROFILL 및 표시 너비 지원이 제거될 것으로 예상해야 합니다. <a href=\"https://dev.mysql.com/doc/refman/8.0/en/numeric-type-attributes.html\">참고</a></li>\n</ol>\n</li>\n<li>AWS DMS를 사용하면서 주의해야 할점\n<ol>\n<li>엔드포인트, 복제 인스턴스, 마이그레이션 태스크</li>\n<li>적재 모드 선택</li>\n<li>지속적인 복제를 사용하려면 binary logging이 활성화되어 있어야함</li>\n<li>마이그레이션 대상 DB에 파티션된 테이블이 있다면 해당 테이블은 대상 DB에 미리 생성 해놓아야하며, 대상 테이블 준비 모드는 \"아무 작업 안함\" 또는 \"자르기\"를 선택해야 한다.</li>\n<li>동기화가 끝나면 대상 테이블의 AUTO_INCREMENT 값을 수동으로 동기화 시켜줘야 한다.</li>\n<li>테이블에 LOB 형식의 컬럼이 Not null 제약 조건이 있다면 해당 제약 조건을 제거하고 마이그레이션이 끝난 후 제약 조건을 추가해야 한다.</li>\n</ol>\n</li>\n<li>AWS DMS\n<ol>\n<li>동시에 8개의 테이블을 10000 레코드를 복제함. 변경 감지 트랜잭션 활성화 시간은 기본값인 10분이지만 변경도 가능하긴 함</li>\n</ol>\n</li>\n</ol>","frontmatter":{"title":"AWS DMS를 이용한 MySQL 마이그레이션 (작성중)","date":"March 28, 2024","description":null,"tags":["mysql","aws dms","migration"]},"tableOfContents":""},"previous":{"fields":{"slug":"/2024y/postprocessor/"},"frontmatter":{"title":"빈 후처리기를 이용한 프록시 생성에 대해"}},"next":{"fields":{"slug":"/2024y/bookReview/bookReview/"},"frontmatter":{"title":"2024년 책,강의 서평"}}},"pageContext":{"id":"1bc66bf5-0d43-5f57-bea4-42dc03cb37e1","previousPostId":"83e68652-9a78-5344-a893-30311c9782dd","nextPostId":"459e967c-8067-5121-a9e4-07e0de4508d6"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}