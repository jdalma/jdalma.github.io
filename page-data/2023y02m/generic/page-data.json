{"componentChunkName":"component---src-templates-blog-post-js","path":"/2023y02m/generic/","result":{"data":{"site":{"siteMetadata":{"title":"코딩 주머니"}},"markdownRemark":{"id":"cb7d1452-1c84-5741-a959-b23fb4be26a3","excerpt":"…","html":"<p>스프링과 코틀린을 사용하면서 만난 문제를 정리하려고 한다. 실제 업무와 비슷하게 다이어그램을 작성해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/45d4ac8c261809320b6ce1471e641930/b5a09/classDiagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.81012658227847%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABxElEQVR42pWUB47CQAxF5/4HA6Egeu8dQm+CUL161hqFtrCWrEnsnz+ucev1WubzuSyXS2k0GlIoFKRUKkm73VYbPjDX61VWq5XaRqOR4srlsup4PJbFYqE4N5vNxPd9NTabTalUKlKtVqXVaslkMlEfmMvlItPpVHGDwUCJwKHD4VDt4Fy/35d0Oi35fF4ymYwCIU6lUlKr1W6ESLfbVTtYlMuLxaJmZDjHbTgxckICIeS5XE6VS5Fer6fv4CCiRNls9maDy5EKej6f9aPNZqO1QMzOSQ0NyzN2IjK/nU5+BRBC4WmEAdAwxsiCINA0w37EGcjUhNvpHF3tdDpSr9e1SURPc3a73d0lpk8RWmqQQUqNIpGIRKNRicVi2hgI9/v903caYTjcsJNoaAYEzCQF55k0HwnDmT0RmhMSz/MkmUzqWHHSWVLHF075robvCImQsaB+NImTYWeQsdOUj4SPqZuwCail+Q73Zw2Px6Pq4XDQ+hEdHT6dTmqzuf2YMgKYwtvYsDn8DHi27m+32+8JGRs6an8dCHlGaQr7zgL8i5DFj8fjuqO2q3Q7kUioksHXhJz8joiSWUR5Zwaxoez8K8IfhCEQdumKNEAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"classDiagram\"\n        title=\"\"\n        src=\"/static/45d4ac8c261809320b6ce1471e641930/f058b/classDiagram.png\"\n        srcset=\"/static/45d4ac8c261809320b6ce1471e641930/c26ae/classDiagram.png 158w,\n/static/45d4ac8c261809320b6ce1471e641930/6bdcf/classDiagram.png 315w,\n/static/45d4ac8c261809320b6ce1471e641930/f058b/classDiagram.png 630w,\n/static/45d4ac8c261809320b6ce1471e641930/40601/classDiagram.png 945w,\n/static/45d4ac8c261809320b6ce1471e641930/78612/classDiagram.png 1260w,\n/static/45d4ac8c261809320b6ce1471e641930/b5a09/classDiagram.png 1360w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">convert(List&lt;Data>)</code>는 고정된 타입을 받아 <code class=\"language-text\">T</code>를 반환하고, <code class=\"language-text\">execute(T)</code>는 <code class=\"language-text\">T</code>타입을 받아 응답으로 반환하는 것을 알 수 있다.<br>\n이 설계의 의도는 확장에 유연하도록 각 <code class=\"language-text\">ValidationImpl</code>은 <code class=\"language-text\">convert()</code>를 통해 <code class=\"language-text\">List&lt;Data></code>라는 타입을 받아 <strong>검증할 때 사용할 데이터 타입을 직접 정의할 수 있도록 했다.</strong></p>\n<ul>\n<li>\n<p><code class=\"language-text\">strategies</code>를 주입받을 떄 <strong><code class=\"language-text\">*</code> Star-projection</strong>을 사용하여 모든 구현체를 주입받아야 한다.</p>\n<ul>\n<li><code class=\"language-text\">*</code>로 하지 않고 <code class=\"language-text\">Any</code>로 주입받으면 빈을 찾지 못한다.</li>\n</ul>\n</li>\n<li>\n<p>제네릭을 <code class=\"language-text\">Any</code>로 작성하여 구현체마다 직접 다운 캐스팅을 하진 않을 것이다.</p>\n</li>\n</ul>\n<h1><strong>문제점</strong></h1>\n<p>위의 다이어그램과 같이 <code class=\"language-text\">Service</code>는 <code class=\"language-text\">ValidationStrategy</code> 인터페이스를 구현한 구현체를 <code class=\"language-text\">List&lt;ValidationStrategy></code>으로 주입받아 사용하려 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">Service</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> strategies<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>ValidationStrategy<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>values<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>ValidationResponse<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> strategies<span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> convertData <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span>\n            it<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>convertData<span class=\"token punctuation\">)</span> <span class=\"token comment\">// COMPILE ERROR!!!</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span>\n            it<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> ValidationStrategy<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>param<span class=\"token operator\">:</span> T<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> ValidationResponse\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>queries<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> T\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation builtin\">@Component</span>\n<span class=\"token keyword\">class</span> ValidationImpl1 <span class=\"token operator\">:</span> ValidationStrategy<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>param<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ValidationResponse <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">ValidationResponse</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>queries<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> String <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"가공 데이터\"</span></span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">ValidationResponse</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> message<span class=\"token operator\">:</span> String\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Data</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> <span class=\"token keyword\">data</span> <span class=\"token operator\">:</span> String\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>하지만 <code class=\"language-text\">it.execute(convertData)</code>를 호출할 때 파라미터를 넘겨보면 <strong>컴파일 에러</strong>가 발생한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 607px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e918075f454f827cc1745a42fb02da99/ef9e5/nothing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.44303797468354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVR42kXR6Y6iQBSGYe9mGpCliqWgaNxaRRZBZZR26Taduf9reCfgJPPjyVfnz3eSOhPpWoTCIZCSMPCxB0ISq4j3LEMnIUII4jhGpymJfkclmiTNUHGM41pY1n8TyzKRzpREWiS+YK4S5pFinfqEKiYMI5JYoXVKmmpE4OO4DrY9sDFNA8N4MQ2DifRcLMcj8j3WM021WdJWC7b5glX+wWyVkmqFTjN0qvETRaQVUko8IfD9gCCMxpS+z8S2p9iezyoLWWQJgZqxXM757M887lc+rz3d+UxRlay3OfmuYLsryIuCfLd7ZVGwK0vWmw8mpmViTl2E56CGbUKhwpDb/cbz54fz5cL385vj6URZV1T7+p/9S12P6rZls90ymdoWlu1gmNb4D29vv3Bcl/P1wf35h66/0vU3qkNH1Z5emgN1s6dqmnEumwP7tmU9FA6XMU2T4Tjj2zAQQlKerhTdF8Whp+weVIPfX688Xmjadiyuujvlsac5HMfCvzNS8j0K6+qJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nothing\"\n        title=\"\"\n        src=\"/static/e918075f454f827cc1745a42fb02da99/ef9e5/nothing.png\"\n        srcset=\"/static/e918075f454f827cc1745a42fb02da99/c26ae/nothing.png 158w,\n/static/e918075f454f827cc1745a42fb02da99/6bdcf/nothing.png 315w,\n/static/e918075f454f827cc1745a42fb02da99/ef9e5/nothing.png 607w\"\n        sizes=\"(max-width: 607px) 100vw, 607px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 에러를 보고 고민했을 때 아래와 같은 방법들이 떠올랐다.</p>\n<h2><strong>첫 번째 방법 : 리플렉션</strong></h2>\n<p>리플렉션을 사용하여 주입받은 <code class=\"language-text\">ValidationStrategy.execute()</code>의 타입 파라미터와 메소드를 조회화여, 찾은 타입 파라미터로 캐스팅하거나 찾은 메소드로 <code class=\"language-text\">invoke</code>하는 방법</p>\n<ul>\n<li>코드 복잡성이 높아진다.</li>\n<li>가독성이 급격히 떨어진다.</li>\n</ul>\n<h2><strong>두 번째 방법 : 파라미터 추상화</strong></h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2fcdac3d96b2ef72a3ab2399d37172be/27f8b/abstracParameter.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.51898734177216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABgklEQVR42o2T6Y7CMAyE8/7vhfiDAHHTcpT7LEe5Ki6vPktG3apdNpJVx5lMJuPUvd9veT6fGq/XS5hbjfnlcpHtdiubzUZzaqwlcRbM3fV61Q2Hw0Hm87nU63VptVqa7/d7Jbrf7xphGCpuMpkortlsymKxUNx6vZbb7SbudDpJu91WEoK8VqvpBt/3lRhlx+NRCbJw/X5flsulIM6dz2fxPE+63a5+e72eBEGgeafT0TqHEuTUsnAcDpczLwgGG1Fjw+rpHAxYBr6a/05SgwWkR1Gk3ziO9WSC3NbwC2x6/FJoCthEMzB7OBxKoVCQYrGoV9ztdh+/THUyXPI6Roia6XQqs9lMRqORjMdjGQwGSr5arfSwNOFHYVKuLfA0yuWylEolqVar2slGo6G1SqWizeHaaV9zCR+PhyogeDKo4q3anGaA+UqY1VWMt+tbJ7OwuQqTjcF8/MI/3h05f0aef38qpDH2Z/BoyfERP1n7l8IkCBUos+5yZX4xAh/zCH8AG9Yv94cxxtIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"abstracParameter\"\n        title=\"\"\n        src=\"/static/2fcdac3d96b2ef72a3ab2399d37172be/f058b/abstracParameter.png\"\n        srcset=\"/static/2fcdac3d96b2ef72a3ab2399d37172be/c26ae/abstracParameter.png 158w,\n/static/2fcdac3d96b2ef72a3ab2399d37172be/6bdcf/abstracParameter.png 315w,\n/static/2fcdac3d96b2ef72a3ab2399d37172be/f058b/abstracParameter.png 630w,\n/static/2fcdac3d96b2ef72a3ab2399d37172be/40601/abstracParameter.png 945w,\n/static/2fcdac3d96b2ef72a3ab2399d37172be/78612/abstracParameter.png 1260w,\n/static/2fcdac3d96b2ef72a3ab2399d37172be/27f8b/abstracParameter.png 1730w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>좋은 방법이긴 하지만 <a href=\"https://github.com/jdalma/java-to-kotlin#15%EC%9E%A5-%EC%BA%A1%EC%8A%90%ED%99%94%ED%95%9C-%EC%BB%AC%EB%A0%89%EC%85%98%EC%97%90%EC%84%9C-%ED%83%80%EC%9E%85-%EB%B3%84%EB%AA%85%EC%9C%BC%EB%A1%9C\">자바에서 코틀린으로 15장. 캡슐화한 컬렉션에서 타입 별명으로</a>을 보면 <strong>코틀린 표준 라이브러리가 제공하는 기능을 사용할 수 없기 때문에 제외하였다.</strong></p>\n<h2><strong>세 번째 방법 : 타입 추론</strong></h2>\n<p>코틀린의 <code class=\"language-text\">*</code>와 자바의 <code class=\"language-text\">?</code>와 같다고 생각하였지만 다르다는 것을 알 수 있다.<br>\n<a href=\"https://kotlinlang.org/docs/generics.html#star-projections\"><code class=\"language-text\">kotlinlang</code> Start-Projections</a>를 보면<br>\n타입 인수에 대해 자바의 <code class=\"language-text\">?</code> 같은 방식으로 모든 타입을 수용하고 안전한 방식으로 사용하기 위해 Kotlin은 <strong>스타 프로젝션</strong>을 제공한다.</p>","frontmatter":{"title":"코틀린의 와일드카드?","date":"February 10, 2023","description":null,"tags":["Kotlin","lab"]}},"previous":{"fields":{"slug":"/2023y02m/request/"},"frontmatter":{"title":"BlockingIO와 NonBlockingIO (작성중)"}},"next":null},"pageContext":{"id":"cb7d1452-1c84-5741-a959-b23fb4be26a3","previousPostId":"d729e334-539e-527c-8a84-306d2d2769b5","nextPostId":null}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}