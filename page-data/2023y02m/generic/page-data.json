{"componentChunkName":"component---src-templates-blog-post-js","path":"/2023y02m/generic/","result":{"data":{"site":{"siteMetadata":{"title":"코딩 주머니"}},"markdownRemark":{"id":"cb7d1452-1c84-5741-a959-b23fb4be26a3","excerpt":"…","html":"<p>업무를 진행하면서 스프링과 코틀린을 사용하면서 만난 문제를 정리하려고 한다. 실제 업무와 비슷하게 다이어그램을 작성해 보았다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/45d4ac8c261809320b6ce1471e641930/b5a09/classDiagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.81012658227847%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABxElEQVR42pWUB47CQAxF5/4HA6Egeu8dQm+CUL161hqFtrCWrEnsnz+ucev1WubzuSyXS2k0GlIoFKRUKkm73VYbPjDX61VWq5XaRqOR4srlsup4PJbFYqE4N5vNxPd9NTabTalUKlKtVqXVaslkMlEfmMvlItPpVHGDwUCJwKHD4VDt4Fy/35d0Oi35fF4ymYwCIU6lUlKr1W6ESLfbVTtYlMuLxaJmZDjHbTgxckICIeS5XE6VS5Fer6fv4CCiRNls9maDy5EKej6f9aPNZqO1QMzOSQ0NyzN2IjK/nU5+BRBC4WmEAdAwxsiCINA0w37EGcjUhNvpHF3tdDpSr9e1SURPc3a73d0lpk8RWmqQQUqNIpGIRKNRicVi2hgI9/v903caYTjcsJNoaAYEzCQF55k0HwnDmT0RmhMSz/MkmUzqWHHSWVLHF075robvCImQsaB+NImTYWeQsdOUj4SPqZuwCail+Q73Zw2Px6Pq4XDQ+hEdHT6dTmqzuf2YMgKYwtvYsDn8DHi27m+32+8JGRs6an8dCHlGaQr7zgL8i5DFj8fjuqO2q3Q7kUioksHXhJz8joiSWUR5Zwaxoez8K8IfhCEQdumKNEAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"classDiagram\"\n        title=\"\"\n        src=\"/static/45d4ac8c261809320b6ce1471e641930/f058b/classDiagram.png\"\n        srcset=\"/static/45d4ac8c261809320b6ce1471e641930/c26ae/classDiagram.png 158w,\n/static/45d4ac8c261809320b6ce1471e641930/6bdcf/classDiagram.png 315w,\n/static/45d4ac8c261809320b6ce1471e641930/f058b/classDiagram.png 630w,\n/static/45d4ac8c261809320b6ce1471e641930/40601/classDiagram.png 945w,\n/static/45d4ac8c261809320b6ce1471e641930/78612/classDiagram.png 1260w,\n/static/45d4ac8c261809320b6ce1471e641930/b5a09/classDiagram.png 1360w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">convert(List&lt;Data>)</code>는 고정된 타입을 받아 <code class=\"language-text\">T</code>를 반환하고, <code class=\"language-text\">execute(T)</code>는 <code class=\"language-text\">T</code>타입을 받아 응답으로 반환하는 것을 알 수 있다.<br>\n이 설계의 의도는 확장에 유연하도록 각 <code class=\"language-text\">ValidationImpl</code>은 <code class=\"language-text\">convert()</code>를 통해 <code class=\"language-text\">List&lt;Data></code>라는 타입을 받아 <strong>검증할 때 사용할 데이터 타입을 직접 정의할 수 있도록 했다.</strong></p>\n<p>현재 꼭 지켜야할 사항은</p>\n<ul>\n<li>\n<p><code class=\"language-text\">strategies</code>를 주입받을 떄 <strong><code class=\"language-text\">*</code> Star-projection</strong>을 사용하여 모든 구현체를 주입받아야 한다.</p>\n<ul>\n<li><code class=\"language-text\">*</code>로 하지 않고 <code class=\"language-text\">Any</code>로 주입받으면 빈을 찾지 못한다.</li>\n</ul>\n</li>\n<li>\n<p>제네릭을 <code class=\"language-text\">Any</code>로 작성하여 구현체마다 직접 다운 캐스팅을 하진 않을 것이다.</p>\n</li>\n</ul>\n<h1><strong>문제점</strong></h1>\n<p>위의 다이어그램과 같이 <code class=\"language-text\">Service</code>는 <code class=\"language-text\">ValidationStrategy</code> 인터페이스를 구현한 구현체를 <code class=\"language-text\">List&lt;ValidationStrategy></code>으로 주입받아 사용하려 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token function\">Service</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> strategies<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>ValidationStrategy<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span>values<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>ValidationResponse<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> strategies<span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">val</span> convertData <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span>\n            it<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>convertData<span class=\"token punctuation\">)</span> <span class=\"token comment\">// COMPILE ERROR!!!</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span>\n            it<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> ValidationStrategy<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>param<span class=\"token operator\">:</span> T<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> ValidationResponse\n\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>queries<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> T\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation builtin\">@Component</span>\n<span class=\"token keyword\">class</span> ValidationImpl1 <span class=\"token operator\">:</span> ValidationStrategy<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">execute</span><span class=\"token punctuation\">(</span>param<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ValidationResponse <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">ValidationResponse</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">convert</span><span class=\"token punctuation\">(</span>queries<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Data<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> String <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string-literal singleline\"><span class=\"token string\">\"가공 데이터\"</span></span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">ValidationResponse</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> message<span class=\"token operator\">:</span> String\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Data</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">val</span> <span class=\"token keyword\">data</span> <span class=\"token operator\">:</span> String\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>하지만 <code class=\"language-text\">it.execute(convertData)</code>를 호출할 때 파라미터를 넘겨보면 <strong>컴파일 에러</strong>가 발생한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 149px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7dfeda3242a343ad511a3be999b9f0c/d371d/nothing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.67785234899329%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVR42l2SWU8CQRCE+W9y39dyn2uCGE1cjgVWZRH2SfjRZb6OY4gPtdMzU91T1b2paq2m/mCgXr+vTrcrr9NRs9Wy2IG7bq+nVruttucZp9Fsily3r1SrKpZKSpGw2+30eTwaVuu1fN/XJUn0/vGh/eGg8+WizXar5fOzgtVK39ervs5nvQWB8V9eX01ULp9XqlQuW3X3UrlSMUBAAag3GsZxvOFoZOD8HqaQDwU4qNXrloRlYlbuC8WirRQnzuZytgeoYs854lL5QkGe5+l6u+kYx1osFn82ORtPJkaGt95sFEWR2T5EkfGCIFAYhvbYn0Iqz33fbNJsBsAgUNj4VQm4GwyHxqM99B8uvcWlFaQYcDaIUeRs3seoTGcyekinLXbK73PNMmpOp5O2Yajdfq84jjWZTpUkibUBe5lsVk/LpU0WN6wMhnzUUcwU8goDgDCdzeQ/PpoFpsnvQBIFSBiNx3ZPn2fzucq//54rZgrdxk2KF5mcm6ADPGePFfwvRsEfV2KV9cA2KOoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nothing\"\n        title=\"\"\n        src=\"/static/b7dfeda3242a343ad511a3be999b9f0c/d371d/nothing.png\"\n        srcset=\"/static/b7dfeda3242a343ad511a3be999b9f0c/d371d/nothing.png 149w\"\n        sizes=\"(max-width: 149px) 100vw, 149px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>코틀린의 <code class=\"language-text\">*</code>와 자바의 <code class=\"language-text\">?</code>와 같다고 생각하였지만 다르다는 것을 알 수 있다.</p>\n<p>IDE의 여러가지 제안이 있지만 <code class=\"language-text\">responses.add(it.execute(convertData as Nothing))</code> 이렇게 <code class=\"language-text\">Nothing</code>으로 변경해라 라는 제안이 있다.</p>","frontmatter":{"title":"코틀린 `*` 어떻게 써야할까?","date":"February 10, 2023","description":null,"tags":["Blocking","NonBlocking"]}},"previous":{"fields":{"slug":"/2023y02m/request/"},"frontmatter":{"title":"BlockingIO와 NonBlockingIO (작성중)"}},"next":null},"pageContext":{"id":"cb7d1452-1c84-5741-a959-b23fb4be26a3","previousPostId":"d729e334-539e-527c-8a84-306d2d2769b5","nextPostId":null}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}