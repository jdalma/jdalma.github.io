---
layout: default
title: 2022년 11월
nav_order: 41
parent: ⏪ 회고
---
{: .no_toc }

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

---

# **11월 첫째 주 회고**

지난 주 목표인 Real Mysql를 읽지 않았다..<br>
이번 주에는 꼭 읽자

## [Java 9과 Spring 5로 바라보는 Java의 변화와 도전](https://www.youtube.com/watch?v=BFjrmj4p3_Y&t=781s&ab_channel=OracleKorea)

- **어노테이션의 한계와 부작용**
    1. 컴파일러에 의해 검증 가능한 타입이 아님
    2. 코드의 행위를 규정하지 않음
    3. 상속, 확장 규칙의 표준이 없음
    4. 이해하기 어렵고 오해하기 쉬운 코드 가능성
    5. 테스트가 어렵거나 불가능함
    6. 커스터마이징하기 어려움
    7. **리플렉션과 런타임 바이트코드 생성의 문제**
        1. 성능 저하
        2. 타입정보 제거
        3. 디버깅 어려움
        4. 툴이나 컴파일러에 의한 검증 불가 
- `Composed Annotation`과 `@AliasFor`
- **스프링 5.0 : 새로운 함수형 스타일 웹 개발 지원**
- **JavaSE 9 : `Flow API`와 `ReactiveStreams`**


## 토프링 7장 스프링 핵심 기술의 응용

- 기존에는 `XmlSqlService` 생성자에서 XML **언마샬링**작업을 했다
- XML에서 SQL 정보를 읽어오는 책임과 SQL들을 매핑하는 책임에 맞는 개별의 인터페이스를 추가했다
  - `SqlRegistry`, `SqlReader`
- 위 두 개의 인터페이스를 `XmlSqlService` 한 클래스에서 모두 구현하여 **자기 참조**를 하도록 리팩토링했다
- **자기 참조**로 되어있는 각 책임들을 분리하기 위하여 구현 클래스들을 추가했다 
  - `SqlRegistry`를 구현하는 `HashMapSqlRegistry` 추가
  - `SqlReader`를 구현하는 `JaxbXmlSqlReader`추가
- 위의 구현체들을 DI하도록 **디폴트 의존관계를 갖는 `DefaultSqlService`를 추가**
- 지금은 XML 정보를 읽어들이는 `JAXB`로 구체적인 기술과 API에 종속되어 있기 때문에 **서비스 추상화** 적용
  -  Spring의 `Jaxb2Marshaller` 테스트
- `BaseSqlService`와 `OxmSqlService`의 중복되는 메소드를 제거하기 위해 해당 메소드들은 `BaseSqlService`에게 실행하도록 위임했다
- **SQL을 조작하는 책임을 가진 `UpdatableSqlRegistry`인터페이스를 구현하는** 
  - `ConcurrentHashMapSqlRegistry` 클래스를 추가하였다
  - `EmbeddedDbSqlRegistry`클래스를 추가하였다
    - 내장형 디비는 H2를 사용, `update(Map<String, String> sqlmap)`에 트랜잭션을 적용하였다

```java
public class EmbeddedDbSqlRegistry implements UpdatableSqlRegistry {
    JdbcTemplate jdbc;
    TransactionTemplate template;

    public void setDataSource(DataSource dataSource) {
        jdbc = new JdbcTemplate(dataSource);
        // DataSource로 TransactionManager를 만들고 이를 이용해 TransactionTemplate을 생성한다.
        template = new TransactionTemplate(new DataSourceTransactionManager(dataSource));
    }
    ...
}
```

dataSource로 `JdbcTemplate`을 생성하여 쿼리를 실행시키는 것과 <br>
dataSource로 `TransactionManager`를 생성하고 `TransactionTemplate`을 생성하여 쿼리를 실행시키는 것의<br>
트랜잭션 동기화 저장소를 사용하는 차이점은 알겠지만 확실한 (각 클래스들의)차이점을 알진 못 하겠다.<br>
<br>

7장에서 개인적으로 SQL을 수정하는 기능을 추가하면서 `UpdatableSqlRegistry`인터페이스를 추가하고<br>
`SqlRegistry`를 추상화 한것이 인상깊었다.
- `ConcurrentHashMap`을 사용한 구현체와 `내장형 디비`를 사용한 구현체를 추가한 것

## 차주목표

1. [Java 9과 Spring 5로 바라보는 Java의 변화와 도전](https://www.youtube.com/watch?v=BFjrmj4p3_Y&t=781s&ab_channel=OracleKorea) `25:39` 테스트 해보기
2. `TransactionTemplate`과 `JdbcTemplate`의 차이점 분석하기
3. **Real MySQL**에서 인덱스와 실행계획 훑어보기
4. 토프링 8장 읽기
5. 구름 챌린지 5주차 복습 , 6주차 완료